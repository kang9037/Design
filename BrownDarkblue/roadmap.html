<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스터디케어 - 학생부 로드맵 생성기</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fafaf9 0%, #f5f5f4 50%, #e7e5e4 100%);
            min-height: 100vh;
            padding: 130px 0 0 0; /* 헤더 높이를 고려한 padding 조정 */
            position: relative;
            margin: 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(202, 138, 4, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(133, 77, 14, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(71, 85, 105, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* 헤더의 container는 styles.css의 스타일 유지 */
        body > .container {
            max-width: 100%;
            margin: 0;
            position: relative;
            z-index: 1;
            padding: 0;
        }

        .page-header {
            text-align: center;
            color: #854d0e;
            margin-top: 0;
            margin-bottom: 0;
            padding: 40px 80px;
            text-shadow: 0 2px 4px rgba(133, 77, 14, 0.1);
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }

        .page-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .page-header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* 카드 여백 개선 */
        .card {
            background: transparent;
            backdrop-filter: none;
            border-radius: 0;
            padding: 20px 40px; /* 여백 줄이기 */
            box-shadow: none;
            margin-bottom: 0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 35px;
        }

        label {
            display: block;
            margin-bottom: 14px;
            color: #1f2937;
            font-weight: 600;
            font-size: 1.1em; /* 크기 증가 */
            letter-spacing: 0.3px;
        }

        /* 입력 폼 크기 확대 */
        input, select, textarea {
            width: 100%;
            padding: 24px 28px; /* 패딩 증가 */
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.15em; /* 폰트 크기 증가 */
            transition: all 0.3s;
            font-family: inherit;
            background: #ffffff;
            color: #1f2937;
            line-height: 1.5;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.15);
            background: #fffbeb;
        }

        textarea {
            resize: vertical;
            min-height: 140px; /* 최소 높이 증가 */
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .btn {
            padding: 20px 50px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(202, 138, 4, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-group {
            text-align: center;
            margin-top: 30px;
        }

        /* ============ 로딩 상태 스타일 ============ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading-content {
            background: white;
            padding: 60px 80px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeInScale 0.4s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid #f0f0f0;
            border-top: 6px solid #ca8a04;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-message {
            margin-top: 30px;
            font-size: 1.3em;
            font-weight: 700;
            color: #854d0e;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 로딩 반응형 */
        @media (max-width: 768px) {
            .loading-content {
                padding: 40px 50px;
                margin: 0 20px;
            }

            .loading-spinner {
                width: 60px;
                height: 60px;
            }

            .loading-message {
                font-size: 1.1em;
                margin-top: 20px;
            }
        }

        /* ============ 타이핑 효과 ============ */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: #ca8a04;
            margin-left: 3px;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* ============ 인쇄/PDF 버튼 스타일 ============ */
        .print-pdf-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #ca8a04 0%, #92400e 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(202, 138, 4, 0.4);
            transition: all 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .print-pdf-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(202, 138, 4, 0.5);
        }

        /* ============ 인쇄 모달 스타일 ============ */
        .print-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .print-modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInScale 0.4s ease-out;
        }

        .print-modal h3 {
            font-size: 1.8em;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .print-modal p {
            color: #64748b;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .print-modal-buttons {
            display: flex;
            gap: 15px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #ca8a04 0%, #92400e 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(202, 138, 4, 0.3);
        }

        .modal-btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }

        .modal-btn-secondary:hover {
            background: #e2e8f0;
        }

        /* ============ 차트 스타일 ============ */
        .chart-container {
            margin: 25px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .progress-bars {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .progress-bar-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar-label {
            min-width: 80px;
            font-weight: 600;
            color: #1e293b;
        }

        .progress-bar-track {
            flex: 1;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ca8a04 0%, #92400e 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 700;
            font-size: 0.9em;
            position: relative;
            overflow: visible; /* 텍스트가 보이도록 */
            /* width는 inline 스타일에서 0%로 시작 */
        }

        /* 등급별 색상 */
        .progress-bar-fill.grade-1 {
            background: linear-gradient(90deg, #dc2626 0%, #991b1b 100%);
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .progress-bar-fill.grade-2 {
            background: linear-gradient(90deg, #ea580c 0%, #c2410c 100%);
            box-shadow: 0 2px 8px rgba(234, 88, 12, 0.3);
        }

        .progress-bar-fill.grade-3 {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .progress-bar-fill.grade-4 {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .progress-bar-fill.grade-5 {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        /* 프로그레스 바 내부 텍스트 */
        .progress-bar-fill span {
            opacity: 0;
            transition: opacity 0.3s ease-in;
            white-space: nowrap;
        }

        /* 향상 전략 텍스트 스타일 */
        .strategy-text {
            font-size: 0.95em;
            color: #475569;
            line-height: 1.6;
            padding: 10px 0;
            min-height: 60px;
        }

        .progress-bar-fill.animate span {
            opacity: 1;
            transition-delay: 0.8s; /* 바가 거의 다 찬 후에 텍스트 표시 */
        }

        /* 프로그레스 바 애니메이션 클래스 */
        .progress-bar-fill.animate {
            animation: progressFill 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards !important;
        }

        @keyframes progressFill {
            from {
                width: 0%;
            }
            to {
                width: var(--target-width);
            }
        }

        /* 반짝이는 효과 */
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 2.5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }
            60%, 100% {
                left: 100%;
            }
        }

        /* 프로그레스 바 트랙에 펄스 효과 */
        .progress-bar-track {
            position: relative;
        }

        .progress-bar-track::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 15px;
            background: rgba(202, 138, 4, 0.1);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: separate;
            border-spacing: 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            font-weight: 700;
        }

        .comparison-table tbody tr:nth-child(even) {
            background: #f8fafc;
        }

        .grade-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .grade-badge.excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .grade-badge.good {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .grade-badge.need-improvement {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .grade-badge.urgent {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* ============ 인쇄 스타일 ============ */
        @media print {
            @page {
                size: A4 landscape;
                margin: 10mm;
            }

            /* 인쇄 시 헤더, 푸터, 버튼 등 숨기기 */
            #common-header,
            .print-pdf-btn,
            .print-modal-overlay,
            .progress-steps,
            .step-card,
            .floating-action {
                display: none !important;
            }

            body {
                background: white !important;
                margin: 0;
                padding: 0;
                font-size: 9pt;
            }

            .container {
                margin: 0;
                padding: 0;
                max-width: 100%;
            }

            #resultContainer {
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
            }

            .document-container {
                box-shadow: none !important;
                page-break-after: auto;
                max-width: 100%;
            }

            .document-header {
                background: #1e293b !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 30px 40px !important;
            }

            .document-body {
                padding: 20px 30px !important;
            }

            .section {
                page-break-inside: avoid;
                margin-bottom: 20px !important;
                padding: 15px !important;
            }

            .section-title {
                font-size: 1.2em !important;
                margin-bottom: 12px !important;
            }

            .info-cards {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
            }

            .info-card {
                padding: 12px !important;
            }

            .data-table {
                font-size: 0.85em !important;
            }

            .data-table th,
            .data-table td {
                padding: 8px !important;
            }

            .chart-container {
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .progress-bar-fill {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .grade-badge {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* 모든 배경색과 테두리 유지 */
            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        /* ============ 결과 문서 스타일 ============ */
        .document-container {
            background: white;
            max-width: 95%;
            width: 95%;
            margin: 0 auto;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        /* 성적 테이블 + 차트 통합 스타일 */
        .grade-table-with-chart {
            width: 100%;
            border-collapse: collapse;
        }

        .grade-table-with-chart th,
        .grade-table-with-chart td {
            padding: 15px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .grade-table-with-chart th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            font-weight: 700;
        }

        .grade-table-with-chart .chart-cell {
            text-align: left;
            padding: 10px 15px;
        }

        /* 대학 추천 가로 배치 */
        .university-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .university-tier-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .university-tier-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .tier-header {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tier-safe { border-color: #10b981; }
        .tier-safe .tier-header { color: #10b981; border-color: #10b981; }

        .tier-target { border-color: #3b82f6; }
        .tier-target .tier-header { color: #3b82f6; border-color: #3b82f6; }

        .tier-challenge { border-color: #f59e0b; }
        .tier-challenge .tier-header { color: #f59e0b; border-color: #f59e0b; }

        /* 대학 비교 컨테이너 */
        .university-comparison-container {
            width: calc(100% + 95px);
            margin-left: 0;
            margin-right: -95px;
            overflow-x: auto;
        }

        .university-comparison-container .comparison-table {
            width: 100%;
            min-width: 100%;
        }

        /* 로드맵 타임라인 테이블 */
        .roadmap-timeline-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .roadmap-timeline-table th,
        .roadmap-timeline-table td {
            padding: 15px;
            border: 1px solid #e2e8f0;
            text-align: left;
            vertical-align: top;
        }

        .roadmap-timeline-table th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            font-weight: 700;
            text-align: center;
        }

        .roadmap-timeline-table .period-header {
            background: linear-gradient(135deg, #ca8a04 0%, #92400e 100%);
            color: white;
            font-weight: 700;
            text-align: center;
        }

        /* 통합 활동 계획 테이블 */
        .integrated-plan-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .integrated-plan-table th,
        .integrated-plan-table td {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            text-align: left;
        }

        .integrated-plan-table th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            font-weight: 700;
            text-align: center;
        }

        .integrated-plan-table .category-cell {
            background: #f8fafc;
            font-weight: 700;
            color: #1e293b;
        }

        /* 입시 전문가 분석 박스 */
        .expert-analysis-box {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-left: 5px solid #ca8a04;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
        }

        /* 대학 추천 박스 */
        .university-recommendation-box {
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            border: 2px solid #fde68a;
            border-left: 5px solid #ca8a04;
            border-radius: 12px;
            padding: 30px 50px;
            margin: 20px -30px;
            position: relative;
            width: calc(100% + 60px);
        }

        .university-recommendation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fde68a;
        }

        .university-recommendation-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .university-recommendation-table th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 700;
            font-size: 0.95em;
        }

        .university-recommendation-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .university-recommendation-table tbody tr:last-child td {
            border-bottom: none;
        }

        .university-recommendation-table tbody tr:hover {
            background: #fefce8;
        }

        .typing-cell {
            font-weight: 600;
            color: #854d0e;
            min-height: 20px;
        }

        .expert-analysis-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .expert-badge {
            background: linear-gradient(135deg, #ca8a04 0%, #92400e 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .analysis-text {
            line-height: 1.8;
            color: #1e293b;
            font-size: 1.05em;
        }

        .streaming-text {
            display: inline;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .typing-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ca8a04;
            border-radius: 50%;
            animation: pulse 1s infinite;
            margin-left: 3px;
        }

        .document-header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 50px 60px;
            position: relative;
            overflow: hidden;
        }

        .document-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .document-title {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 15px;
            position: relative;
        }

        .document-subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            position: relative;
        }

        .document-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.3);
            position: relative;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .document-body {
            padding: 50px 60px;
        }

        .section {
            margin-bottom: 40px;
            page-break-inside: avoid;
            background: white;
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border-left: 6px solid #3b82f6;
        }

        .section-title {
            font-size: 1.7em;
            color: #1e3a8a;
            font-weight: 700;
            margin-bottom: 30px;
            padding-bottom: 18px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-icon {
            font-size: 1.2em;
        }

        /* 정보 카드 그리드 */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 2px solid #fde68a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card-label {
            font-size: 0.85em;
            color: #854d0e;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-card-value {
            font-size: 1.3em;
            color: #333;
            font-weight: 700;
        }

        /* 테이블 스타일 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border-radius: 12px;
            overflow: hidden;
        }

        .data-table thead {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
        }

        .data-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
            letter-spacing: 0.3px;
        }

        .data-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.3s;
        }

        .data-table tbody tr:hover {
            background: #fef9c3;
        }

        .data-table td {
            padding: 16px 20px;
            color: #333;
            font-size: 0.95em;
        }

        .data-table tbody tr:last-child {
            border-bottom: none;
        }

        /* 뱃지 스타일 */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .badge-primary {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .badge-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        /* 대학 추천 섹션 */
        .university-tiers {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .tier-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }

        .tier-box:hover {
            border-color: #ca8a04;
            box-shadow: 0 5px 20px rgba(202, 138, 4, 0.15);
        }

        .tier-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tier-title {
            font-size: 1.2em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tier-universities {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .university-chip {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 1px solid #fde68a;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            color: #854d0e;
            font-size: 0.95em;
            transition: all 0.3s;
            cursor: default;
        }

        .university-chip:hover {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        /* 마인드맵 스타일 */
        .mindmap-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin: 25px 0;
        }

        .mindmap-branch {
            display: flex;
            align-items: stretch;
            gap: 20px;
        }

        .branch-label {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 700;
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
        }

        .branch-items {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            flex: 1;
            align-items: center;
        }

        .mindmap-item {
            background: white;
            border: 2px solid #ca8a04;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
            color: #333;
            transition: all 0.3s;
        }

        .mindmap-item:hover {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        /* 경고/정보 박스 스타일 */
        .alert-box {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: start;
            gap: 15px;
        }

        .alert-box-info {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #60a5fa;
            color: #1e40af;
        }

        .alert-box-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            color: #92400e;
        }

        .alert-box-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #34d399;
            color: #065f46;
        }

        .alert-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        /* 로드맵 항목 스타일 */
        .roadmap-item {
            background: linear-gradient(135deg, #fff 0%, #f9fafb 100%);
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
            position: relative;
            padding-left: 60px;
        }

        .roadmap-item:hover {
            border-color: #ca8a04;
            box-shadow: 0 5px 20px rgba(202, 138, 4, 0.15);
        }

        .roadmap-item::before {
            content: attr(data-step);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
        }

        .roadmap-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .roadmap-description {
            color: #6b7280;
            line-height: 1.6;
        }

        /* 프로그레스 바 스타일 */
        .progress-container {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 4px;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .progress-bar {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9em;
            transition: width 0.5s ease;
            box-shadow: 0 2px 8px rgba(202, 138, 4, 0.3);
        }

        /* 액션 버튼 스타일 */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #fafaf9 0%, #f5f5f4 100%);
            border-radius: 12px;
            justify-content: center;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn-print {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .action-btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .action-btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .action-btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .action-btn-reset {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .action-btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* 플로팅 액션 버튼 */
        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(202, 138, 4, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 30px rgba(202, 138, 4, 0.5);
        }

        /* 검색 박스 스타일 */
        .search-box {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 30px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #ca8a04;
            box-shadow: 0 0 0 4px rgba(202, 138, 4, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1.2em;
        }

        /* Step Cards */
        .step-card {
            background: white;
            padding: 0;
            margin: 0 auto;
            max-width: 1280px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
            flex-direction: column;
        }

        .step-card.active {
            display: flex;
        }

        .step-header {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .step-info {
            flex: 1;
        }

        .step-title {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .step-description {
            font-size: 1em;
            opacity: 0.9;
        }

        /* Section Boxes - 카드 색상 개선 */
        .section-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 30px 50px;
            margin-bottom: 30px;
            margin-left: -30px;
            margin-right: -30px;
            width: calc(100% + 60px);
            transition: all 0.3s;
        }

        .section-box:hover {
            border-color: #ca8a04;
            box-shadow: 0 8px 24px rgba(202, 138, 4, 0.12);
        }

        .section-box h3 {
            color: #1f2937;
            font-size: 1.3em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f3f4f6;
        }

        /* Step 2 성적 정보 카드 색상 개선 */
        .section-box-green {
            background: linear-gradient(135deg, #fef9f3 0%, #fef7eb 100%);
            border: 2px solid #ca8a04;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .section-box-green:hover {
            box-shadow: 0 10px 30px rgba(202, 138, 4, 0.15);
            transform: translateY(-2px);
        }

        .section-box-green h3 {
            color: #854d0e;
            font-size: 1.3em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(202, 138, 4, 0.2);
        }

        .section-box-blue {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #475569;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .section-box-blue:hover {
            box-shadow: 0 10px 30px rgba(71, 85, 105, 0.15);
            transform: translateY(-2px);
        }

        .section-box-blue h3 {
            color: #1e293b;
            font-size: 1.3em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(71, 85, 105, 0.2);
        }

        .section-box-purple {
            background: linear-gradient(135deg, #fef9f3 0%, #fef3e2 100%);
            border: 2px solid #d97706;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        .section-box-purple:hover {
            border-color: #b45309;
            box-shadow: 0 8px 24px rgba(217, 119, 6, 0.12);
        }

        .section-box-purple h3 {
            color: #92400e;
            font-size: 1.3em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fde68a;
        }

        /* Button Styles */
        .next-step-btn {
            width: 100%;
            padding: 18px 30px;
            margin-top: 30px;
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.25);
        }

        .next-step-btn:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(202, 138, 4, 0.35);
        }

        /* 버튼 그룹 디자인 완성 */
        .button-group {
            display: flex;
            flex-direction: row;
            gap: 15px;
            margin-top: 30px;
        }

        .button-group .next-step-btn,
        .button-group .generate-btn {
            flex: 1;
            margin-top: 0;
        }

        .generate-btn {
            padding: 20px 40px;
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.15em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 16px rgba(202, 138, 4, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .generate-btn:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(202, 138, 4, 0.4);
        }

        .generate-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        .prev-step-btn {
            flex: 0 0 auto;
            width: auto;
            min-width: 200px;
            padding: 20px 35px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #475569;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(71, 85, 105, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .prev-step-btn:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.2);
            border-color: #94a3b8;
        }

        .prev-step-btn:active {
            transform: translateY(0);
        }

        /* Progress Bar */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            padding: 0 3rem;
            margin: 0 auto 40px;
            max-width: 1280px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 5rem;
            right: 5rem;
            height: 2px;
            background: #e5e7eb;
            z-index: 0;
        }

        .progress-step {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .progress-step-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            font-size: 1.2em;
            color: #9ca3af;
            transition: all 0.3s;
        }

        .progress-step.active .progress-step-circle {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            border-color: #ca8a04;
            color: white;
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        .progress-step.completed .progress-step-circle {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .progress-step-label {
            font-size: 0.9em;
            color: #6b7280;
            font-weight: 600;
        }

        .progress-step.active .progress-step-label {
            color: #ca8a04;
        }

        /* Department Chips */
        .department-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .department-category {
            width: 100%;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .department-category-title {
            font-weight: bold;
            color: #854d0e;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }

        .department-chip {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .department-chip:hover {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            border-color: #ca8a04;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(202, 138, 4, 0.2);
        }

        /* 과목 추가 버튼 스타일 */
        .add-subject-btn {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(202, 138, 4, 0.2);
        }

        .add-subject-btn:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(202, 138, 4, 0.3);
        }

        /* 과목 그리드 스타일 */
        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* 추가된 과목 행 스타일 */
        .additional-subject-row {
            position: relative;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
            padding-top: 30px;
            background: linear-gradient(135deg, #f5e6d3 0%, #f0dcc4 100%);
            border: 2px dashed rgba(202, 138, 4, 0.4);
            border-radius: 12px;
            animation: slideIn 0.3s ease-out;
            margin-bottom: 20px;
        }

        #additionalSubjectsContainer .additional-subject-row {
            margin-bottom: 20px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 삭제 버튼 스타일 */
        .delete-subject-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .delete-subject-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* 목표 대학 입력 폼 스타일 */
        #targetUniversityFormContainer {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fef9f3 0%, #fffcf8 100%);
            border: 2px solid rgba(202, 138, 4, 0.2);
            border-radius: 15px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                max-height: 1000px;
                transform: translateY(0);
            }
        }

        .target-university-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(202, 138, 4, 0.2);
        }

        .target-university-header h4 {
            margin: 0;
            color: #854d0e;
            font-size: 1.2em;
            font-weight: 700;
        }

        .add-university-btn {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(202, 138, 4, 0.2);
        }

        .add-university-btn:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(202, 138, 4, 0.3);
        }

        .target-university-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border: 2px dashed rgba(202, 138, 4, 0.3);
            border-radius: 12px;
            animation: slideIn 0.3s ease-out;
        }

        .target-university-row:hover {
            border-color: rgba(202, 138, 4, 0.5);
            box-shadow: 0 2px 10px rgba(202, 138, 4, 0.1);
        }

        .delete-university-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            align-self: end;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .delete-university-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* 대학교 자동완성 스타일 */
        .university-autocomplete {
            position: relative;
        }

        .university-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ca8a04;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 8px 20px rgba(202, 138, 4, 0.2);
            display: none;
        }

        .university-suggestions.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .university-suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .university-suggestion-item:last-child {
            border-bottom: none;
        }

        .university-suggestion-item:hover {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .university-name {
            font-weight: 600;
            color: #854d0e;
            font-size: 0.95em;
        }

        .university-info {
            font-size: 0.85em;
            color: #6b7280;
        }

        .university-suggestions::-webkit-scrollbar {
            width: 8px;
        }

        .university-suggestions::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 0 0 12px 0;
        }

        .university-suggestions::-webkit-scrollbar-thumb {
            background: #ca8a04;
            border-radius: 4px;
        }

        .university-suggestions::-webkit-scrollbar-thumb:hover {
            background: #854d0e;
        }

        .university-autocomplete input:focus {
            border-color: #ca8a04;
            outline: none;
            box-shadow: 0 0 0 3px rgba(202, 138, 4, 0.1);
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .page-header,
            .step-card,
            .progress-steps,
            .floating-action {
                display: none !important;
            }

            .document-container {
                box-shadow: none;
                max-width: 100%;
            }

            .section {
                page-break-inside: avoid;
            }

            .action-buttons {
                display: none;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header {
                padding: 30px 20px;
            }

            .step-card {
                margin: 0 20px;
            }

            .card {
                padding: 15px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .subjects-grid {
                grid-template-columns: 1fr;
            }

            .additional-subject-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .additional-subject-row .delete-subject-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
            }

            .info-cards {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group .prev-step-btn {
                width: 100%;
                min-width: auto;
                order: 2;
            }

            .button-group .generate-btn,
            .button-group .next-step-btn {
                order: 1;
            }

            .progress-steps {
                padding: 0 20px;
            }

            .progress-steps::before {
                left: 40px;
                right: 40px;
            }
        }

        /* 활동 체크박스 그리드 스타일 */
        .activity-checkbox-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .activity-checkbox-item {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.25rem 1.5rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .activity-checkbox-item:hover {
            border-color: #ca8a04;
            background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.15);
        }

        .activity-checkbox-item input[type="checkbox"] {
            display: none;
        }

        .activity-checkbox-item.selected {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #ca8a04;
            border-width: 3px;
            box-shadow: 0 4px 16px rgba(202, 138, 4, 0.3);
        }

        .activity-checkbox-item.selected .checkbox-label {
            color: #854d0e;
            font-weight: 700;
        }

        .activity-checkbox-item.selected .checkbox-label svg {
            stroke: #ca8a04;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.05rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.3s ease;
        }

        .checkbox-label svg {
            stroke: #9ca3af;
            transition: stroke 0.3s ease;
        }

        .activity-checkbox-item input[type="checkbox"]:checked ~ .checkbox-label svg {
            stroke: #ca8a04;
        }

        /* 활동 상세 입력 박스 */
        .activity-detail-box {
            position: relative;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #bae6fd;
            border-radius: 12px;
            padding: 1.5rem;
            padding-top: 2.5rem;
            margin-bottom: 1rem;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .activity-detail-box label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #0369a1;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.75rem;
        }

        .activity-detail-box textarea {
            background: white;
            border: 2px solid #7dd3fc;
        }

        .activity-detail-box textarea:focus {
            border-color: #0284c7;
            box-shadow: 0 0 0 4px rgba(2, 132, 199, 0.1);
        }

        /* 활동 상세 박스 삭제 버튼 */
        .activity-detail-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .activity-detail-close-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        @media (max-width: 1024px) {
            .activity-checkbox-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .activity-checkbox-grid {
                grid-template-columns: 1fr;
            }

            .activity-checkbox-item {
                padding: 1rem 1.25rem;
            }

            .checkbox-label {
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <!-- 로그인 인증 체크 -->
    <script>
        // 페이지 로드 시 로그인 상태 확인
        (function() {
            const userInfo = localStorage.getItem('userInfo');
            if (!userInfo) {
                // 로그인하지 않은 경우 로그인 페이지로 리다이렉트
                alert('로그인이 필요한 페이지입니다.');
                window.location.href = 'login.html';
            }
        })();
    </script>

    <div id="common-header"></div>
    <div class="container">
        <!-- Header with Progress -->

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="progress-step active" id="progress1">
                <div class="progress-step-circle">1</div>
                <div class="progress-step-label">기본 정보</div>
            </div>
            <div class="progress-step" id="progress2">
                <div class="progress-step-circle">2</div>
                <div class="progress-step-label">성적 정보</div>
            </div>
            <div class="progress-step" id="progress3">
                <div class="progress-step-circle">3</div>
                <div class="progress-step-label">활동 현황</div>
            </div>
        </div>

        <!-- Step 1: 기본 정보 -->
        <div class="step-card active" id="stepCard1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-info">
                    <div class="step-title">기본 정보 입력</div>
                    <div class="step-description">학생의 기본 정보와 희망 진로를 입력해주세요</div>
                </div>
            </div>

            <div class="card">
                <!-- 기본 정보 -->
                <div class="section-box">
                    <h3>📋 기본 정보</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>이름</label>
                            <input type="text" id="studentName" placeholder="학생 이름을 입력하세요">
                        </div>
                        <div class="form-group">
                            <label>학년/학기</label>
                            <select id="currentGrade">
                                <option value="1">고1</option>
                                <option value="2">고2</option>
                                <option value="3">고3</option>
                            </select>
                        </div>
                    </div>

                    <!-- 학교명 토글 방식으로 변경 -->
                    <div class="form-group">
                        <label>학교명</label>
                        <div style="position: relative;">
                            <input type="text" id="schoolName"
                                   placeholder="학교명을 검색하거나 클릭하여 선택하세요"
                                   oninput="searchSchool(this.value)"
                                   onfocus="showAllSchools()"
                                   autocomplete="off">
                            <div id="schoolSuggestions"
                                 style="display: none; position: absolute; top: 100%; left: 0; right: 0;
                                        background: white; border: 2px solid #ca8a04; border-top: none;
                                        border-radius: 0 0 10px 10px; max-height: 350px; overflow-y: auto;
                                        z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                        </div>
                        <div id="schoolInfo" style="margin-top: 10px; font-size: 0.85em; color: #333;"></div>
                    </div>

                    <div class="form-group">
                        <label>희망 학과/전공</label>
                        <div style="position: relative;">
                            <input type="text" id="department" placeholder="학과/전공을 검색하거나 클릭하여 선택하세요" oninput="searchDepartment(this.value)" onfocus="showAllDepartments()" autocomplete="off">
                            <div id="departmentSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #ca8a04; border-top: none; border-radius: 0 0 10px 10px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>관심 키워드 (선택)</label>
                        <input type="text" id="keywords" placeholder="예: AI, 로봇공학, 의료, 환경 (쉼표로 구분)">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="next-step-btn" onclick="goToNextStep(2)">다음 단계 →</button>
                </div>
            </div>
        </div>

        <!-- Step 2: 성적 정보 -->
        <div class="step-card" id="stepCard2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-info">
                    <div class="step-title">성적 정보 입력</div>
                    <div class="step-description">현재 성적과 목표 성적을 입력해주세요</div>
                </div>
            </div>

            <div class="card">
                <!-- 과목별 현재 등급 -->
                <div class="section-box-green">
                    <h3>📊 과목별 현재 성적 (내신 등급)</h3>
                    <div class="additional-subject-row" id="subject_korean">
                        <div class="form-group">
                            <label>과목명</label>
                            <input type="text" id="koreanGrade_name" value="국어" placeholder="과목명을 입력하세요" onchange="saveFormData()">
                        </div>
                        <div class="form-group">
                            <label>등급</label>
                            <select id="koreanGrade" onchange="saveFormData()">
                                <option value="">선택</option>
                                <option value="1">1등급</option>
                                <option value="2">2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>
                        <button type="button" class="delete-subject-btn" onclick="removeSubject('subject_korean')">
                            ✕
                        </button>
                    </div>
                    <div class="additional-subject-row" id="subject_english">
                        <div class="form-group">
                            <label>과목명</label>
                            <input type="text" id="englishGrade_name" value="영어" placeholder="과목명을 입력하세요" onchange="saveFormData()">
                        </div>
                        <div class="form-group">
                            <label>등급</label>
                            <select id="englishGrade" onchange="saveFormData()">
                                <option value="">선택</option>
                                <option value="1">1등급</option>
                                <option value="2">2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>
                        <button type="button" class="delete-subject-btn" onclick="removeSubject('subject_english')">
                            ✕
                        </button>
                    </div>
                    <div class="additional-subject-row" id="subject_math">
                        <div class="form-group">
                            <label>과목명</label>
                            <input type="text" id="mathGrade_name" value="수학" placeholder="과목명을 입력하세요" onchange="saveFormData()">
                        </div>
                        <div class="form-group">
                            <label>등급</label>
                            <select id="mathGrade" onchange="saveFormData()">
                                <option value="">선택</option>
                                <option value="1">1등급</option>
                                <option value="2">2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>
                        <button type="button" class="delete-subject-btn" onclick="removeSubject('subject_math')">
                            ✕
                        </button>
                    </div>

                    <!-- 추가 과목 컨테이너 -->
                    <div id="additionalSubjectsContainer"></div>

                    <!-- 과목 추가 버튼 -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="button" class="add-subject-btn" onclick="addSubject()">
                            ➕ 과목 추가
                        </button>
                    </div>
                </div>

                <!-- 목표 설정 -->
                <div class="section-box-blue">
                    <h3>🎯 목표 설정</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>목표 내신 등급 (평균)</label>
                            <select id="targetGrade">
                                <option value="1">1등급</option>
                                <option value="2">2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>목표 대학 수준</label>
                            <select id="targetUniversity" onchange="toggleTargetUniversityForm()">
                                <option value="">선택해주세요</option>
                                <option value="서울권 상위">서울권 상위 (서연고/서성한)</option>
                                <option value="서울권 중위">서울권 중위 (중경외시)</option>
                                <option value="서울권">서울권 대학</option>
                                <option value="수도권">수도권 대학</option>
                                <option value="지방 거점 국립대">지방 거점 국립대</option>
                                <option value="지방 사립대">지방 사립대</option>
                            </select>
                        </div>
                    </div>

                    <!-- 목표 대학/전공 입력 폼 (동적으로 표시) -->
                    <div id="targetUniversityFormContainer" style="display: none;">
                        <div class="target-university-header">
                            <h4>📚 구체적인 목표 대학 및 전공</h4>
                            <button type="button" class="add-university-btn" onclick="addTargetUniversity()">
                                ➕ 대학 추가
                            </button>
                        </div>
                        <div id="targetUniversitiesContainer">
                            <!-- 동적으로 대학/전공 입력 행이 추가됨 -->
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="next-step-btn" onclick="goToNextStep(3)">다음 단계 →</button>
                    <button type="button" class="prev-step-btn" onclick="goToPrevStep(1)">← 이전 단계</button>
                </div>
            </div>
        </div>

        <!-- Step 3: 활동 현황 -->
        <div class="step-card" id="stepCard3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-info">
                    <div class="step-title">활동 현황 입력</div>
                    <div class="step-description">현재까지의 활동 현황과 관심 분야를 입력해주세요</div>
                </div>
            </div>

            <div class="card">
                <!-- 활동 현황 -->
                <div class="section-box-purple">
                    <h3>🎯 활동 현황</h3>
                    <div class="form-group">
                        <label>현재 참여 중인 동아리/활동</label>
                        <textarea id="currentActivities" rows="3" placeholder="예: 과학동아리, 토론반, 봉사활동 등"></textarea>
                    </div>
                    <div class="form-group">
                        <label>수상 경력</label>
                        <textarea id="awards" rows="3" placeholder="예: 교내 수학경시대회 금상, 과학탐구대회 은상 등"></textarea>
                    </div>
                    <div class="form-group">
                        <label>독서 활동</label>
                        <textarea id="reading" rows="3" placeholder="주요 독서 목록이나 관심 분야 도서를 입력하세요"></textarea>
                    </div>
                </div>

                <!-- 희망 활동 -->
                <div class="section-box">
                    <h3>💡 관심 활동 분야</h3>
                    <div class="form-group">
                        <label>참여하고 싶은 교내 활동을 선택해주세요</label>
                        <div class="activity-checkbox-grid">
                            <div class="activity-checkbox-item" data-activity="club">
                                <input type="checkbox" value="자율동아리" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="2"/>
                                        <circle cx="9" cy="7" r="4" stroke-width="2"/>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke-width="2"/>
                                    </svg>
                                    자율동아리
                                </span>
                            </div>

                            <div class="activity-checkbox-item" data-activity="council">
                                <input type="checkbox" value="학생회" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke-width="2"/>
                                    </svg>
                                    학생회
                                </span>
                            </div>

                            <div class="activity-checkbox-item" data-activity="mentoring">
                                <input type="checkbox" value="멘토링" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M22 10v6M2 10l10-5 10 5-10 5z" stroke-width="2"/>
                                        <path d="M6 12v5c3 3 9 3 12 0v-5" stroke-width="2"/>
                                    </svg>
                                    멘토링
                                </span>
                            </div>

                            <div class="activity-checkbox-item" data-activity="volunteer">
                                <input type="checkbox" value="봉사활동" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke-width="2"/>
                                    </svg>
                                    봉사활동
                                </span>
                            </div>

                            <div class="activity-checkbox-item" data-activity="career">
                                <input type="checkbox" value="진로탐색" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="11" cy="11" r="8" stroke-width="2"/>
                                        <path d="m21 21-4.35-4.35" stroke-width="2"/>
                                    </svg>
                                    진로탐색
                                </span>
                            </div>

                            <div class="activity-checkbox-item" data-activity="research">
                                <input type="checkbox" value="과제연구" class="activity-checkbox">
                                <span class="checkbox-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-width="2"/>
                                        <polyline points="14 2 14 8 20 8" stroke-width="2"/>
                                        <line x1="16" y1="13" x2="8" y2="13" stroke-width="2"/>
                                        <line x1="16" y1="17" x2="8" y2="17" stroke-width="2"/>
                                    </svg>
                                    과제연구
                                </span>
                            </div>
                        </div>

                        <!-- 각 활동별 상세 입력 필드 -->
                        <div id="activityDetails" style="margin-top: 20px;">
                            <div class="activity-detail-box" id="detail-club" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('club')">✕</button>
                                <label>자율동아리 활동 내용</label>
                                <textarea rows="3" placeholder="예: 과학탐구동아리에서 환경 실험 진행"></textarea>
                            </div>
                            <div class="activity-detail-box" id="detail-council" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('council')">✕</button>
                                <label>학생회 활동 내용</label>
                                <textarea rows="3" placeholder="예: 학급 회장으로 학급 행사 기획 및 운영"></textarea>
                            </div>
                            <div class="activity-detail-box" id="detail-mentoring" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('mentoring')">✕</button>
                                <label>멘토링 활동 내용</label>
                                <textarea rows="3" placeholder="예: 수학 멘토링 - 후배 학생 대상 수학 학습 지도"></textarea>
                            </div>
                            <div class="activity-detail-box" id="detail-volunteer" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('volunteer')">✕</button>
                                <label>봉사활동 내용</label>
                                <textarea rows="3" placeholder="예: 지역 아동센터 학습 멘토링 봉사"></textarea>
                            </div>
                            <div class="activity-detail-box" id="detail-career" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('career')">✕</button>
                                <label>진로탐색 활동 내용</label>
                                <textarea rows="3" placeholder="예: 대학 전공 체험 프로그램 참여, 진로 특강 수강"></textarea>
                            </div>
                            <div class="activity-detail-box" id="detail-research" style="display: none;">
                                <button type="button" class="activity-detail-close-btn" onclick="closeActivityDetail('research')">✕</button>
                                <label>과제연구 활동 내용</label>
                                <textarea rows="3" placeholder="예: 인공지능 알고리즘 연구 프로젝트 수행"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>추가 희망사항</label>
                        <textarea id="additionalNotes" rows="3" placeholder="로드맵 생성 시 고려했으면 하는 사항을 자유롭게 입력하세요"></textarea>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="generate-btn" onclick="generateRoadmap()">🎯 로드맵 생성하기</button>
                    <button type="button" class="prev-step-btn" onclick="goToPrevStep(2)">← 이전 단계</button>
                </div>
            </div>
        </div>

        <!-- Result Container -->
        <div id="resultContainer" class="document-container" style="display: none; margin: 40px auto; max-width: 95%;">
            <!-- 결과가 여기에 동적으로 추가됨 -->
        </div>

        <!-- 인쇄/PDF 버튼 -->
        <button id="printPdfBtn" class="print-pdf-btn" style="display: none;" onclick="openPrintModal()">
            📄 PDF로 저장
        </button>

        <!-- 인쇄 모달 -->
        <div id="printModal" class="print-modal-overlay" onclick="closePrintModal()">
            <div class="print-modal" onclick="event.stopPropagation()">
                <h3>📄 로드맵 저장하기</h3>
                <p>생성된 로드맵을 PDF로 저장하거나 인쇄할 수 있습니다.<br>헤더와 푸터 없이 깔끔한 보고서 형식으로 출력됩니다.</p>
                <div class="print-modal-buttons">
                    <button class="modal-btn modal-btn-primary" onclick="printReport()">
                        🖨️ 인쇄/PDF 저장
                    </button>
                    <button class="modal-btn modal-btn-secondary" onclick="closePrintModal()">
                        취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action" id="floatingAction" style="display: none;">
        <button class="floating-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="맨 위로">
            ↑
        </button>
    </div>

    <script>
        // 학과/전공 데이터
        const departmentData = {
            "인문계열": [
                "국어국문학과", "영어영문학과", "중어중문학과", "일어일문학과",
                "불어불문학과", "독어독문학과", "러시아어과", "스페인어과",
                "철학과", "사학과", "고고학과", "문헌정보학과"
            ],
            "사회계열": [
                "경영학과", "경제학과", "무역학과", "회계학과",
                "행정학과", "정치외교학과", "사회학과", "심리학과",
                "신문방송학과", "광고홍보학과", "사회복지학과"
            ],
            "교육계열": [
                "교육학과", "국어교육과", "영어교육과", "수학교육과",
                "과학교육과", "사회교육과", "체육교육과", "음악교육과",
                "미술교육과", "유아교육과", "특수교육과"
            ],
            "공학계열": [
                "컴퓨터공학과", "소프트웨어학과", "전기공학과", "전자공학과",
                "기계공학과", "화학공학과", "건축학과", "토목공학과",
                "산업공학과", "신소재공학과", "항공우주공학과", "조선해양공학과"
            ],
            "자연계열": [
                "수학과", "물리학과", "화학과", "생명과학과",
                "지구환경과학과", "천문학과", "통계학과", "해양학과"
            ],
            "의약계열": [
                "의예과", "치의예과", "한의예과", "약학과",
                "간호학과", "수의예과", "물리치료학과", "임상병리학과"
            ],
            "예체능계열": [
                "디자인학과", "시각디자인과", "산업디자인과", "패션디자인과",
                "음악과", "미술학과", "체육학과", "무용과",
                "영화영상학과", "연극영화과", "실용음악과"
            ]
        };

        // 전국 고등학교 데이터베이스 (나이스 교육정보 개방 포털 기반)
        const schoolDatabase = [
            // 서울
            { name: "서울고등학교", region: "서울", type: "일반고" },
            { name: "경기고등학교", region: "서울", type: "일반고" },
            { name: "중동고등학교", region: "서울", type: "일반고" },
            { name: "휘문고등학교", region: "서울", type: "일반고" },
            { name: "보인고등학교", region: "서울", type: "일반고" },
            { name: "서울과학고등학교", region: "서울", type: "과학고" },
            { name: "서울예술고등학교", region: "서울", type: "예술고" },
            { name: "한영외국어고등학교", region: "서울", type: "외국어고" },
            { name: "대원외국어고등학교", region: "서울", type: "외국어고" },
            { name: "명덕외국어고등학교", region: "서울", type: "외국어고" },
            { name: "선덕고등학교", region: "서울", type: "일반고" },
            { name: "중산고등학교", region: "서울", type: "일반고" },
            { name: "용문고등학교", region: "서울", type: "일반고" },
            { name: "동성고등학교", region: "서울", type: "일반고" },
            { name: "선린인터넷고등학교", region: "서울", type: "특성화고" },
            { name: "한영고등학교", region: "서울", type: "일반고" },
            { name: "배재고등학교", region: "서울", type: "일반고" },
            { name: "세화고등학교", region: "서울", type: "일반고" },
            { name: "상문고등학교", region: "서울", type: "일반고" },
            { name: "선정고등학교", region: "서울", type: "일반고" },
            { name: "광문고등학교", region: "서울", type: "일반고" },
            { name: "경동고등학교", region: "서울", type: "일반고" },
            { name: "대광고등학교", region: "서울", type: "일반고" },
            { name: "이화여자고등학교", region: "서울", type: "일반고" },
            { name: "숙명여자고등학교", region: "서울", type: "일반고" },

            // 부산
            { name: "부산고등학교", region: "부산", type: "일반고" },
            { name: "경남고등학교", region: "부산", type: "일반고" },
            { name: "동래고등학교", region: "부산", type: "일반고" },
            { name: "부산일과학고등학교", region: "부산", type: "과학고" },
            { name: "부산외국어고등학교", region: "부산", type: "외국어고" },
            { name: "해운대고등학교", region: "부산", type: "일반고" },
            { name: "금정고등학교", region: "부산", type: "일반고" },
            { name: "개성고등학교", region: "부산", type: "일반고" },
            { name: "브니엘고등학교", region: "부산", type: "일반고" },
            { name: "부산진고등학교", region: "부산", type: "일반고" },

            // 대구
            { name: "대구고등학교", region: "대구", type: "일반고" },
            { name: "경북고등학교", region: "대구", type: "일반고" },
            { name: "경북사대부고", region: "대구", type: "일반고" },
            { name: "대구과학고등학교", region: "대구", type: "과학고" },
            { name: "대구외국어고등학교", region: "대구", type: "외국어고" },
            { name: "심인고등학교", region: "대구", type: "일반고" },
            { name: "포산고등학교", region: "대구", type: "일반고" },
            { name: "경신고등학교", region: "대구", type: "일반고" },

            // 인천
            { name: "인천고등학교", region: "인천", type: "일반고" },
            { name: "제물포고등학교", region: "인천", type: "일반고" },
            { name: "인천과학고등학교", region: "인천", type: "과학고" },
            { name: "인천외국어고등학교", region: "인천", type: "외국어고" },
            { name: "인하대부고", region: "인천", type: "일반고" },
            { name: "송도고등학교", region: "인천", type: "일반고" },
            { name: "부평고등학교", region: "인천", type: "일반고" },

            // 광주
            { name: "광주고등학교", region: "광주", type: "일반고" },
            { name: "숭일고등학교", region: "광주", type: "일반고" },
            { name: "광주과학고등학교", region: "광주", type: "과학고" },
            { name: "광주외국어고등학교", region: "광주", type: "외국어고" },
            { name: "전남여자고등학교", region: "광주", type: "일반고" },
            { name: "살레시오고등학교", region: "광주", type: "일반고" },

            // 대전
            { name: "대전고등학교", region: "대전", type: "일반고" },
            { name: "대전대신고등학교", region: "대전", type: "일반고" },
            { name: "대전과학고등학교", region: "대전", type: "과학고" },
            { name: "대전외국어고등학교", region: "대전", type: "외국어고" },
            { name: "대전둔산고등학교", region: "대전", type: "일반고" },
            { name: "대전용산고등학교", region: "대전", type: "일반고" },
            { name: "충남고등학교", region: "대전", type: "일반고" },

            // 울산
            { name: "울산고등학교", region: "울산", type: "일반고" },
            { name: "현대고등학교", region: "울산", type: "일반고" },
            { name: "울산과학고등학교", region: "울산", type: "과학고" },
            { name: "울산외국어고등학교", region: "울산", type: "외국어고" },
            { name: "학성고등학교", region: "울산", type: "일반고" },

            // 세종
            { name: "세종고등학교", region: "세종", type: "일반고" },
            { name: "한솔고등학교", region: "세종", type: "일반고" },
            { name: "세종과학예술영재학교", region: "세종", type: "과학고" },
            { name: "아름고등학교", region: "세종", type: "일반고" },

            // 경기
            { name: "수원고등학교", region: "경기", type: "일반고" },
            { name: "경기과학고등학교", region: "경기", type: "과학고" },
            { name: "경기외국어고등학교", region: "경기", type: "외국어고" },
            { name: "안양고등학교", region: "경기", type: "일반고" },
            { name: "부천고등학교", region: "경기", type: "일반고" },
            { name: "성남고등학교", region: "경기", type: "일반고" },
            { name: "고양고등학교", region: "경기", type: "일반고" },
            { name: "용인고등학교", region: "경기", type: "일반고" },
            { name: "분당고등학교", region: "경기", type: "일반고" },
            { name: "평촌고등학교", region: "경기", type: "일반고" },
            { name: "민족사관고등학교", region: "경기", type: "자율고" },
            { name: "광교고등학교", region: "경기", type: "일반고" },
            { name: "수원외국어고등학교", region: "경기", type: "외국어고" },
            { name: "백현고등학교", region: "경기", type: "일반고" },
            { name: "동탄고등학교", region: "경기", type: "일반고" },

            // 강원
            { name: "강원고등학교", region: "강원", type: "일반고" },
            { name: "춘천고등학교", region: "강원", type: "일반고" },
            { name: "강원과학고등학교", region: "강원", type: "과학고" },
            { name: "춘천외국어고등학교", region: "강원", type: "외국어고" },
            { name: "원주고등학교", region: "강원", type: "일반고" },
            { name: "강릉고등학교", region: "강원", type: "일반고" },

            // 충북
            { name: "청주고등학교", region: "충북", type: "일반고" },
            { name: "충북과학고등학교", region: "충북", type: "과학고" },
            { name: "청주외국어고등학교", region: "충북", type: "외국어고" },
            { name: "충주고등학교", region: "충북", type: "일반고" },
            { name: "제천고등학교", region: "충북", type: "일반고" },

            // 충남
            { name: "충남고등학교", region: "충남", type: "일반고" },
            { name: "공주고등학교", region: "충남", type: "일반고" },
            { name: "천안고등학교", region: "충남", type: "일반고" },
            { name: "충남과학고등학교", region: "충남", type: "과학고" },
            { name: "한서고등학교", region: "충남", type: "일반고" },
            { name: "아산고등학교", region: "충남", type: "일반고" },

            // 전북
            { name: "전북고등학교", region: "전북", type: "일반고" },
            { name: "전주고등학교", region: "전북", type: "일반고" },
            { name: "전북과학고등학교", region: "전북", type: "과학고" },
            { name: "전주외국어고등학교", region: "전북", type: "외국어고" },
            { name: "군산고등학교", region: "전북", type: "일반고" },
            { name: "익산고등학교", region: "전북", type: "일반고" },

            // 전남
            { name: "전남고등학교", region: "전남", type: "일반고" },
            { name: "목포고등학교", region: "전남", type: "일반고" },
            { name: "전남과학고등학교", region: "전남", type: "과학고" },
            { name: "순천고등학교", region: "전남", type: "일반고" },
            { name: "여수고등학교", region: "전남", type: "일반고" },
            { name: "광양고등학교", region: "전남", type: "일반고" },

            // 경북
            { name: "경북고등학교", region: "경북", type: "일반고" },
            { name: "포항고등학교", region: "경북", type: "일반고" },
            { name: "경북과학고등학교", region: "경북", type: "과학고" },
            { name: "경주고등학교", region: "경북", type: "일반고" },
            { name: "안동고등학교", region: "경북", type: "일반고" },
            { name: "구미고등학교", region: "경북", type: "일반고" },

            // 경남
            { name: "경남고등학교", region: "경남", type: "일반고" },
            { name: "마산고등학교", region: "경남", type: "일반고" },
            { name: "경남과학고등학교", region: "경남", type: "과학고" },
            { name: "진주고등학교", region: "경남", type: "일반고" },
            { name: "창원고등학교", region: "경남", type: "일반고" },
            { name: "김해고등학교", region: "경남", type: "일반고" },

            // 제주
            { name: "제주고등학교", region: "제주", type: "일반고" },
            { name: "제주과학고등학교", region: "제주", type: "과학고" },
            { name: "제주외국어고등학교", region: "제주", type: "외국어고" },
            { name: "남주고등학교", region: "제주", type: "일반고" },
            { name: "제주제일고등학교", region: "제주", type: "일반고" }
        ];

        // localStorage 키
        const STORAGE_KEY = 'roadmapFormData';
        const STEP_KEY = 'roadmapCurrentStep';

        // 추가 과목 관리
        let additionalSubjects = [];
        let subjectIdCounter = 1;  // 1부터 시작 (subject_1이 이미 있으므로)

        // 목표 대학 관리
        let targetUniversities = [];
        let universityIdCounter = 0;

        // 페이지 로드 시 저장된 데이터 복원
        window.addEventListener('DOMContentLoaded', function() {
            // subject_1을 추가 과목 배열에 초기화
            additionalSubjects.push({
                id: 'subject_1',
                name: '',
                grade: ''
            });

            restoreFormData();
            restoreCurrentStep();

            // subject_1의 change 이벤트를 추가 과목 배열과 동기화
            const subject1Name = document.getElementById('subject_1_name');
            const subject1Grade = document.getElementById('subject_1_grade');

            if (subject1Name) {
                subject1Name.addEventListener('change', function() {
                    const subject = additionalSubjects.find(s => s.id === 'subject_1');
                    if (subject) {
                        subject.name = this.value;
                    } else {
                        additionalSubjects.push({
                            id: 'subject_1',
                            name: this.value,
                            grade: document.getElementById('subject_1_grade').value || ''
                        });
                    }
                    saveFormData();
                });
            }

            if (subject1Grade) {
                subject1Grade.addEventListener('change', function() {
                    const subject = additionalSubjects.find(s => s.id === 'subject_1');
                    if (subject) {
                        subject.grade = this.value;
                    } else {
                        additionalSubjects.push({
                            id: 'subject_1',
                            name: document.getElementById('subject_1_name').value || '',
                            grade: this.value
                        });
                    }
                    saveFormData();
                });
            }
        });

        // 과목 추가 함수
        function addSubject() {
            const subjectId = `subject_${++subjectIdCounter}`;
            const container = document.getElementById('additionalSubjectsContainer');

            const subjectRow = document.createElement('div');
            subjectRow.className = 'additional-subject-row';
            subjectRow.id = subjectId;

            subjectRow.innerHTML = `
                <div class="form-group">
                    <label>과목명</label>
                    <input type="text"
                           id="${subjectId}_name"
                           placeholder="과목명을 입력하세요"
                           onchange="saveFormData()">
                </div>
                <div class="form-group">
                    <label>등급</label>
                    <select id="${subjectId}_grade" onchange="saveFormData()">
                        <option value="">선택</option>
                        <option value="1">1등급</option>
                        <option value="2">2등급</option>
                        <option value="3">3등급</option>
                        <option value="4">4등급</option>
                        <option value="5">5등급</option>
                        <option value="6">6등급</option>
                        <option value="7">7등급</option>
                        <option value="8">8등급</option>
                        <option value="9">9등급</option>
                    </select>
                </div>
                <button type="button" class="delete-subject-btn" onclick="removeSubject('${subjectId}')">
                    ✕
                </button>
            `;

            container.appendChild(subjectRow);

            // 추가된 과목을 배열에 저장
            additionalSubjects.push({
                id: subjectId,
                name: '',
                grade: ''
            });

            saveFormData();
        }

        // 과목 삭제 함수
        function removeSubject(subjectId) {
            const element = document.getElementById(subjectId);
            if (element) {
                element.remove();
                additionalSubjects = additionalSubjects.filter(s => s.id !== subjectId);
                saveFormData();
            }
        }

        // 목표 대학 폼 토글
        function toggleTargetUniversityForm() {
            const selectValue = document.getElementById('targetUniversity').value;
            const container = document.getElementById('targetUniversityFormContainer');

            if (selectValue) {
                container.style.display = 'block';
                // 초기에 대학이 하나도 없으면 자동으로 하나 추가
                if (targetUniversities.length === 0) {
                    addTargetUniversity();
                }
            } else {
                container.style.display = 'none';
            }
            saveFormData();
        }

        // 목표 대학 추가 함수
        function addTargetUniversity() {
            const universityId = `university_${++universityIdCounter}`;
            const container = document.getElementById('targetUniversitiesContainer');
            const universityRow = document.createElement('div');
            universityRow.className = 'target-university-row';
            universityRow.id = universityId;

            universityRow.innerHTML = `
                <div class="form-group university-autocomplete">
                    <label>대학교명</label>
                    <input type="text"
                           id="${universityId}_name"
                           class="university-input"
                           placeholder="대학교명을 입력하세요"
                           autocomplete="off"
                           onchange="saveFormData()">
                    <div class="university-suggestions" id="${universityId}_suggestions"></div>
                </div>
                <div class="form-group">
                    <label>전공/학과</label>
                    <input type="text"
                           id="${universityId}_major"
                           placeholder="예: 컴퓨터공학과"
                           onchange="saveFormData()">
                </div>
                <button type="button" class="delete-university-btn" onclick="removeTargetUniversity('${universityId}')">
                    ✕
                </button>
            `;

            container.appendChild(universityRow);

            // 자동완성 이벤트 리스너 추가
            setTimeout(() => {
                setupUniversityAutocomplete(universityId);
            }, 0);

            // 추가된 대학을 배열에 저장
            targetUniversities.push({
                id: universityId,
                name: '',
                major: ''
            });

            saveFormData();
        }

        // 목표 대학 삭제 함수
        function removeTargetUniversity(universityId) {
            const element = document.getElementById(universityId);
            if (element) {
                element.remove();
                targetUniversities = targetUniversities.filter(u => u.id !== universityId);
                saveFormData();
            }
        }

        // 폼 데이터 저장
        function saveFormData() {
            // 추가 과목 데이터 업데이트
            additionalSubjects = additionalSubjects.map(subject => {
                const nameInput = document.getElementById(`${subject.id}_name`);
                const gradeSelect = document.getElementById(`${subject.id}_grade`);
                if (nameInput && gradeSelect) {
                    return {
                        id: subject.id,
                        name: nameInput.value,
                        grade: gradeSelect.value
                    };
                }
                return subject;
            });

            // 목표 대학 데이터 업데이트
            targetUniversities = targetUniversities.map(university => {
                const nameInput = document.getElementById(`${university.id}_name`);
                const majorInput = document.getElementById(`${university.id}_major`);
                if (nameInput && majorInput) {
                    return {
                        id: university.id,
                        name: nameInput.value,
                        major: majorInput.value
                    };
                }
                return university;
            });

            const formData = {
                // Step 1
                studentName: document.getElementById('studentName').value,
                currentGrade: document.getElementById('currentGrade').value,
                schoolName: document.getElementById('schoolName').value,
                department: document.getElementById('department').value,
                keywords: document.getElementById('keywords').value,

                // Step 2
                koreanGrade: document.getElementById('koreanGrade').value,
                englishGrade: document.getElementById('englishGrade').value,
                mathGrade: document.getElementById('mathGrade').value,
                targetGrade: document.getElementById('targetGrade').value,
                targetUniversity: document.getElementById('targetUniversity').value,

                // 추가 과목
                additionalSubjects: additionalSubjects,

                // 목표 대학 리스트
                targetUniversities: targetUniversities,

                // Step 3
                currentActivities: document.getElementById('currentActivities').value,
                awards: document.getElementById('awards').value,
                reading: document.getElementById('reading').value,
                additionalNotes: document.getElementById('additionalNotes').value,

                // 체크박스
                interests: Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.value)
            };

            localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
        }

        // 폼 데이터 복원
        function restoreFormData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (!savedData) return;

            try {
                const formData = JSON.parse(savedData);

                // 데이터 마이그레이션: scienceGrade를 추가 과목으로 변환
                if (formData.scienceGrade && (!formData.additionalSubjects || formData.additionalSubjects.length === 0)) {
                    formData.additionalSubjects = [{
                        id: 'subject_1',
                        name: '탐구 과목',
                        grade: formData.scienceGrade
                    }];
                    delete formData.scienceGrade;
                    // 마이그레이션된 데이터 저장
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
                }

                // Step 1
                if (formData.studentName) document.getElementById('studentName').value = formData.studentName;
                if (formData.currentGrade) document.getElementById('currentGrade').value = formData.currentGrade;
                if (formData.schoolName) document.getElementById('schoolName').value = formData.schoolName;
                if (formData.department) document.getElementById('department').value = formData.department;
                if (formData.keywords) document.getElementById('keywords').value = formData.keywords;

                // Step 2
                if (formData.koreanGrade) document.getElementById('koreanGrade').value = formData.koreanGrade;
                if (formData.englishGrade) document.getElementById('englishGrade').value = formData.englishGrade;
                if (formData.mathGrade) document.getElementById('mathGrade').value = formData.mathGrade;
                if (formData.targetGrade) document.getElementById('targetGrade').value = formData.targetGrade;
                if (formData.targetUniversity) document.getElementById('targetUniversity').value = formData.targetUniversity;

                // 추가 과목 복원
                if (formData.additionalSubjects && Array.isArray(formData.additionalSubjects)) {
                    const container = document.getElementById('additionalSubjectsContainer');
                    container.innerHTML = ''; // 기존 내용 초기화
                    additionalSubjects = []; // 배열 초기화

                    formData.additionalSubjects.forEach(subject => {
                        const subjectId = subject.id || `subject_${++subjectIdCounter}`;
                        const subjectRow = document.createElement('div');
                        subjectRow.className = 'additional-subject-row';
                        subjectRow.id = subjectId;

                        subjectRow.innerHTML = `
                            <div class="form-group">
                                <label>과목명</label>
                                <input type="text"
                                       id="${subjectId}_name"
                                       value="${subject.name || ''}"
                                       placeholder="과목명을 입력하세요"
                                       onchange="saveFormData()">
                            </div>
                            <div class="form-group">
                                <label>등급</label>
                                <select id="${subjectId}_grade" onchange="saveFormData()">
                                    <option value="">선택</option>
                                    <option value="1" ${subject.grade === '1' ? 'selected' : ''}>1등급</option>
                                    <option value="2" ${subject.grade === '2' ? 'selected' : ''}>2등급</option>
                                    <option value="3" ${subject.grade === '3' ? 'selected' : ''}>3등급</option>
                                    <option value="4" ${subject.grade === '4' ? 'selected' : ''}>4등급</option>
                                    <option value="5" ${subject.grade === '5' ? 'selected' : ''}>5등급</option>
                                    <option value="6" ${subject.grade === '6' ? 'selected' : ''}>6등급</option>
                                    <option value="7" ${subject.grade === '7' ? 'selected' : ''}>7등급</option>
                                    <option value="8" ${subject.grade === '8' ? 'selected' : ''}>8등급</option>
                                    <option value="9" ${subject.grade === '9' ? 'selected' : ''}>9등급</option>
                                </select>
                            </div>
                            <button type="button" class="delete-subject-btn" onclick="removeSubject('${subjectId}')">
                                ✕
                            </button>
                        `;

                        container.appendChild(subjectRow);
                        additionalSubjects.push({
                            id: subjectId,
                            name: subject.name || '',
                            grade: subject.grade || ''
                        });
                    });
                }

                // 목표 대학 복원
                if (formData.targetUniversities && Array.isArray(formData.targetUniversities)) {
                    // targetUniversity select가 값이 있으면 폼 표시
                    if (formData.targetUniversity) {
                        document.getElementById('targetUniversityFormContainer').style.display = 'block';
                    }

                    const container = document.getElementById('targetUniversitiesContainer');
                    container.innerHTML = ''; // 기존 내용 초기화
                    targetUniversities = []; // 배열 초기화

                    formData.targetUniversities.forEach(university => {
                        const universityId = university.id || `university_${++universityIdCounter}`;
                        const universityRow = document.createElement('div');
                        universityRow.className = 'target-university-row';
                        universityRow.id = universityId;

                        universityRow.innerHTML = `
                            <div class="form-group university-autocomplete">
                                <label>대학교명</label>
                                <input type="text"
                                       id="${universityId}_name"
                                       class="university-input"
                                       value="${university.name || ''}"
                                       placeholder="대학교명을 입력하세요"
                                       autocomplete="off"
                                       onchange="saveFormData()">
                                <div class="university-suggestions" id="${universityId}_suggestions"></div>
                            </div>
                            <div class="form-group">
                                <label>전공/학과</label>
                                <input type="text"
                                       id="${universityId}_major"
                                       value="${university.major || ''}"
                                       placeholder="예: 컴퓨터공학과"
                                       onchange="saveFormData()">
                            </div>
                            <button type="button" class="delete-university-btn" onclick="removeTargetUniversity('${universityId}')">
                                ✕
                            </button>
                        `;

                        container.appendChild(universityRow);
                        targetUniversities.push(university);

                        // 자동완성 이벤트 리스너 추가
                        setTimeout(() => {
                            setupUniversityAutocomplete(universityId);
                        }, 0);
                    });
                }

                // Step 3
                if (formData.currentActivities) document.getElementById('currentActivities').value = formData.currentActivities;
                if (formData.awards) document.getElementById('awards').value = formData.awards;
                if (formData.reading) document.getElementById('reading').value = formData.reading;
                if (formData.additionalNotes) document.getElementById('additionalNotes').value = formData.additionalNotes;

                // 체크박스
                if (formData.interests && Array.isArray(formData.interests)) {
                    formData.interests.forEach(value => {
                        const checkbox = document.querySelector(`input[type="checkbox"][value="${value}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            } catch (e) {
                console.error('Failed to restore form data:', e);
            }
        }

        // 현재 단계 저장
        function saveCurrentStep(step) {
            localStorage.setItem(STEP_KEY, step);
        }

        // 현재 단계 복원
        function restoreCurrentStep() {
            const savedStep = localStorage.getItem(STEP_KEY);
            if (savedStep) {
                const stepNumber = parseInt(savedStep);
                if (stepNumber > 1 && stepNumber <= 3) {
                    // 저장된 단계로 이동
                    showStep(stepNumber);
                    updateProgress(stepNumber);
                }
            }
        }

        // 입력 필드에 이벤트 리스너 추가 (자동 저장)
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('change', saveFormData);
            element.addEventListener('input', saveFormData);
        });

        // Show/Hide Department Suggestions
        function showAllDepartments() {
            const suggestionsDiv = document.getElementById('departmentSuggestions');
            let html = '<div class="department-chips">';

            for (const [category, departments] of Object.entries(departmentData)) {
                html += `
                    <div class="department-category">
                        <div class="department-category-title">${category}</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                `;
                departments.forEach(dept => {
                    html += `<div class="department-chip" onclick="selectDepartment('${dept}')">${dept}</div>`;
                });
                html += `
                        </div>
                    </div>
                `;
            }
            html += '</div>';

            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
        }

        // 학교명 토글 방식 추가
        function showAllSchools() {
            const suggestionsDiv = document.getElementById('schoolSuggestions');

            // 지역별로 그룹화
            const regions = [...new Set(schoolDatabase.map(s => s.region))];

            let html = '<div class="department-chips" style="padding: 15px;">';

            regions.forEach(region => {
                const schoolsInRegion = schoolDatabase.filter(s => s.region === region);
                if (schoolsInRegion.length > 0) {
                    html += `<div class="department-category" style="margin-bottom: 15px;">`;
                    html += `<div class="department-category-title">${region}</div>`;
                    html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';

                    schoolsInRegion.forEach(school => {
                        html += `<div class="department-chip" onclick="selectSchoolFromList('${school.name}')">${school.name}</div>`;
                    });

                    html += '</div></div>';
                }
            });

            html += '<div style="padding: 10px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #e5e7eb; margin-top: 10px;">원하는 학교가 없으면 직접 입력하세요</div>';
            html += '</div>';

            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
        }

        function selectSchoolFromList(schoolName) {
            document.getElementById('schoolName').value = schoolName;
            document.getElementById('schoolSuggestions').style.display = 'none';
            saveFormData(); // 자동 저장
        }

        function searchDepartment(value) {
            const suggestionsDiv = document.getElementById('departmentSuggestions');

            if (!value) {
                showAllDepartments();
                return;
            }

            const searchTerm = value.toLowerCase();
            let html = '<div class="department-chips">';
            let hasResults = false;

            for (const [category, departments] of Object.entries(departmentData)) {
                const filtered = departments.filter(dept =>
                    dept.toLowerCase().includes(searchTerm)
                );

                if (filtered.length > 0) {
                    hasResults = true;
                    html += `
                        <div class="department-category">
                            <div class="department-category-title">${category}</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    `;
                    filtered.forEach(dept => {
                        html += `<div class="department-chip" onclick="selectDepartment('${dept}')">${dept}</div>`;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                }
            }

            if (!hasResults) {
                html += '<div style="padding: 20px; text-align: center; color: #666;">검색 결과가 없습니다</div>';
            }

            html += '</div>';
            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
        }

        function selectDepartment(dept) {
            document.getElementById('department').value = dept;
            document.getElementById('departmentSuggestions').style.display = 'none';
            saveFormData(); // 자동 저장
        }

        // 학교 검색 함수 (나이스 API 연동)
        let searchSchoolTimeout = null;
        async function searchSchool(value) {
            const suggestionsDiv = document.getElementById('schoolSuggestions');

            if (!value || value.trim() === '') {
                showAllSchools();
                return;
            }

            // 디바운싱: 0.3초 후 검색 실행
            clearTimeout(searchSchoolTimeout);

            // 로딩 표시
            suggestionsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #ca8a04;"><span style="font-size: 1.2em;">🔍</span> 학교 검색 중...</div>';
            suggestionsDiv.style.display = 'block';

            searchSchoolTimeout = setTimeout(async () => {
                try {
                    // 나이스 API 호출
                    const response = await fetch(`http://localhost:3000/api/school/search?name=${encodeURIComponent(value)}`);
                    const result = await response.json();

                    if (result.success && result.data && result.data.length > 0) {
                        displaySchoolResults(result.data);
                    } else {
                        // API 결과가 없으면 로컬 데이터베이스에서 검색
                        searchSchoolFromLocal(value);
                    }
                } catch (error) {
                    console.error('학교 검색 API 에러:', error);
                    // API 에러 시 로컬 데이터베이스로 폴백
                    searchSchoolFromLocal(value);
                }
            }, 300);
        }

        // 나이스 API 결과 표시
        function displaySchoolResults(schools) {
            const suggestionsDiv = document.getElementById('schoolSuggestions');

            // 시도교육청별로 그룹화
            const regionGroups = {};
            const regionCodeMap = {
                'B10': '서울', 'C10': '부산', 'D10': '대구', 'E10': '인천',
                'F10': '광주', 'G10': '대전', 'H10': '울산', 'I10': '세종',
                'J10': '경기', 'K10': '강원', 'M10': '충북', 'N10': '충남',
                'P10': '전북', 'Q10': '전남', 'R10': '경북', 'S10': '경남', 'T10': '제주'
            };

            schools.forEach(school => {
                const regionName = regionCodeMap[school.ATPT_OFCDC_SC_CODE] || school.LCTN_SC_NM || '기타';
                if (!regionGroups[regionName]) {
                    regionGroups[regionName] = [];
                }
                regionGroups[regionName].push(school);
            });

            let html = '<div class="department-chips" style="padding: 15px;">';

            // 지역별로 표시
            for (const [region, schoolList] of Object.entries(regionGroups)) {
                html += `<div class="department-category" style="margin-bottom: 15px;">`;
                html += `<div class="department-category-title">${region}</div>`;
                html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';

                schoolList.forEach(school => {
                    const schoolName = school.SCHUL_NM;
                    const schoolType = school.SCHUL_KND_SC_NM || '';
                    const displayText = `${schoolName} ${schoolType ? `(${schoolType})` : ''}`;

                    html += `<div class="department-chip" onclick="selectSchoolFromAPI('${schoolName.replace(/'/g, "\\'")}', '${school.ATPT_OFCDC_SC_CODE}', '${school.SD_SCHUL_CODE}')" title="${school.ORG_RDNMA || ''}">${displayText}</div>`;
                });

                html += '</div></div>';
            }

            html += `<div style="padding: 10px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #e5e7eb; margin-top: 10px;">
                        총 ${schools.length}개 학교 | 원하는 학교가 없으면 직접 입력하세요
                     </div>`;
            html += '</div>';

            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
        }

        // API에서 선택한 학교 정보 저장
        function selectSchoolFromAPI(schoolName, regionCode, schoolCode) {
            const schoolInput = document.getElementById('schoolName');
            const schoolInfo = document.getElementById('schoolInfo');

            schoolInput.value = schoolName;

            // 학교 정보 표시
            schoolInfo.innerHTML = `<span style="color: #16a34a;">✓</span> 선택됨 (코드: ${schoolCode})`;

            // 학교 코드 정보 저장 (숨김 필드에)
            schoolInput.setAttribute('data-region-code', regionCode);
            schoolInput.setAttribute('data-school-code', schoolCode);

            document.getElementById('schoolSuggestions').style.display = 'none';
            saveFormData();
        }

        // 로컬 데이터베이스에서 검색 (폴백용)
        function searchSchoolFromLocal(value) {
            const suggestionsDiv = document.getElementById('schoolSuggestions');
            const searchTerm = value.toLowerCase();
            const filtered = schoolDatabase.filter(school =>
                school.name.toLowerCase().includes(searchTerm)
            );

            if (filtered.length > 0) {
                // 지역별로 그룹화
                const regionGroups = {};
                filtered.forEach(school => {
                    if (!regionGroups[school.region]) {
                        regionGroups[school.region] = [];
                    }
                    regionGroups[school.region].push(school);
                });

                let html = '<div class="department-chips" style="padding: 15px;">';
                html += '<div style="padding: 10px; background: #fef3c7; border-radius: 8px; margin-bottom: 15px; font-size: 0.85em; color: #92400e;">⚠️ API 연결 실패 - 로컬 데이터베이스 사용 중</div>';

                // 지역별로 표시
                for (const [region, schools] of Object.entries(regionGroups)) {
                    html += `<div class="department-category" style="margin-bottom: 15px;">`;
                    html += `<div class="department-category-title">${region}</div>`;
                    html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';

                    schools.forEach(school => {
                        html += `<div class="department-chip" onclick="selectSchoolFromList('${school.name}')">${school.name}</div>`;
                    });

                    html += '</div></div>';
                }

                html += '<div style="padding: 10px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #e5e7eb; margin-top: 10px;">원하는 학교가 없으면 직접 입력하세요</div>';
                html += '</div>';

                suggestionsDiv.innerHTML = html;
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">검색 결과가 없습니다<br><small style="display: block; margin-top: 8px;">원하는 학교명을 직접 입력하세요</small></div>';
                suggestionsDiv.style.display = 'block';
            }
        }

        // Navigation functions
        function goToNextStep(nextStep) {
            saveFormData(); // 저장
            showStep(nextStep);
            updateProgress(nextStep);
            saveCurrentStep(nextStep); // 현재 단계 저장
        }

        function goToPrevStep(prevStep) {
            saveFormData(); // 저장
            showStep(prevStep);
            updateProgress(prevStep);
            saveCurrentStep(prevStep); // 현재 단계 저장
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active');
            });

            // Show selected step
            document.getElementById(`stepCard${step}`).classList.add('active');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgress(step) {
            // Update progress indicators
            for (let i = 1; i <= 3; i++) {
                const progressStep = document.getElementById(`progress${i}`);
                if (i < step) {
                    progressStep.classList.add('completed');
                    progressStep.classList.remove('active');
                } else if (i === step) {
                    progressStep.classList.add('active');
                    progressStep.classList.remove('completed');
                } else {
                    progressStep.classList.remove('active', 'completed');
                }
            }
        }

        // Collect form data
        function collectFormData() {
            const interests = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            // 추가 과목 데이터 수집
            const additionalGrades = {};
            additionalSubjects.forEach(subject => {
                const nameInput = document.getElementById(`${subject.id}_name`);
                const gradeSelect = document.getElementById(`${subject.id}_grade`);
                if (nameInput && gradeSelect && nameInput.value && gradeSelect.value) {
                    additionalGrades[nameInput.value] = gradeSelect.value;
                }
            });

            // 목표 대학 리스트 수집
            const targetUniversitiesList = [];
            targetUniversities.forEach(university => {
                const nameInput = document.getElementById(`${university.id}_name`);
                const majorInput = document.getElementById(`${university.id}_major`);
                if (nameInput && majorInput && (nameInput.value || majorInput.value)) {
                    targetUniversitiesList.push({
                        name: nameInput.value,
                        major: majorInput.value
                    });
                }
            });

            return {
                // 기본 정보
                name: document.getElementById('studentName').value || '학생',
                grade: document.getElementById('currentGrade').value,
                schoolName: document.getElementById('schoolName').value || '학교',

                // 희망 진로
                department: document.getElementById('department').value || '미정',
                keywords: document.getElementById('keywords').value,

                // 성적 정보
                grades: {
                    korean: document.getElementById('koreanGrade').value,
                    english: document.getElementById('englishGrade').value,
                    math: document.getElementById('mathGrade').value,
                    additional: additionalGrades  // 추가 과목
                },

                // 목표
                targets: {
                    grade: document.getElementById('targetGrade').value,
                    university: document.getElementById('targetUniversity').value,
                    universities: targetUniversitiesList  // 구체적인 대학 리스트
                },

                // 활동
                activities: {
                    current: document.getElementById('currentActivities').value,
                    awards: document.getElementById('awards').value,
                    reading: document.getElementById('reading').value,
                    interests: interests,
                    additional: document.getElementById('additionalNotes').value
                }
            };
        }

        // Validate form
        function validateForm(data) {
            const errors = [];

            if (!data.name.trim()) errors.push('학생 이름을 입력해주세요');
            if (!data.schoolName.trim()) errors.push('학교명을 입력해주세요');

            // 국영수 필수 입력 확인
            if (!data.grades.korean) errors.push('국어 성적을 입력해주세요');
            if (!data.grades.english) errors.push('영어 성적을 입력해주세요');
            if (!data.grades.math) errors.push('수학 성적을 입력해주세요');

            // 추가 과목 유효성 검사
            additionalSubjects.forEach(subject => {
                const nameInput = document.getElementById(`${subject.id}_name`);
                const gradeSelect = document.getElementById(`${subject.id}_grade`);
                if (nameInput && gradeSelect) {
                    if (nameInput.value && !gradeSelect.value) {
                        errors.push(`${nameInput.value} 과목의 등급을 선택해주세요`);
                    } else if (!nameInput.value && gradeSelect.value) {
                        errors.push('추가된 과목의 이름을 입력해주세요');
                    }
                }
            });

            // 목표 대학 유효성 검사
            targetUniversities.forEach(university => {
                const nameInput = document.getElementById(`${university.id}_name`);
                const majorInput = document.getElementById(`${university.id}_major`);
                if (nameInput && majorInput) {
                    if (nameInput.value && !majorInput.value) {
                        errors.push(`${nameInput.value}의 전공/학과를 입력해주세요`);
                    } else if (!nameInput.value && majorInput.value) {
                        errors.push(`${majorInput.value} 전공의 대학명을 입력해주세요`);
                    }
                }
            });

            return errors;
        }

        // Generate roadmap
        async function generateRoadmap() {
            const data = collectFormData();
            const errors = validateForm(data);

            if (errors.length > 0) {
                alert('입력 확인:\n\n' + errors.join('\n'));
                return;
            }

            saveFormData(); // 최종 저장

            // Hide form and show loading
            document.querySelectorAll('.step-card').forEach(card => {
                card.style.display = 'none';
            });
            document.querySelector('.progress-steps').style.display = 'none';

            // Show result container with loading
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.style.display = 'block';

            // 전체 화면 오버레이 로딩 표시
            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="loading-message">
                        맞춤형 로드맵을 생성하고 있습니다<span class="typing-cursor"></span>
                    </div>
                </div>
            `;
            document.body.appendChild(loadingOverlay);

            // Simulate loading
            setTimeout(() => {
                // 로딩 오버레이 제거
                const loadingEl = document.querySelector('.loading-overlay');
                if (loadingEl) {
                    loadingEl.remove();
                }

                displayResults(data);
                // 결과 생성 후 localStorage 클리어 (선택사항)
                // localStorage.removeItem(STORAGE_KEY);
                // localStorage.removeItem(STEP_KEY);
            }, 2000);
        }

        // Display results
        function displayResults(data) {
            const resultContainer = document.getElementById('resultContainer');

            // Calculate current average - 추가 과목 포함
            const grades = [
                parseInt(data.grades.korean) || 5,
                parseInt(data.grades.english) || 5,
                parseInt(data.grades.math) || 5,
                parseInt(data.grades.science) || 5
            ];

            // 추가 과목 점수 포함
            if (data.grades.additional) {
                Object.values(data.grades.additional).forEach(grade => {
                    if (grade) grades.push(parseInt(grade));
                });
            }

            const currentAvg = (grades.reduce((a, b) => a + b, 0) / grades.length).toFixed(1);

            // Generate recommendations based on target university
            const universityRecommendations = getUniversityRecommendations(data.targets.university, currentAvg, data.department);

            // Create result HTML
            let html = `
                <div class="document-header">
                    <div class="document-title">${data.name} 학생 맞춤형 입시 로드맵</div>
                    <div class="document-subtitle">2024-2025 학생부 종합전형 대비 전략</div>
                    <div class="document-meta">
                        <div class="meta-item">
                            <span>📅 생성일: ${new Date().toLocaleDateString('ko-KR')}</span>
                        </div>
                        <div class="meta-item">
                            <span>🎯 목표: ${data.targets.university}</span>
                        </div>
                    </div>
                </div>

                <div class="document-body">
                    <!-- 학생 정보 요약 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">📋</span>
                            학생 정보 요약
                        </div>
                        <div class="info-cards">
                            <div class="info-card">
                                <div class="info-card-label">현재 학년</div>
                                <div class="info-card-value">고등학교 ${data.grade}학년</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-label">희망 전공</div>
                                <div class="info-card-value">${data.department}</div>
                            </div>
                            <div class="info-card">
                                <div class="info-card-label">현재 평균 등급</div>
                                <div class="info-card-value">${currentAvg}등급</div>
                            </div>
                        </div>

                        <!-- 입시 전문가 분석 -->
                        <div class="expert-analysis-box">
                            <div class="expert-analysis-header">
                                <span class="expert-badge">🎓 입시 전문가 분석</span>
                                <span style="color: #64748b; font-size: 0.9em;">실시간 분석 중...</span>
                            </div>
                            <div id="expertAnalysisText" class="analysis-text" data-full-text="${generateExpertAnalysis(data, currentAvg).replace(/"/g, '&quot;')}">
                                <!-- 타이핑 효과를 위해 초기에는 비어있음 -->
                            </div>
                        </div>
                    </div>

                    <!-- 성적 분석 및 시각화 통합 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">📊</span>
                            성적 분석 및 향상 전략
                        </div>
                        <table class="grade-table-with-chart">
                            <thead>
                                <tr>
                                    <th>과목</th>
                                    <th>현재 등급</th>
                                    <th>목표 등급</th>
                                    <th>필요 향상</th>
                                    <th>상태</th>
                                    <th style="width: 40%;">성적 현황 및 향상 전략</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generateIntegratedGradeRows(data)}
                            </tbody>
                        </table>
                    </div>

                    <!-- 목표 대학 vs 추천 대학 통합 비교 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">🎯</span>
                            목표 대학 vs 추천 대학 통합 비교 분석
                        </div>
                        <div class="university-comparison-container">
                            ${generateUnifiedUniversityComparison(data, currentAvg, universityRecommendations)}
                        </div>
                    </div>

                    <!-- 통합 활동 로드맵 및 실행 계획 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">🗓️</span>
                            학년별 활동 로드맵 및 실행 계획
                        </div>
                        ${generateIntegratedRoadmap(data)}
                    </div>

                    <!-- 추천 활동 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">💡</span>
                            전공 맞춤 추천 활동
                        </div>
                        ${generateRecommendedActivities(data)}
                    </div>

                    <!-- 독서 추천 -->
                    <div class="section">
                        <div class="section-title">
                            <span class="section-icon">📚</span>
                            전공 관련 추천 도서
                        </div>
                        ${generateBookRecommendations(data.department)}
                    </div>
                </div>
            `;

            resultContainer.innerHTML = html;

            // Show floating action button
            document.getElementById('floatingAction').style.display = 'block';

            // Show print/PDF button
            document.getElementById('printPdfBtn').style.display = 'flex';

            // Start animations immediately after rendering
            requestAnimationFrame(() => {
                simulateStreamingEffect();
            });
        }

        // Helper functions
        function getImprovementStrategy(subject, current, target) {
            const curr = parseInt(current) || 5;
            const tgt = parseInt(target);

            if (curr <= tgt) {
                return `<span class="badge badge-success">우수</span> 현재 수준 유지 및 심화 학습`;
            } else if (curr - tgt === 1) {
                return `<span class="badge badge-warning">향상 필요</span> 주 2회 추가 학습 권장`;
            } else {
                return `<span class="badge badge-danger">집중 관리</span> 집중 보충 학습 필요`;
            }
        }

        // 추가 과목 행 생성 함수
        function generateAdditionalSubjectsRows(additionalGrades, targetGrade) {
            if (!additionalGrades || Object.keys(additionalGrades).length === 0) {
                return '';
            }

            let rows = '';
            for (const [subjectName, grade] of Object.entries(additionalGrades)) {
                rows += `
                    <tr style="background: linear-gradient(135deg, #fffbf7 0%, #fffcf9 100%);">
                        <td><strong>${subjectName}</strong> <span class="badge badge-info" style="font-size: 0.7em;">추가과목</span></td>
                        <td>${grade}등급</td>
                        <td>${targetGrade}등급</td>
                        <td>${getImprovementStrategy(subjectName, grade, targetGrade)}</td>
                    </tr>
                `;
            }
            return rows;
        }

        // 성적 진행도 바 생성 함수
        function generateGradeProgressBars(data) {
            const subjects = [
                { name: '국어', grade: data.grades.korean },
                { name: '영어', grade: data.grades.english },
                { name: '수학', grade: data.grades.math }
            ];

            // 추가 과목 포함
            if (data.grades.additional) {
                for (const [name, grade] of Object.entries(data.grades.additional)) {
                    subjects.push({ name, grade });
                }
            }

            return subjects.map(subject => {
                const grade = parseInt(subject.grade) || 9;
                const percentage = ((10 - grade) / 9 * 100).toFixed(0);
                return `
                    <div class="progress-bar-item">
                        <div class="progress-bar-label">${subject.name}</div>
                        <div class="progress-bar-fill" data-width="${percentage}%" style="width: 0%">
                            <span>${subject.grade}등급</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 입시 전문가 분석 생성 함수 (목업)
        function generateExpertAnalysis(data, currentAvg) {
            const grade = parseInt(data.grade);
            const avg = parseFloat(currentAvg);
            const target = data.targets.university || '목표 대학';
            const department = data.department || '희망 전공';

            let analysis = '';

            // 학년별 분석
            if (grade === 1) {
                analysis += `현재 고1 시점에서 평균 ${currentAvg}등급은 `;
                if (avg <= 2.0) {
                    analysis += '매우 우수한 수준입니다. 이 성적을 유지한다면 서울권 주요 대학 진학이 충분히 가능합니다. ';
                } else if (avg <= 3.5) {
                    analysis += '양호한 수준이며, 꾸준한 향상을 통해 상위권 대학 진학을 목표로 할 수 있습니다. ';
                } else {
                    analysis += '아직 개선의 여지가 많은 시점입니다. 고1은 성적 향상의 골든타임이므로 적극적인 학습 전략이 필요합니다. ';
                }
            } else if (grade === 2) {
                analysis += `고2 단계에서 평균 ${currentAvg}등급은 `;
                if (avg <= 2.0) {
                    analysis += '경쟁력 있는 수준입니다. 이제는 학생부 세특 관리와 전공 적합성 활동에 집중해야 할 시기입니다. ';
                } else if (avg <= 3.5) {
                    analysis += '중상위권 수준으로, 남은 기간 동안 집중적인 성적 관리가 필요합니다. ';
                } else {
                    analysis += '아직 만회 가능한 시기입니다. 고2는 성적 향상의 마지막 기회이므로 체계적인 학습 계획이 시급합니다. ';
                }
            } else {
                analysis += `고3 시점의 평균 ${currentAvg}등급을 고려할 때, `;
                if (avg <= 2.0) {
                    analysis += '우수한 내신 성적을 확보했습니다. 수능 준비와 함께 학생부 마무리에 집중해야 합니다. ';
                } else if (avg <= 3.5) {
                    analysis += '학생부 종합전형보다는 수능 위주 전형을 병행하는 전략이 유리할 수 있습니다. ';
                } else {
                    analysis += '정시 전형에 더 비중을 두고, 수능 집중 전략을 권장합니다. ';
                }
            }

            // 전공 적합성 분석
            analysis += `\n\n${department} 전공의 경우, `;

            if (department.includes('공학') || department.includes('컴퓨터') || department.includes('AI')) {
                analysis += '수학과 과학 성적이 매우 중요합니다. 특히 수학 교과에서 안정적인 1-2등급 유지가 필수적이며, ';
                analysis += '관련 동아리 활동, 탐구 과제, 프로그래밍 경험 등이 전공 적합성을 높여줍니다. ';
            } else if (department.includes('경영') || department.includes('경제')) {
                analysis += '수학 성적과 함께 사회 교과의 우수한 성적이 요구됩니다. 경제 관련 독서 활동과 ';
                analysis += '기업가 정신을 보여줄 수 있는 활동들이 유리하게 작용합니다. ';
            } else if (department.includes('의학') || department.includes('간호') || department.includes('약학')) {
                analysis += '전 과목에서 최상위 등급이 요구되는 매우 경쟁이 치열한 전공입니다. 특히 과학(생명과학, 화학) 교과의 심화 학습과 ';
                analysis += '의료 봉사 활동, 생명과학 관련 탐구 활동이 중요합니다. ';
            } else if (department.includes('교육') || department.includes('사범')) {
                analysis += '안정적인 내신 성적과 함께 교육 봉사 경험이 매우 중요합니다. 멘토링 활동, 교육 봉사, ';
                analysis += '학습법 연구 등의 경험이 전공 적합성을 높여줍니다. ';
            } else {
                analysis += '관련 교과의 우수한 성적과 함께 전공에 대한 명확한 관심과 탐구 활동이 중요합니다. ';
                analysis += '독서 활동, 관련 동아리, 심화 탐구 등을 통해 전공 적합성을 입증해야 합니다. ';
            }

            // 목표 대학 분석
            analysis += `\n\n${target} 진학을 목표로 할 경우, `;

            if (avg <= 1.5) {
                analysis += '현재 성적으로는 충분히 도전 가능한 수준입니다. 학생부 세특의 질적 향상과 전공 연계 활동 강화가 합격 가능성을 높일 것입니다. ';
            } else if (avg <= 2.5) {
                analysis += '적극적인 성적 향상과 함께 차별화된 학생부 관리가 필요합니다. 각 교과별 세특에서 전공 연계성을 강화하고, ';
                analysis += '심화 탐구 활동을 통해 학업 역량을 입증해야 합니다. ';
            } else if (avg <= 3.5) {
                analysis += '현재 성적으로는 다소 도전적인 목표입니다. 남은 기간 동안 집중적인 성적 향상이 필수적이며, ';
                analysis += '동시에 실질적인 대안 대학도 함께 고려하는 것이 현실적입니다. ';
            } else {
                analysis += '목표 대학 재설정이 필요할 수 있습니다. 현실적인 목표 대학을 설정하고 수능 준비에 더 비중을 두는 전략을 권장합니다. ';
            }

            // 종합 조언
            analysis += `\n\n종합적으로 판단할 때, ${data.name} 학생은 `;

            if (avg <= 2.0 && grade <= 2) {
                analysis += '매우 긍정적인 출발선에 있습니다. 현재의 학습 패턴을 유지하면서 전공 적합성 활동을 강화한다면 목표 달성이 가능할 것입니다.';
            } else if (avg <= 3.0) {
                analysis += '충분히 목표 달성이 가능한 위치에 있습니다. 체계적인 학습 계획과 전략적인 학생부 관리가 핵심입니다.';
            } else {
                analysis += '아직 개선의 여지가 많이 남아있습니다. 단기 집중 학습과 장기 전략을 병행하여 점진적인 성적 향상을 도모해야 합니다.';
            }

            // HTML 태그 없이 순수 텍스트만 반환
            return analysis;
        }

        // 전체 문서 스트리밍 효과 함수 (최적화)
        function simulateStreamingEffect() {
            const documentBody = document.querySelector('.document-body');
            if (!documentBody) return;

            // 전문가 분석 박스를 먼저 찾아서 즉시 표시
            const expertBox = documentBody.querySelector('.expert-analysis-box');
            if (expertBox) {
                expertBox.style.opacity = '1';
                expertBox.style.transform = 'translateY(0)';
                // 즉시 타이핑 시작
                typeExpertAnalysis();
            }

            // 대학 추천 박스도 즉시 찾아서 표시
            const universityBox = documentBody.querySelector('.university-recommendation-box');
            if (universityBox) {
                universityBox.style.opacity = '1';
                universityBox.style.transform = 'translateY(0)';
                // 전문가 분석 완료 후 대학 추천 타이핑 시작
                setTimeout(() => {
                    typeUniversityRecommendations();
                }, 500); // 0.5초 후 시작
            }

            // 나머지 섹션들
            const sections = documentBody.querySelectorAll('.section-box');

            // 초기에 모든 섹션 숨기기
            sections.forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
            });

            // 모든 프로그레스 바를 즉시 찾아서 애니메이션 준비
            const allProgressBars = documentBody.querySelectorAll('.progress-bar-fill');

            // 순차적으로 섹션 나타내기 (더 빠르게)
            let delay = 100; // 0.1초 후 바로 시작
            sections.forEach((section, index) => {
                setTimeout(() => {
                    section.style.transition = 'all 0.4s ease-out'; // 0.4초로 단축
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';

                    // 일반 섹션 텍스트 타이핑 효과 (더 빠르게)
                    const textElements = section.querySelectorAll('p:not(.progress-bar-fill *), li, .strategy-item');
                    typeTextElements(textElements, 1);
                }, delay);
                delay += 300; // 각 섹션마다 0.3초 간격으로 단축
            });

            // 프로그레스 바 애니메이션을 즉시 시작 (섹션 표시와 병렬)
            setTimeout(() => {
                animateProgressBars(allProgressBars);
            }, 200); // 0.2초 후 즉시 시작
        }

        // 프로그레스 바 애니메이션 (최적화)
        function animateProgressBars(progressBars) {
            progressBars.forEach((bar, index) => {
                // 이미 애니메이션이 적용된 경우 스킵
                if (bar.classList.contains('animate')) return;

                setTimeout(() => {
                    // data-width 속성에서 목표 너비 가져오기
                    const targetWidth = bar.getAttribute('data-width') || '0%';

                    // CSS 변수로 목표 너비 설정
                    bar.style.setProperty('--target-width', targetWidth);

                    // 초기 width를 명시적으로 0%로 설정
                    bar.style.width = '0%';

                    // 약간의 딜레이 후 애니메이션 시작 (reflow 강제)
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            bar.classList.add('animate');
                        });
                    });
                }, index * 80); // 각 바마다 0.08초 간격으로 더 빠르게
            });
        }

        // 텍스트 엘리먼트 타이핑 효과 (최적화됨)
        function typeTextElements(elements, speed = 3) {
            elements.forEach((element, elemIndex) => {
                const fullText = element.textContent;
                if (!fullText || fullText.trim() === '' || fullText.length < 5) return;

                // 프로그레스 바 내부 텍스트는 제외
                if (element.closest('.progress-bar-fill')) return;

                element.textContent = '';
                element.style.minHeight = '1em'; // 레이아웃 깜빡임 방지
                element.style.opacity = '0.7';

                let charIndex = 0;

                function typeChar() {
                    if (charIndex < fullText.length) {
                        element.textContent += fullText.charAt(charIndex);
                        charIndex++;

                        // 공백, 숫자는 빠르게 건너뛰기
                        const currentChar = fullText.charAt(charIndex - 1);
                        const nextSpeed = (currentChar === ' ' || /\d/.test(currentChar)) ? speed * 0.3 : speed;

                        setTimeout(typeChar, nextSpeed);
                    } else {
                        element.style.minHeight = 'auto';
                        element.style.opacity = '1';
                    }
                }

                // 각 엘리먼트마다 약간의 딜레이
                setTimeout(typeChar, elemIndex * 30);
            });
        }

        // 전문가 분석 섹션만 따로 타이핑 (더 자연스럽게)
        function typeExpertAnalysis() {
            const expertText = document.getElementById('expertAnalysisText');
            if (!expertText) return;

            // data-full-text 속성에서 전체 텍스트 가져오기
            const fullText = expertText.getAttribute('data-full-text') || '';
            if (!fullText) return;

            // HTML 엔티티 디코딩
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = fullText;
            const decodedText = tempDiv.textContent || tempDiv.innerText || '';

            expertText.textContent = '';
            expertText.style.opacity = '0.9';

            let index = 0;

            function typeWriter() {
                if (index < decodedText.length) {
                    const currentChar = decodedText.charAt(index);
                    expertText.textContent += currentChar;
                    index++;

                    // 문장 부호나 공백에서 약간의 지연 (더 빠르게)
                    let nextDelay = 10; // 기본 속도 더 빠르게
                    if (currentChar === '.' || currentChar === '!' || currentChar === '?') {
                        nextDelay = 150; // 문장 끝
                    } else if (currentChar === ',' || currentChar === ';') {
                        nextDelay = 80; // 쉼표
                    } else if (currentChar === ' ') {
                        nextDelay = 15; // 공백
                    } else if (/[a-zA-Z0-9]/.test(currentChar)) {
                        nextDelay = 5; // 영문/숫자
                    }

                    setTimeout(typeWriter, nextDelay);
                } else {
                    expertText.style.opacity = '1';
                    // 분석 중 텍스트를 완료로 변경
                    const header = expertText.previousElementSibling;
                    if (header) {
                        const statusSpan = header.querySelector('span:last-child');
                        if (statusSpan) {
                            statusSpan.textContent = '분석 완료';
                            statusSpan.style.color = '#10b981';
                        }
                    }
                }
            }

            typeWriter(); // 즉시 시작
        }

        // 대학 추천 타이핑 효과
        function typeUniversityRecommendations() {
            const typingCells = document.querySelectorAll('.typing-cell');
            if (typingCells.length === 0) return;

            let cellDelay = 0;

            typingCells.forEach((cell, cellIndex) => {
                const universities = cell.getAttribute('data-universities') || '';
                if (!universities) return;

                setTimeout(() => {
                    cell.textContent = '';
                    let charIndex = 0;

                    function typeChar() {
                        if (charIndex < universities.length) {
                            cell.textContent += universities.charAt(charIndex);
                            charIndex++;

                            const currentChar = universities.charAt(charIndex - 1);
                            let nextDelay = 8;
                            if (currentChar === ',') {
                                nextDelay = 100;
                            } else if (currentChar === ' ') {
                                nextDelay = 20;
                            }

                            setTimeout(typeChar, nextDelay);
                        } else {
                            // 마지막 셀이 완료되면 상태 업데이트
                            if (cellIndex === typingCells.length - 1) {
                                const statusSpan = document.getElementById('universityStatus');
                                if (statusSpan) {
                                    statusSpan.textContent = '분석 완료';
                                    statusSpan.style.color = '#10b981';
                                }
                            }
                        }
                    }

                    typeChar();
                }, cellDelay);

                cellDelay += 800; // 각 행마다 0.8초 간격
            });
        }

        // 통합 성적표 생성 함수 (차트 포함)
        function generateIntegratedGradeRows(data) {
            const subjects = [
                { name: '국어', current: data.grades.korean, target: data.targets.grade },
                { name: '영어', current: data.grades.english, target: data.targets.grade },
                { name: '수학', current: data.grades.math, target: data.targets.grade }
            ];

            // 추가 과목 포함
            if (data.grades.additional) {
                for (const [name, grade] of Object.entries(data.grades.additional)) {
                    subjects.push({ name, current: grade, target: data.targets.grade });
                }
            }

            return subjects.map(subject => {
                const current = parseInt(subject.current) || 9;
                const target = parseInt(subject.target);
                const gap = current - target;
                const percentage = ((10 - current) / 9 * 100).toFixed(0);

                // 등급별 색상 클래스
                let gradeClass = '';
                if (current === 1) gradeClass = 'grade-1';
                else if (current === 2) gradeClass = 'grade-2';
                else if (current === 3) gradeClass = 'grade-3';
                else if (current === 4) gradeClass = 'grade-4';
                else if (current >= 5) gradeClass = 'grade-5';

                let statusBadge = '';
                let strategy = '';

                // 등급별 자세한 향상 전략
                if (gap <= 0) {
                    statusBadge = '<span class="grade-badge excellent">달성</span>';
                    strategy = `현재 ${subject.current}등급을 잘 유지하고 있습니다. 목표 달성 상태이므로 심화 학습과 응용 문제 풀이를 통해 실력을 더욱 견고히 다져가세요. 기출문제 분석과 변형 문제 풀이로 다양한 유형에 대비하고, 고난도 문제 해결 능력을 키워 상위권을 확고히 하는 것이 중요합니다.`;
                } else if (gap === 1) {
                    statusBadge = '<span class="grade-badge good">양호</span>';
                    strategy = `현재 ${subject.current}등급에서 ${subject.target}등급으로 1등급 상승이 필요합니다. 주 2-3회 집중 학습 시간을 확보하고, 틀린 문제는 반드시 오답노트에 정리하여 반복 학습하세요. 개념 이해를 바탕으로 다양한 유형의 문제를 풀어보며 실전 감각을 키우고, 모의고사를 통해 시간 관리 능력도 함께 향상시키세요. 약점 단원을 파악하여 집중 보완하면 충분히 목표 달성이 가능합니다.`;
                } else if (gap === 2) {
                    statusBadge = '<span class="grade-badge need-improvement">관리 필요</span>';
                    strategy = `현재 ${subject.current}등급에서 ${subject.target}등급으로 2등급 상승이 필요한 상황입니다. 주 4-5회 이상 규칙적인 학습 패턴을 만들고, 기본 개념부터 체계적으로 다시 정리하세요. 교과서 기본 개념을 완벽히 이해한 후 기본 문제부터 단계적으로 난이도를 높여가며 학습하세요. 학교 수업 진도에 맞춰 예습-복습 사이클을 철저히 지키고, 선생님께 질문하여 모르는 부분을 즉시 해결하는 습관을 들이세요. 스터디 그룹이나 멘토링을 활용하여 학습 동기를 유지하는 것도 좋은 방법입니다.`;
                } else {
                    statusBadge = '<span class="grade-badge urgent">집중 관리</span>';
                    strategy = `현재 ${subject.current}등급에서 ${subject.target}등급으로 ${gap}등급 이상의 큰 도약이 필요합니다. 매일 최소 1-2시간씩 해당 과목에 집중 투자하며, 기초 개념부터 완전히 새롭게 학습하세요. 개인 맞춤형 학습 플랜을 수립하고, 필요시 과외나 인터넷 강의 등 추가 학습 자원을 적극 활용하세요. 작은 목표를 세분화하여 단계별로 달성해가며 성취감을 느끼고, 꾸준한 학습 습관을 만드는 것이 가장 중요합니다. 매주 학습 진도를 점검하고, 부족한 부분은 즉시 보완하는 피드백 시스템을 구축하세요. 포기하지 않고 꾸준히 노력한다면 반드시 목표에 도달할 수 있습니다.`;
                }

                const improvementText = gap > 0 ? `${gap}등급↑` : '유지';

                return `
                    <tr>
                        <td><strong>${subject.name}</strong></td>
                        <td>${subject.current}등급</td>
                        <td>${subject.target}등급</td>
                        <td>${improvementText}</td>
                        <td>${statusBadge}</td>
                        <td class="chart-cell">
                            <div class="progress-bar-track" style="height: 25px;">
                                <div class="progress-bar-fill" data-width="${percentage}%" style="width: 0%; font-size: 0.85em;">
                                    <span>${subject.current}등급</span>
                                </div>
                            </div>
                            <div class="strategy-text" style="margin-top: 8px;">${strategy}</div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // 합격 가능성 계산 함수
        // 목표 대학과 AI 추천 대학 통합 비교표 생성
        function generateUnifiedUniversityComparison(data, currentAvg, aiRecommendations) {
            let html = '<table class="comparison-table" style="width: 100%;">';

            // 테이블 헤더
            html += `
                <thead>
                    <tr style="background: linear-gradient(135deg, #fef9f5 0%, #fef3e2 100%);">
                        <th style="width: 12%; text-align: center;">구분</th>
                        <th style="width: 15%;">분류</th>
                        <th style="width: 20%;">대학교</th>
                        <th style="width: 18%;">추천 학과</th>
                        <th style="width: 35%;">입시 전략</th>
                    </tr>
                </thead>
                <tbody>
            `;

            // 목표 대학 섹션
            if (data.targets.universities && data.targets.universities.length > 0) {
                html += `
                    <tr style="background: linear-gradient(135deg, #fef9f5 0%, #fef3e2 100%);">
                        <td rowspan="${data.targets.universities.length}" style="background: #854d0e; color: white; font-weight: 700; text-align: center; vertical-align: middle; font-size: 1.1em;">
                            🎯<br>목표<br>대학
                        </td>
                `;

                data.targets.universities.forEach((univ, index) => {
                    if (index > 0) html += '<tr>';

                    html += `
                        <td style="background: #fef9f5;"><strong>나의 목표</strong></td>
                        <td><strong style="color: #854d0e; font-size: 1.05em;">${univ.name || '미입력'}</strong></td>
                        <td style="color: #854d0e; font-weight: 600;">${univ.major || data.department || '미입력'}</td>
                        <td class="strategy-text" style="font-size: 0.95em;">
                            <div style="margin-bottom: 8px;">${calculateAdmissionProbability(currentAvg, data.targets.university)}</div>
                            ${getAdmissionStrategy(univ.name, univ.major, currentAvg)}
                        </td>
                    </tr>
                    `;
                });
            }

            // AI 추천 대학 섹션 (universityRecommendations 함수가 반환한 HTML 파싱)
            // 구분선 추가
            html += `
                <tr style="height: 10px; background: #e5e7eb;">
                    <td colspan="5" style="padding: 0;"></td>
                </tr>
            `;

            // AI 추천 대학을 직접 생성
            const avg = parseFloat(currentAvg);
            const targetLevel = data.targets.university || '서울권 상위';
            const department = data.department || '일반';

            const majorsByDept = {
                "컴퓨터공학과": ["컴퓨터공학과", "소프트웨어학과", "인공지능학과", "데이터사이언스학과"],
                "경영학과": ["경영학과", "경제학과", "글로벌경영학과", "경영정보학과"],
                "의예과": ["의예과", "한의예과", "치의예과", "약학과"]
            };

            const recommendedMajors = majorsByDept[department] || [department];

            const recommendations = {
                "서울권 상위": {
                    "도전": [
                        { univ: "서울대학교", majors: recommendedMajors },
                        { univ: "연세대학교", majors: recommendedMajors },
                        { univ: "고려대학교", majors: recommendedMajors }
                    ],
                    "적정": [
                        { univ: "서강대학교", majors: recommendedMajors },
                        { univ: "성균관대학교", majors: recommendedMajors },
                        { univ: "한양대학교", majors: recommendedMajors }
                    ],
                    "안정": [
                        { univ: "중앙대학교", majors: recommendedMajors },
                        { univ: "경희대학교", majors: recommendedMajors },
                        { univ: "한국외국어대학교", majors: recommendedMajors }
                    ]
                },
                "서울권 중위": {
                    "도전": [
                        { univ: "서강대학교", majors: recommendedMajors },
                        { univ: "성균관대학교", majors: recommendedMajors },
                        { univ: "한양대학교", majors: recommendedMajors }
                    ],
                    "적정": [
                        { univ: "중앙대학교", majors: recommendedMajors },
                        { univ: "경희대학교", majors: recommendedMajors },
                        { univ: "한국외국어대학교", majors: recommendedMajors }
                    ],
                    "안정": [
                        { univ: "건국대학교", majors: recommendedMajors },
                        { univ: "동국대학교", majors: recommendedMajors },
                        { univ: "홍익대학교", majors: recommendedMajors }
                    ]
                }
            };

            const univList = recommendations[targetLevel] || recommendations["서울권 상위"];
            let aiRowCount = 0;

            // AI 추천 카운트 계산
            Object.keys(univList).forEach(category => {
                aiRowCount += univList[category].length;
            });

            let firstAiRow = true;
            Object.keys(univList).forEach(category => {
                univList[category].forEach((rec, idx) => {
                    if (firstAiRow) {
                        html += `
                            <tr>
                                <td rowspan="${aiRowCount}" style="background: #2563eb; color: white; font-weight: 700; text-align: center; vertical-align: middle; font-size: 1.1em;">
                                    🎓<br>AI<br>추천<br>대학
                                </td>
                        `;
                        firstAiRow = false;
                    } else {
                        html += '<tr>';
                    }

                    let categoryBadge = '';
                    if (category === '도전') categoryBadge = '<span class="badge badge-danger">도전</span>';
                    else if (category === '적정') categoryBadge = '<span class="badge badge-warning">적정</span>';
                    else categoryBadge = '<span class="badge badge-success">안정</span>';

                    html += `
                        <td style="background: #eff6ff;">${categoryBadge}</td>
                        <td><strong style="color: #2563eb; font-size: 1.05em;">${rec.univ}</strong></td>
                        <td style="color: #2563eb; font-weight: 500; font-size: 0.9em;">
                            ${rec.majors.slice(0, 3).join(', ')}${rec.majors.length > 3 ? ' 외' : ''}
                        </td>
                        <td class="strategy-text" style="font-size: 0.95em;">
                            ${getAdmissionStrategy(rec.univ, rec.majors[0], currentAvg)}
                        </td>
                    </tr>
                    `;
                });
            });

            html += '</tbody></table>';
            return html;
        }

        function calculateAdmissionProbability(currentAvg, targetLevel) {
            const avg = parseFloat(currentAvg);
            let probability = '';

            if (targetLevel === '서울권 상위') {
                if (avg <= 1.5) probability = '<span class="badge badge-success">높음 (70-80%)</span>';
                else if (avg <= 2.5) probability = '<span class="badge badge-warning">중간 (40-60%)</span>';
                else probability = '<span class="badge badge-danger">도전 (20-30%)</span>';
            } else if (targetLevel === '서울권 중위') {
                if (avg <= 2.5) probability = '<span class="badge badge-success">높음 (70-80%)</span>';
                else if (avg <= 3.5) probability = '<span class="badge badge-warning">중간 (40-60%)</span>';
                else probability = '<span class="badge badge-danger">도전 (20-30%)</span>';
            } else {
                if (avg <= 3.5) probability = '<span class="badge badge-success">높음 (70-80%)</span>';
                else if (avg <= 4.5) probability = '<span class="badge badge-warning">중간 (40-60%)</span>';
                else probability = '<span class="badge badge-danger">낮음 (10-20%)</span>';
            }

            return probability;
        }

        // 대학별 입시 전략 생성 함수
        function getAdmissionStrategy(universityName, major, currentAvg) {
            const avg = parseFloat(currentAvg);
            let strategy = '';

            // 주요 대학별 맞춤 전략
            if (universityName && universityName.includes('서울대')) {
                if (avg <= 1.5) {
                    strategy = `현재 우수한 성적을 바탕으로 서울대 합격 가능성이 높습니다. 교과 성적을 안정적으로 유지하면서, ${major || '해당 전공'} 관련 심화 탐구 활동에 집중하세요. R&E 프로그램이나 소논문 작성을 통해 연구 역량을 입증하고, 학술제 발표나 대회 수상 등으로 전문성을 드러내세요. 생활기록부의 세부능력 및 특기사항(세특)이 전공적합성과 학업 우수성을 잘 보여줄 수 있도록 수업 시간에 적극적으로 참여하고, 선생님과 소통하세요. 자기소개서에서는 자신만의 학문적 호기심과 탐구 과정을 구체적으로 서술하며, 면접에서는 전공 지식과 논리적 사고력을 충분히 발휘할 수 있도록 준비하세요.`;
                } else {
                    strategy = `서울대 합격을 위해서는 내신 향상이 최우선 과제입니다. 현재 성적에서 최소 0.5~1등급 이상 향상이 필요하므로, 매일 규칙적인 학습 습관을 들이고 약점 과목을 집중 보완하세요. 동시에 ${major || '해당 전공'} 관련 특별 활동을 통해 전공적합성을 강하게 어필해야 합니다. 전공 관련 독서, 탐구 활동, 프로젝트를 진행하며 생기부를 풍부하게 채우세요. 교과 성적이 다소 부족하더라도 탁월한 전공 역량과 열정을 보여준다면 학생부종합전형에서 경쟁력을 가질 수 있습니다. 자소서와 면접에서 자신의 강점을 명확히 전달하고, 성적 향상 노력과 극복 스토리를 진정성 있게 풀어내세요.`;
                }
            } else if (universityName && (universityName.includes('연세대') || universityName.includes('고려대'))) {
                if (avg <= 2.0) {
                    strategy = `연세대/고려대 합격 가능성이 높은 성적입니다. ${major || '희망 전공'} 관련 전공적합성 활동을 다양하게 진행하여 차별화된 생활기록부를 만드세요. 심화 탐구 활동, 독서 활동, 동아리 프로젝트, 대회 참가 등을 통해 전공에 대한 깊이 있는 이해와 열정을 보여주세요. 학생부종합전형의 경우 단순한 활동 나열보다는 하나의 활동을 깊이 있게 탐구하고 성찰한 과정이 중요합니다. 또한 리더십 경험, 협업 능력, 사회적 관심 등도 함께 드러낼 수 있도록 다양한 활동에 참여하세요. 자소서에서는 자신만의 스토리를 진솔하게 풀어내고, 면접에서는 자신감 있게 자신의 강점을 어필하세요.`;
                } else {
                    strategy = `연세대/고려대 합격을 위해서는 내신 개선과 수상실적 확보가 필수입니다. 현재 성적에서 1~1.5등급 이상 향상을 목표로 체계적인 학습 계획을 수립하고 실천하세요. 특히 주요 교과목(국영수)과 ${major || '전공'} 관련 과목의 성적을 집중적으로 끌어올리세요. 교내 대회(학술제, 논술대회, 과학탐구대회 등)에 적극 참가하여 수상 실적을 쌓고, 이를 통해 학업 역량과 전공 관심도를 입증하세요. 3학년 1학기까지 성적 상승 추세를 보이는 것이 중요하며, 자소서에서는 이러한 노력과 성장 과정을 구체적으로 서술하세요. 논술전형도 함께 준비하여 합격 기회를 넓히는 것을 권장합니다.`;
                }
            } else if (major && major.includes('의')) {
                strategy = `의예과 합격을 위해서는 자연계 교과(생명과학, 화학, 물리)에서 탁월한 성적과 함께 전공적합성이 명확히 드러나야 합니다. 생명과학 실험 동아리, 과학 탐구 활동, 소논문 작성 등을 통해 과학적 탐구 역량을 입증하고, 의료봉사 활동을 통해 의료인으로서의 인성과 봉사정신을 보여주세요. 최신 의학 논문이나 의료 이슈에 관심을 가지고 독서 활동을 진행하며, 의료 윤리에 대한 깊이 있는 고민도 함께 드러내세요. 의예과는 경쟁이 매우 치열하므로 1등급대 내신 유지가 필수이며, 자소서와 면접에서 의사로서의 소명의식과 인류애를 진정성 있게 전달하는 것이 중요합니다. MMI(다중미니면접) 등 의대 특화 면접에 대비한 철저한 준비도 필요합니다.`;
            } else if (major && major.includes('공학')) {
                strategy = `공학계열 합격을 위해서는 수학과 과학 교과에서 우수한 성적을 유지하고, 실제 프로젝트 경험을 쌓는 것이 중요합니다. ${major || '해당 공학'} 관련 동아리 활동, 발명품 제작, 프로그래밍 프로젝트, 과학탐구 실험 등을 통해 문제 해결 능력과 창의성을 보여주세요. 교과 세특에서는 수학/과학 개념을 실생활이나 공학 분야에 적용한 사례를 다루고, 심화 탐구 보고서를 작성하여 탐구 역량을 입증하세요. 교내 과학경시대회, 수학경시대회, 발명대회 등에 참가하여 수상 실적을 쌓고, 팀 프로젝트를 통해 협업 능력도 함께 기르세요. 자소서에서는 공학자로서의 꿈과 비전을 구체적으로 서술하고, 면접에서는 수학/과학 개념에 대한 깊이 있는 이해를 보여주세요.`;
            } else {
                if (avg <= 3.0) {
                    strategy = `현재 성적을 안정적으로 유지하면서 ${major || '희망 전공'} 관련 전공 탐구 활동에 집중하세요. 전공 관련 독서, 탐구 활동, 프로젝트, 동아리 활동 등을 통해 전공적합성과 학업역량을 고르게 발전시키고, 생활기록부를 풍부하게 채우세요. 학생부종합전형뿐만 아니라 교과전형, 논술전형 등 다양한 전형을 함께 준비하여 합격 가능성을 높이세요. 꾸준한 학습 습관을 유지하며 3학년까지 성적을 안정적으로 관리하는 것이 중요합니다.`;
                } else {
                    strategy = `기초 학력 향상에 집중하여 내신 성적을 끌어올리는 것이 최우선입니다. 매일 규칙적인 학습 시간을 확보하고, 기본 개념부터 체계적으로 정리하세요. 학교 수업에 충실히 참여하고, 모르는 부분은 즉시 선생님께 질문하여 해결하세요. 과외나 인터넷 강의 등 추가 학습 자원을 활용하고, 스터디 그룹을 통해 학습 동기를 유지하세요. 성적 향상과 함께 ${major || '희망 전공'} 관련 활동도 병행하여 생활기록부를 관리하되, 우선순위는 학업 성적 개선에 두세요. 꾸준한 노력을 통해 성적이 상승한다면 상위권 대학 진학도 충분히 가능합니다.`;
                }
            }

            return strategy;
        }

        function getUniversityRecommendations(targetLevel, currentAvg, department) {
            const avg = parseFloat(currentAvg);
            const dept = department || '일반학과';

            // 전공별 추천 학과 매핑
            const majorsByDept = {
                "컴퓨터공학과": ["컴퓨터공학과", "소프트웨어학과", "인공지능학과", "데이터사이언스학과"],
                "경영학과": ["경영학과", "경제학과", "글로벌경영학과", "경영정보학과"],
                "의예과": ["의예과", "한의예과", "치의예과", "약학과"],
                "default": ["인문계열", "사회계열", "자연계열", "공학계열"]
            };

            const recommendedMajors = majorsByDept[dept] || majorsByDept["default"];

            const recommendations = {
                "서울권 상위": {
                    "도전": [
                        { univ: "서울대학교", majors: recommendedMajors },
                        { univ: "연세대학교", majors: recommendedMajors },
                        { univ: "고려대학교", majors: recommendedMajors }
                    ],
                    "적정": [
                        { univ: "서강대학교", majors: recommendedMajors },
                        { univ: "성균관대학교", majors: recommendedMajors },
                        { univ: "한양대학교", majors: recommendedMajors }
                    ],
                    "안정": [
                        { univ: "중앙대학교", majors: recommendedMajors },
                        { univ: "경희대학교", majors: recommendedMajors },
                        { univ: "한국외국어대학교", majors: recommendedMajors }
                    ]
                },
                "서울권 중위": {
                    "도전": [
                        { univ: "중앙대학교", majors: recommendedMajors },
                        { univ: "경희대학교", majors: recommendedMajors },
                        { univ: "서울시립대학교", majors: recommendedMajors }
                    ],
                    "적정": [
                        { univ: "건국대학교", majors: recommendedMajors },
                        { univ: "동국대학교", majors: recommendedMajors },
                        { univ: "홍익대학교", majors: recommendedMajors }
                    ],
                    "안정": [
                        { univ: "숭실대학교", majors: recommendedMajors },
                        { univ: "국민대학교", majors: recommendedMajors },
                        { univ: "세종대학교", majors: recommendedMajors }
                    ]
                },
                "서울권": {
                    "도전": [
                        { univ: "건국대학교", majors: recommendedMajors },
                        { univ: "동국대학교", majors: recommendedMajors },
                        { univ: "홍익대학교", majors: recommendedMajors }
                    ],
                    "적정": [
                        { univ: "숭실대학교", majors: recommendedMajors },
                        { univ: "국민대학교", majors: recommendedMajors },
                        { univ: "세종대학교", majors: recommendedMajors }
                    ],
                    "안정": [
                        { univ: "단국대학교", majors: recommendedMajors },
                        { univ: "광운대학교", majors: recommendedMajors },
                        { univ: "명지대학교", majors: recommendedMajors }
                    ]
                }
            };

            const unis = recommendations[targetLevel] || recommendations["서울권"];

            let html = '<table class="comparison-table" style="margin-top: 20px;">';
            html += `
                <thead>
                    <tr style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);">
                        <th style="width: 15%;">분류</th>
                        <th style="width: 25%;">대학교</th>
                        <th style="width: 60%;">추천 학과</th>
                    </tr>
                </thead>
                <tbody>
            `;

            ["도전", "적정", "안정"].forEach((tier, index) => {
                const tierLabel = tier === "도전" ? "🎯 도전 대학" : tier === "적정" ? "✅ 적정 대학" : "🛡️ 안정 대학";
                const tierUnivs = unis[tier];

                tierUnivs.forEach((univData, univIndex) => {
                    html += `
                        <tr>
                            ${univIndex === 0 ? `<td rowspan="${tierUnivs.length}" style="background: #f8fafc; font-weight: 700; color: #2563eb;"><strong>${tierLabel}</strong></td>` : ''}
                            <td><strong style="color: #2563eb;">${univData.univ}</strong></td>
                            <td class="strategy-text">${univData.majors.join(', ')}</td>
                        </tr>
                    `;
                });
            });

            html += '</tbody></table>';
            return html;
        }

        // 통합 로드맵 생성 함수 (활동 로드맵 + 즉시 실천 과제 통합)
        function generateIntegratedRoadmap(data) {
            const grade = parseInt(data.grade);
            const department = data.department || '일반';
            const month = new Date().getMonth() + 1;
            const semester = month <= 7 ? 1 : 2;
            let html = '';

            const roadmapItems = {
                1: [
                    {
                        title: "📚 기초 학업 역량 강화",
                        broadPlan: "고등학교 학습의 기초를 다지고 규칙적인 학습 습관 형성",
                        detailedPlan: `고등학교 1학년은 전체 고교 생활의 기초를 다지는 가장 중요한 시기입니다. 주요 교과목(국어, 영어, 수학)의 내신 관리를 철저히 하며, 규칙적인 학습 습관을 형성하세요. 매일 계획표를 작성하고 실천하는 습관을 들이고, 수업 시간에 적극적으로 참여하여 개념을 완벽히 이해하세요. 예습과 복습을 생활화하고, 모르는 내용은 즉시 선생님께 질문하여 해결하세요. 오답노트를 만들어 틀린 문제를 반복 학습하고, 정기고사 대비 계획을 체계적으로 수립하여 실천하세요.`,
                        period: "1학년 3월~12월",
                        actionItems: [
                            `매일 아침 학습 계획표 작성 및 실천`,
                            `주요 교과목 예습-복습 사이클 확립`,
                            `오답노트 작성 및 주간 복습`,
                            `정기고사 2주 전 집중 대비 계획 수립`
                        ]
                    },
                    {
                        title: "🔍 진로 탐색 및 적성 발견",
                        broadPlan: "다양한 진로 체험을 통한 자기 이해 및 진로 방향 설정",
                        detailedPlan: `다양한 분야의 진로 체험 활동에 적극 참여하여 자신의 흥미와 적성을 발견하세요. 진로 탐색 프로그램, 직업 체험, 멘토링 활동 등을 통해 여러 직업군을 경험해보세요. 자신이 관심 있는 분야의 책을 읽고, 관련 다큐멘터리나 강연을 시청하며 지식을 넓히세요. 진로 선생님과의 상담을 통해 자신의 강점과 약점을 파악하고, 구체적인 진로 방향을 설정하세요. 여러 분야를 경험하면서 자신만의 관심사를 찾아가는 과정이 중요합니다.`,
                        period: "1학년 연중",
                        actionItems: [
                            `진로 선생님과 월 1회 정기 상담`,
                            `학기당 최소 3회 진로 체험 활동 참여`,
                            `관심 분야 도서 월 2권 독서`,
                            `진로 탐색 일지 작성 (주간)`
                        ]
                    },
                    {
                        title: "🎭 동아리 활동 및 교내 활동 시작",
                        broadPlan: "전공 연계 동아리 활동 및 교내 활동 적극 참여",
                        detailedPlan: `자신의 관심 분야나 희망 전공과 연관된 동아리에 가입하여 적극적으로 활동하세요. 동아리 내에서 프로젝트를 기획하고 실행하며 협업 능력을 기르세요. 정규 동아리 외에도 자율 동아리를 만들어 더 깊이 있는 활동을 전개할 수 있습니다. 학급 임원이나 학생회 활동에도 참여하여 리더십과 봉사 정신을 함양하세요. 교내 축제, 체육대회, 학술 행사 등에 적극 참여하여 다양한 경험을 쌓고, 이러한 모든 활동을 생활기록부에 충실히 기록될 수 있도록 담당 선생님과 소통하세요.`,
                        period: "1학년 3월~12월",
                        actionItems: [
                            `${department} 관련 정규 동아리 가입 및 적극 참여`,
                            `자율 동아리 결성 또는 가입 (학기 내)`,
                            `동아리 프로젝트 기획 및 실행 (학기당 1회)`,
                            `교내 행사 최소 5회 참여 및 활동 기록`
                        ]
                    }
                ],
                2: [
                    {
                        title: "🔬 전공 심화 탐구 활동",
                        broadPlan: "전공 관련 심화 연구 및 탐구 프로젝트 수행",
                        detailedPlan: `${department} 전공과 관련된 심화 탐구 활동을 본격적으로 시작하세요. 교과 수업에서 배운 내용을 바탕으로 독자적인 연구 주제를 선정하고, 체계적인 탐구 과정을 거쳐 결과물을 도출하세요. 과학 실험, 사회 탐구, 인문학 연구 등 전공 분야에 맞는 심화 프로젝트를 수행하고, 탐구 보고서를 작성하세요. 교내 R&E(Research and Education) 프로그램이나 소논문 대회에 참가하여 연구 역량을 입증하세요. 관련 분야의 대학 교수님이나 전문가와의 멘토링을 통해 전문성을 높이고, 학술제나 발표회에서 자신의 연구 결과를 발표하여 발표 능력도 함께 키우세요.`,
                        period: "2학년 3월~12월",
                        actionItems: [
                            `${department} 관련 탐구 주제 선정 (3월)`,
                            `체계적인 연구 계획 수립 및 실행 (4~10월)`,
                            `탐구 보고서 또는 소논문 작성 완료 (11월)`,
                            `교내 학술제 또는 발표회 참가 (12월)`
                        ]
                    },
                    {
                        title: "👥 리더십 및 협업 경험 축적",
                        broadPlan: "리더 역할 수행 및 팀 프로젝트 주도",
                        detailedPlan: `동아리 임원, 학급 임원, 학생회 간부 등의 리더 역할을 수행하며 리더십을 발휘하세요. 팀 프로젝트를 주도적으로 기획하고 실행하며, 구성원들과의 협력을 통해 목표를 달성하는 경험을 쌓으세요. 후배들을 대상으로 멘토링 활동을 하거나, 학습 봉사, 재능 기부 등을 통해 나눔을 실천하세요. 교내 행사를 기획하고 운영하는 과정에서 기획력, 실행력, 문제 해결 능력을 키우세요. 갈등 상황에서 중재자 역할을 하며 소통 능력과 문제 해결 능력을 발전시키고, 이러한 모든 경험을 구체적으로 기록하여 생활기록부에 잘 드러나도록 하세요.`,
                        period: "2학년 연중",
                        actionItems: [
                            `동아리 또는 학급 임원 역할 수행`,
                            `팀 프로젝트 리더로 최소 2회 활동`,
                            `후배 멘토링 또는 학습 봉사 (학기당 5회)`,
                            `교내 행사 기획 및 운영 참여 (학기당 1회)`
                        ]
                    },
                    {
                        title: "🏆 교내외 대회 적극 참여",
                        broadPlan: "전공 관련 교내 대회 참가 및 수상 실적 확보",
                        detailedPlan: `전공 관련 교내 대회(과학 경시, 논술 대회, 토론 대회, 프로젝트 경진대회 등)에 적극 참여하여 수상 실적을 쌓으세요. 대회 준비 과정에서 얻은 지식과 경험이 전공 역량을 입증하는 중요한 자료가 됩니다. 교외 대회의 경우, 학교장 허가를 받은 대회에만 참가하여 생활기록부에 기재될 수 있도록 하세요. 대회 참가 이후에는 반드시 자신의 경험을 정리하고, 배운 점과 아쉬운 점을 분석하여 다음 기회에 발전할 수 있도록 하세요. 팀 단위 대회에서는 협업 능력을, 개인 대회에서는 문제 해결 능력을 발휘하며 성장하세요.`,
                        period: "2학년 3월~12월",
                        actionItems: [
                            `${department} 관련 교내 대회 최소 3회 참가`,
                            `대회 준비 스터디 그룹 결성 및 운영`,
                            `대회 참가 후 성찰 일지 작성`,
                            `수상 실적 생활기록부 반영 확인`
                        ]
                    }
                ],
                3: [
                    {
                        title: "🎯 입시 전략 수립 및 자기소개서 준비",
                        broadPlan: "목표 대학 확정 및 자기소개서 작성 완료",
                        detailedPlan: `3학년 초부터 목표 대학과 전형을 명확히 확정하고, 각 전형의 요구사항을 철저히 분석하세요. 학생부 종합전형을 준비한다면 자신의 생활기록부를 꼼꼼히 읽고, 주요 활동과 성과를 정리하여 자기소개서 작성을 시작하세요. 자기소개서는 여러 번 수정하며 완성도를 높이고, 선생님과 선배들에게 피드백을 받아 개선하세요. 논술 전형을 준비한다면 기출문제 분석과 모의 논술 작성을 병행하세요. 수시 원서 접수 전략을 세우고, 정시 대비 수능 준비도 철저히 하세요. 진학 상담 선생님과 정기적으로 상담하며 전략을 점검하고 조정하세요.`,
                        period: "3학년 3월~8월",
                        actionItems: [
                            `목표 대학 및 전형 최종 확정 (3월)`,
                            `생활기록부 분석 및 활동 정리 (3~4월)`,
                            `자기소개서 초안 작성 (5월)`,
                            `자기소개서 피드백 및 수정 (6~7월)`,
                            `수시 원서 접수 전략 수립 (8월)`
                        ]
                    },
                    {
                        title: "📖 최종 내신 관리 및 마무리",
                        broadPlan: "3학년 1학기 내신 최상위 성적 확보",
                        detailedPlan: `3학년 1학기 내신은 대입에서 가장 중요한 마지막 성적입니다. 이 시기의 성적 관리에 최선을 다하세요. 수업에 집중하고, 시험 범위를 철저히 분석하여 빈틈없이 준비하세요. 특히 전공 관련 과목은 더욱 심화 학습하여 높은 성취를 이루세요. 학업과 입시 준비를 병행해야 하므로 효율적인 시간 관리가 필수입니다. 매일 학습 계획을 세우고 실천하며, 건강 관리도 소홀히 하지 마세요. 충분한 수면과 규칙적인 운동으로 컨디션을 유지하고, 스트레스를 관리하며 마지막까지 최선을 다하세요.`,
                        period: "3학년 3월~7월",
                        actionItems: [
                            `전 과목 ${data.targets.grade}등급 이상 목표 설정`,
                            `${department} 관련 과목 심화 학습 (주 5시간)`,
                            `중간고사 및 기말고사 3주 전부터 집중 대비`,
                            `일일 학습 시간 관리 및 체크리스트 작성`
                        ]
                    },
                    {
                        title: "🎤 면접 준비 및 최종 점검",
                        broadPlan: "학생부 종합전형 면접 철저 대비",
                        detailedPlan: `학생부 종합전형 면접을 대비하여 자신의 생활기록부와 자기소개서를 완벽히 숙지하세요. 예상 질문을 만들어 답변을 준비하고, 모의 면접을 통해 실전 감각을 키우세요. 전공 관련 기본 지식과 최신 이슈를 정리하고, 시사 상식도 꾸준히 공부하세요. 면접 태도, 말투, 표정 등 비언어적 요소도 연습하여 좋은 인상을 줄 수 있도록 준비하세요. 긴장을 관리하는 방법을 익히고, 자신감 있게 자신의 강점을 어필할 수 있도록 연습하세요. 면접 전날에는 충분한 휴식을 취하고, 당일에는 여유 있게 출발하여 최상의 컨디션으로 면접에 임하세요.`,
                        period: "3학년 9월~11월",
                        actionItems: [
                            `생활기록부 및 자기소개서 완벽 숙지 (9월)`,
                            `예상 질문 50개 작성 및 답변 준비`,
                            `모의 면접 최소 5회 실시 (선생님, 선배)`,
                            `${department} 관련 최신 이슈 및 시사 정리`,
                            `면접 태도 및 비언어적 요소 연습`
                        ]
                    }
                ]
            };

            const items = roadmapItems[grade] || roadmapItems[1];

            // 현재 학기 즉시 실천 과제
            html += `
                <div class="alert-box alert-box-warning" style="margin-bottom: 30px;">
                    <div class="alert-icon">⚠️</div>
                    <div class="alert-content">
                        <div class="alert-title">즉시 실천 과제 (${grade}학년 ${semester}학기)</div>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            <li><strong>현재 시기:</strong> ${grade}학년 ${semester}학기 핵심 활동 집중</li>
                            <li><strong>교내 활동:</strong> ${data.schoolName} 특색 프로그램 적극 참여</li>
                            <li><strong>전공 준비:</strong> ${department} 관련 선택과목 수강 필수</li>
                            <li><strong>성적 목표:</strong> 전 과목 평균 ${data.targets.grade}등급 달성</li>
                            <li><strong>생기부 관리:</strong> 과목별 세특 내용 충실히 작성 및 확인</li>
                        </ul>
                    </div>
                </div>
            `;

            items.forEach((item, index) => {
                html += `
                    <div class="roadmap-item" data-step="${index + 1}" style="margin-bottom: 40px; border: 2px solid #e5e7eb; border-radius: 12px; padding: 25px; background: #fafaf9;">
                        <div class="roadmap-title" style="font-size: 1.4em; font-weight: 700; color: #854d0e; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            ${item.title}
                        </div>
                        <div style="font-size: 0.9em; color: #6b7280; margin-bottom: 15px; padding: 8px 12px; background: #fef9f5; border-radius: 6px; display: inline-block;">
                            ⏰ ${item.period}
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="font-size: 1.1em; font-weight: 600; color: #2563eb; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                📌 넓은 계획
                            </h4>
                            <div style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #2563eb;">
                                ${item.broadPlan}
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="font-size: 1.1em; font-weight: 600; color: #854d0e; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                📝 세부 계획
                            </h4>
                            <div class="roadmap-description strategy-text" style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #ca8a04; font-size: 1em; line-height: 1.8; color: #374151;">
                                ${item.detailedPlan}
                            </div>
                        </div>

                        <div>
                            <h4 style="font-size: 1.1em; font-weight: 600; color: #10b981; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                ✅ 실행 체크리스트
                            </h4>
                            <ul style="padding: 15px 15px 15px 35px; background: white; border-radius: 8px; border-left: 4px solid #10b981; line-height: 1.8; color: #374151;">
                                ${item.actionItems.map(action => `<li>${action}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            });

            return html;
        }

        function generateRecommendedActivities(data) {
            const deptActivities = {
                "컴퓨터공학과": [
                    {
                        title: "💻 프로그래밍 동아리 활동",
                        desc: "Python, Java, C++ 등 다양한 프로그래밍 언어를 학습하고, 실제 프로젝트를 진행하세요. 알고리즘 문제 풀이, 코드 리뷰, 페어 프로그래밍 등을 통해 실력을 향상시키고, 정기적인 스터디 모임을 통해 최신 기술 트렌드를 학습하세요. 깃허브(GitHub)에 포트폴리오를 구축하여 자신의 코딩 실력을 입증하세요."
                    },
                    {
                        title: "📱 웹/앱 개발 프로젝트",
                        desc: "실생활의 문제를 해결할 수 있는 웹사이트나 모바일 애플리케이션을 기획하고 개발하세요. 사용자 니즈 분석부터 UI/UX 디자인, 프론트엔드/백엔드 개발, 테스트, 배포까지 전 과정을 경험하며 소프트웨어 개발 라이프사이클을 이해하세요. 교내 학생들을 위한 편의 기능을 제공하는 앱을 만들어 실제 사용자 피드백을 받아보세요."
                    },
                    {
                        title: "🏆 코딩 대회 및 해커톤 참가",
                        desc: "교내 코딩 대회, 정보올림피아드, 해커톤 등에 참가하여 문제 해결 능력과 창의력을 키우세요. 시간 제한이 있는 환경에서 효율적으로 문제를 분석하고 최적의 알고리즘을 설계하는 능력을 기르세요. 팀 단위 해커톤에서는 협업 능력과 소통 능력도 함께 발전시킬 수 있습니다."
                    },
                    {
                        title: "🤖 AI/머신러닝 심화 학습",
                        desc: "인공지능과 머신러닝의 기초 이론을 학습하고, TensorFlow나 PyTorch를 활용한 실습 프로젝트를 진행하세요. 이미지 분류, 자연어 처리, 추천 시스템 등 다양한 AI 응용 분야를 탐구하며, Kaggle 대회에 참가하여 실전 경험을 쌓으세요. AI 윤리와 사회적 영향에 대해서도 고민하고 토론하세요."
                    }
                ],
                "경영학과": [
                    {
                        title: "💼 경제/경영 동아리 활동",
                        desc: "경제 신문 스크랩, 기업 분석 보고서 작성, 경영 사례 연구 등을 통해 경영학의 기초를 다지세요. 실제 기업의 경영 전략을 분석하고, 개선 방안을 제시하는 프로젝트를 진행하세요. 경제 이슈에 대한 토론과 발표를 통해 논리적 사고력과 발표 능력을 키우세요."
                    },
                    {
                        title: "🚀 모의 창업 프로젝트",
                        desc: "아이디어 발굴부터 사업 계획서 작성, 마케팅 전략 수립, 재무 계획까지 창업의 전 과정을 경험하세요. 실제 시장 조사를 통해 고객 니즈를 파악하고, 경쟁 분석을 수행하여 차별화 전략을 수립하세요. 교내 창업 경진대회에 참가하여 투자 유치 피칭 연습도 해보세요."
                    },
                    {
                        title: "📈 주식투자 시뮬레이션",
                        desc: "가상 투자 시뮬레이션 프로그램을 활용하여 주식 투자 전략을 실습하세요. 기업의 재무제표 분석, 산업 동향 파악, 기술적/기본적 분석 방법을 학습하며 투자 감각을 키우세요. 포트폴리오 구성과 리스크 관리 전략도 함께 연구하세요."
                    },
                    {
                        title: "📣 마케팅 캠페인 기획 및 실행",
                        desc: "교내 행사나 동아리를 위한 마케팅 캠페인을 직접 기획하고 실행하세요. 타겟 고객 분석, 브랜드 포지셔닝, 콘텐츠 마케팅, SNS 마케팅 전략을 수립하고 실제 효과를 측정하세요. 디지털 마케팅 도구를 활용하여 데이터 기반 의사결정 능력을 기르세요."
                    }
                ],
                "의예과": [
                    {
                        title: "🔬 생명과학 실험 동아리",
                        desc: "학교 실험실에서 세포 관찰, DNA 추출, 효소 실험 등 다양한 생명과학 실험을 수행하세요. 실험 설계부터 데이터 수집, 분석, 결과 해석까지 과학적 탐구 과정을 체계적으로 경험하세요. 안전 수칙을 준수하며 정확한 실험 기술을 익히고, 실험 보고서 작성 능력을 키우세요."
                    },
                    {
                        title: "💉 의료봉사 및 병원 체험",
                        desc: "지역 병원이나 보건소에서의 봉사 활동을 통해 의료 현장을 직접 경험하세요. 환자들과의 소통을 통해 의료인으로서 갖춰야 할 공감 능력과 소통 능력을 기르세요. 의사, 간호사 등 의료진과의 대화를 통해 의료 직업에 대한 이해를 깊게 하고, 의료 윤리에 대해서도 고민해보세요."
                    },
                    {
                        title: "📚 의학 논문 및 학술지 탐구",
                        desc: "국내외 의학 학술지의 논문을 읽고 분석하며 최신 의학 연구 동향을 파악하세요. 질병의 원인, 진단 방법, 치료법 등에 대한 과학적 지식을 쌓고, 논문의 연구 방법론을 이해하세요. 관심 있는 주제에 대해 자신만의 고찰을 정리하고, 친구들과 함께 논문 발표 세미나를 개최하세요."
                    },
                    {
                        title: "🏥 의료 관련 독서 및 토론",
                        desc: "의학, 생명윤리, 공중보건 관련 서적을 읽고 깊이 있는 토론을 진행하세요. 안락사, 장기 이식, 유전자 편집 등 의료 윤리적 쟁점에 대해 다양한 관점에서 논의하며 비판적 사고력을 기르세요. 의료 시스템과 정책에 대해서도 관심을 가지고 사회적 책임감을 함양하세요."
                    }
                ]
            };

            const activities = deptActivities[data.department] || [
                {
                    title: "📖 전공 관련 동아리 활동",
                    desc: "자신의 희망 전공과 관련된 동아리에서 적극적으로 활동하며 전공 지식을 쌓고 같은 관심사를 가진 친구들과 함께 성장하세요."
                },
                {
                    title: "🎓 교내 학술제 및 연구 발표회",
                    desc: "교내 학술제에서 자신의 연구나 프로젝트를 발표하며 발표 능력을 키우고, 다른 학생들의 연구에서도 배울 점을 찾으세요."
                },
                {
                    title: "📚 전공 관련 심화 독서 활동",
                    desc: "전공 분야의 입문서부터 전문서까지 폭넓게 읽으며 지식의 깊이를 더하고, 독서 감상문이나 서평을 작성하여 비판적 독서 능력을 기르세요."
                },
                {
                    title: "👨‍🏫 멘토링 프로그램 참여",
                    desc: "선배나 전문가의 멘토링을 받거나, 후배들을 대상으로 멘토가 되어 지식을 나누며 리더십과 소통 능력을 함께 발전시키세요."
                }
            ];

            let html = '<div style="display: grid; grid-template-columns: 1fr; gap: 25px;">';

            activities.forEach((activity, index) => {
                html += `
                    <div style="border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; background: white; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                        <h5 style="color: #854d0e; font-size: 1.2em; margin-bottom: 12px; font-weight: 700;">
                            ${activity.title}
                        </h5>
                        <p class="strategy-text" style="color: #374151; line-height: 1.8; font-size: 0.98em; margin: 0;">
                            ${activity.desc}
                        </p>
                    </div>
                `;
            });

            html += '</div>';
            return html;
        }

        function generateBookRecommendations(department) {
            const books = {
                "컴퓨터공학과": [
                    { title: "클린 코드", author: "로버트 마틴", level: "입문" },
                    { title: "컴퓨터 프로그램의 구조와 해석", author: "해럴드 에이블슨", level: "심화" },
                    { title: "인공지능의 미래", author: "레이 커즈와일", level: "교양" }
                ],
                "경영학과": [
                    { title: "경영의 교양", author: "이동현", level: "입문" },
                    { title: "좋은 기업을 넘어 위대한 기업으로", author: "짐 콜린스", level: "심화" },
                    { title: "넛지", author: "리처드 탈러", level: "교양" }
                ],
                "default": [
                    { title: "사피엔스", author: "유발 하라리", level: "교양" },
                    { title: "정의란 무엇인가", author: "마이클 샌델", level: "교양" },
                    { title: "총균쇠", author: "재레드 다이아몬드", level: "심화" }
                ]
            };

            const bookList = books[department] || books["default"];

            let html = '<table class="data-table">';
            html += `
                <thead>
                    <tr>
                        <th>도서명</th>
                        <th>저자</th>
                        <th>난이도</th>
                        <th>추천 이유</th>
                    </tr>
                </thead>
                <tbody>
            `;

            bookList.forEach(book => {
                const badgeClass = book.level === "입문" ? "badge-success" :
                                  book.level === "심화" ? "badge-warning" : "badge-info";
                html += `
                    <tr>
                        <td><strong>${book.title}</strong></td>
                        <td>${book.author}</td>
                        <td><span class="badge ${badgeClass}">${book.level}</span></td>
                        <td>전공 기초 소양 및 사고력 향상</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        function generateActionPlan(data) {
            const grade = parseInt(data.grade);
            const month = new Date().getMonth() + 1;
            const semester = month <= 7 ? 1 : 2;

            const plans = [
                `<strong>${grade}학년 ${semester}학기:</strong> 현재 시기 핵심 활동 집중`,
                `<strong>교내 활동:</strong> ${data.schoolName} 특색 프로그램 참여`,
                `<strong>${data.department}:</strong> 전공 관련 선택과목 수강 필수`,
                `<strong>성적 관리:</strong> 평균 ${data.targets.grade}등급 목표`,
                `<strong>생기부:</strong> 과목별 세특 내용 충실히 기록`
            ];

            let html = '<ul style="line-height: 2;">';
            plans.forEach(plan => {
                html += `<li>${plan}</li>`;
            });
            html += '</ul>';

            return html;
        }

        function saveAsPDF() {
            alert('PDF 저장 기능은 브라우저의 인쇄 > PDF로 저장을 이용해주세요.');
            window.print();
        }

        function resetForm() {
            if (confirm('작성한 내용이 모두 삭제됩니다. 계속하시겠습니까?')) {
                // localStorage 클리어
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(STEP_KEY);

                // 페이지 새로고침
                location.reload();
            }
        }

        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#department') && !e.target.closest('#departmentSuggestions')) {
                document.getElementById('departmentSuggestions').style.display = 'none';
            }
            if (!e.target.closest('#schoolName') && !e.target.closest('#schoolSuggestions')) {
                document.getElementById('schoolSuggestions').style.display = 'none';
            }
        });

        // Show floating button on scroll
        window.addEventListener('scroll', () => {
            const floatingBtn = document.getElementById('floatingAction');
            if (floatingBtn && floatingBtn.style.display === 'block') {
                if (window.scrollY > 300) {
                    floatingBtn.style.opacity = '1';
                } else {
                    floatingBtn.style.opacity = '0.7';
                }
            }
        });

        // 활동 상세 박스 닫기 함수
        function closeActivityDetail(activityType) {
            const detailBox = document.getElementById(`detail-${activityType}`);
            const activityItem = document.querySelector(`.activity-checkbox-item[data-activity="${activityType}"]`);
            const checkbox = activityItem.querySelector('.activity-checkbox');

            // 상세 박스 숨기기
            detailBox.style.display = 'none';

            // 체크박스 선택 해제
            activityItem.classList.remove('selected');
            checkbox.checked = false;

            // 텍스트 입력 내용 초기화
            const textarea = detailBox.querySelector('textarea');
            if (textarea) {
                textarea.value = '';
            }
        }

        // 활동 체크박스 상세 입력 필드 토글 (카드 클릭 방식)
        document.addEventListener('DOMContentLoaded', () => {
            const activityItems = document.querySelectorAll('.activity-checkbox-item');

            activityItems.forEach(item => {
                item.addEventListener('click', function() {
                    const activityType = this.dataset.activity;
                    const checkbox = this.querySelector('.activity-checkbox');
                    const detailBox = document.getElementById(`detail-${activityType}`);

                    // 선택 상태 토글
                    this.classList.toggle('selected');
                    checkbox.checked = this.classList.contains('selected');

                    // 상세 입력창 토글
                    if (checkbox.checked) {
                        detailBox.style.display = 'block';
                    } else {
                        detailBox.style.display = 'none';
                    }
                });
            });
        });

        // 인쇄/PDF 모달 제어 함수
        function openPrintModal() {
            document.getElementById('printModal').style.display = 'flex';
        }

        function closePrintModal() {
            document.getElementById('printModal').style.display = 'none';
        }

        function printReport() {
            closePrintModal();
            // 약간의 딜레이 후 인쇄 (모달이 완전히 닫힌 후)
            setTimeout(() => {
                window.print();
            }, 100);
        }

        // 대학교 API 데이터 (한국교육개발원 대학정보공시 기반)
        let universityDatabase = [];

        // 대학교 데이터 로드
        async function loadUniversityData() {
            // 공공데이터 API 대신 로컬 대학교 목록 사용
            universityDatabase = [
                { name: "서울대학교", type: "국립", region: "서울" },
                { name: "연세대학교", type: "사립", region: "서울" },
                { name: "고려대학교", type: "사립", region: "서울" },
                { name: "카이스트", type: "국립", region: "대전" },
                { name: "포항공과대학교", type: "사립", region: "경북" },
                { name: "성균관대학교", type: "사립", region: "서울" },
                { name: "한양대학교", type: "사립", region: "서울" },
                { name: "서강대학교", type: "사립", region: "서울" },
                { name: "중앙대학교", type: "사립", region: "서울" },
                { name: "경희대학교", type: "사립", region: "서울" },
                { name: "한국외국어대학교", type: "사립", region: "서울" },
                { name: "서울시립대학교", type: "공립", region: "서울" },
                { name: "건국대학교", type: "사립", region: "서울" },
                { name: "동국대학교", type: "사립", region: "서울" },
                { name: "홍익대학교", type: "사립", region: "서울" },
                { name: "숙명여자대학교", type: "사립", region: "서울" },
                { name: "이화여자대학교", type: "사립", region: "서울" },
                { name: "부산대학교", type: "국립", region: "부산" },
                { name: "경북대학교", type: "국립", region: "대구" },
                { name: "전남대학교", type: "국립", region: "광주" },
                { name: "충남대학교", type: "국립", region: "대전" },
                { name: "전북대학교", type: "국립", region: "전북" },
                { name: "강원대학교", type: "국립", region: "강원" },
                { name: "제주대학교", type: "국립", region: "제주" },
                { name: "인하대학교", type: "사립", region: "인천" },
                { name: "아주대학교", type: "사립", region: "경기" },
                { name: "가천대학교", type: "사립", region: "경기" },
                { name: "한국항공대학교", type: "사립", region: "경기" },
                { name: "단국대학교", type: "사립", region: "경기" },
                { name: "명지대학교", type: "사립", region: "서울" },
                { name: "광운대학교", type: "사립", region: "서울" },
                { name: "국민대학교", type: "사립", region: "서울" },
                { name: "세종대학교", type: "사립", region: "서울" },
                { name: "숭실대학교", type: "사립", region: "서울" },
                { name: "서울과학기술대학교", type: "공립", region: "서울" }
            ];
        }

        // 대학교 검색 함수
        function searchUniversities(query) {
            if (!query || query.length < 1) return [];

            const lowerQuery = query.toLowerCase();
            return universityDatabase.filter(uni =>
                uni.name.toLowerCase().includes(lowerQuery)
            ).slice(0, 10); // 최대 10개만 표시
        }

        // 대학교 자동완성 설정
        function setupUniversityAutocomplete(universityId) {
            const input = document.getElementById(`${universityId}_name`);
            const suggestionsBox = document.getElementById(`${universityId}_suggestions`);

            if (!input || !suggestionsBox) return;

            let debounceTimer;

            input.addEventListener('input', function() {
                clearTimeout(debounceTimer);

                debounceTimer = setTimeout(() => {
                    const query = this.value.trim();

                    if (query.length === 0) {
                        suggestionsBox.classList.remove('show');
                        suggestionsBox.innerHTML = '';
                        return;
                    }

                    const results = searchUniversities(query);

                    if (results.length === 0) {
                        suggestionsBox.classList.remove('show');
                        suggestionsBox.innerHTML = '';
                        return;
                    }

                    suggestionsBox.innerHTML = results.map(uni => `
                        <div class="university-suggestion-item" data-name="${uni.name}">
                            <div class="university-name">${uni.name}</div>
                            <div class="university-info">${uni.type} · ${uni.region}</div>
                        </div>
                    `).join('');

                    suggestionsBox.classList.add('show');

                    // 각 제안 항목에 클릭 이벤트 추가
                    suggestionsBox.querySelectorAll('.university-suggestion-item').forEach(item => {
                        item.addEventListener('click', function() {
                            input.value = this.dataset.name;
                            suggestionsBox.classList.remove('show');
                            suggestionsBox.innerHTML = '';
                            saveFormData();
                        });
                    });
                }, 300); // 300ms 디바운스
            });

            // 외부 클릭 시 자동완성 닫기
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !suggestionsBox.contains(e.target)) {
                    suggestionsBox.classList.remove('show');
                }
            });

            // 입력 필드 포커스 시 기존 값으로 검색
            input.addEventListener('focus', function() {
                if (this.value.trim().length > 0) {
                    this.dispatchEvent(new Event('input'));
                }
            });
        }

        // 페이지 로드 시 대학교 데이터 로드
        loadUniversityData();

        // ============ 스크롤 애니메이션 ============

        // CSS 애니메이션 정의
        const style = document.createElement('style');
        style.textContent = `
            .animate-on-scroll {
                opacity: 0;
                transform: translateY(30px);
                transition: opacity 0.6s ease, transform 0.6s ease;
            }

            .animate-on-scroll.visible {
                opacity: 1;
                transform: translateY(0);
            }

            .typing-animation {
                overflow: hidden;
                white-space: pre-wrap;
                word-wrap: break-word;
            }

            .typing-animation.typing {
                animation: blink-caret 0.75s step-end infinite;
            }

            @keyframes blink-caret {
                from, to { border-right: 2px solid transparent; }
                50% { border-right: 2px solid #ca8a04; }
            }

            .chart-animate {
                opacity: 0;
                transform: scale(0.95);
                transition: opacity 0.8s ease, transform 0.8s ease;
            }

            .chart-animate.visible {
                opacity: 1;
                transform: scale(1);
            }
        `;
        document.head.appendChild(style);

        // Intersection Observer 설정
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        // 일반 요소 애니메이션 Observer
        const animateObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        // 타이핑 애니메이션 함수
        function typeWriter(element, text, speed = 20) {
            let i = 0;
            element.textContent = '';
            element.classList.add('typing');

            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    element.classList.remove('typing');
                }
            }

            type();
        }

        // 텍스트 타이핑 Observer
        const typingObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.dataset.typed) {
                    const originalText = entry.target.textContent;
                    entry.target.dataset.typed = 'true';
                    entry.target.dataset.originalText = originalText;
                    typeWriter(entry.target, originalText);
                    typingObserver.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // 차트 애니메이션 Observer
        const chartObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    chartObserver.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // MutationObserver로 동적으로 추가되는 요소 감지
        const contentObserver = new MutationObserver((mutations) => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    if (node.nodeType === 1) { // Element 노드인 경우
                        // document-container 찾기
                        if (node.classList && node.classList.contains('document-container')) {
                            applyScrollAnimations(node);
                        }
                        // 내부의 document-container 찾기
                        const containers = node.querySelectorAll && node.querySelectorAll('.document-container');
                        if (containers) {
                            containers.forEach(container => applyScrollAnimations(container));
                        }
                    }
                });
            });
        });

        // document body 전체를 감시
        contentObserver.observe(document.body, {
            childList: true,
            subtree: true
        });

        // 스크롤 애니메이션 적용 함수
        function applyScrollAnimations(container) {
            // 일반 박스들 (카드, 섹션 등)
            const boxes = container.querySelectorAll('.document-header, .section-box, .tier-container, .roadmap-phase');
            boxes.forEach(box => {
                if (!box.classList.contains('animate-on-scroll')) {
                    box.classList.add('animate-on-scroll');
                    animateObserver.observe(box);
                }
            });

            // 텍스트 요소들 (전문가 분석, 향상 전략 등)
            const textElements = container.querySelectorAll('.expert-analysis-text, .analysis-content, .strategy-text, p');
            textElements.forEach(el => {
                if (!el.dataset.typed && el.textContent.trim().length > 30) {
                    el.classList.add('typing-animation');
                    typingObserver.observe(el);
                }
            });

            // 차트 요소들
            const charts = container.querySelectorAll('canvas, .chart-container, .radar-chart');
            charts.forEach(chart => {
                if (!chart.classList.contains('chart-animate')) {
                    chart.classList.add('chart-animate');
                    chartObserver.observe(chart);
                }
            });
        }

        // 페이지 로드 시 기존 document-container에 애니메이션 적용
        document.addEventListener('DOMContentLoaded', () => {
            const existingContainers = document.querySelectorAll('.document-container');
            existingContainers.forEach(container => applyScrollAnimations(container));
        });
    </script>
    <script src="js/header-common.js"></script>
</body>
</html>