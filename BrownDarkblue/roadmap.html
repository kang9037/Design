<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스터디케어 - 학생부 로드맵 생성기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fafaf9 0%, #f5f5f4 50%, #e7e5e4 100%);
            min-height: 100vh;
            padding: 180px 20px 20px 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(202, 138, 4, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(133, 77, 14, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(71, 85, 105, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .page-header {
            text-align: center;
            color: #854d0e;
            margin-top: 20px;
            margin-bottom: 40px;
            padding: 20px 0;
            text-shadow: 0 2px 4px rgba(133, 77, 14, 0.1);
        }

        .page-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .page-header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-shadow:
                0 20px 60px rgba(139, 92, 246, 0.15),
                0 0 0 1px rgba(139, 92, 246, 0.1);
            margin-bottom: 30px;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 12px;
            color: #333;
            font-weight: 700;
            font-size: 1.1em;
        }

        input, select, textarea {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1em;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ca8a04;
            box-shadow: 0 0 0 3px rgba(202, 138, 4, 0.15);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            padding: 20px 50px;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #854d0e 0%, #713f12 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(202, 138, 4, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-group {
            text-align: center;
            margin-top: 30px;
        }

        /* ============ 로딩 상태 스타일 ============ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 20px;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid #f0f0f0;
            border-top: 6px solid #ca8a04;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-message {
            margin-top: 30px;
            font-size: 1.3em;
            font-weight: 700;
            color: #854d0e;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ============ 타이핑 효과 ============ */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: #ca8a04;
            margin-left: 3px;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* ============ 결과 문서 스타일 ============ */
        .document-container {
            background: white;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            border-radius: 0;
        }

        .document-header {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 50px 60px;
            position: relative;
            overflow: hidden;
        }

        .document-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .document-title {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 15px;
            position: relative;
        }

        .document-subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            position: relative;
        }

        .document-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255,255,255,0.3);
            position: relative;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .document-body {
            padding: 50px 60px;
        }

        .section {
            margin-bottom: 50px;
            page-break-inside: avoid;
        }

        .section-title {
            font-size: 1.6em;
            color: #333;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ca8a04;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-icon {
            font-size: 1.2em;
        }

        /* 정보 카드 그리드 */
        .info-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 2px solid #fde68a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card-label {
            font-size: 0.85em;
            color: #854d0e;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-card-value {
            font-size: 1.3em;
            color: #333;
            font-weight: 700;
        }

        /* 테이블 스타일 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border-radius: 12px;
            overflow: hidden;
        }

        .data-table thead {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
        }

        .data-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
            letter-spacing: 0.3px;
        }

        .data-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.3s;
        }

        .data-table tbody tr:hover {
            background: #fef9c3;
        }

        .data-table td {
            padding: 16px 20px;
            color: #333;
            font-size: 0.95em;
        }

        .data-table tbody tr:last-child {
            border-bottom: none;
        }

        /* 뱃지 스타일 */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .badge-primary {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .badge-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        /* 대학 추천 섹션 */
        .university-tiers {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .tier-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }

        .tier-box:hover {
            border-color: #ca8a04;
            box-shadow: 0 5px 20px rgba(202, 138, 4, 0.15);
        }

        .tier-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tier-title {
            font-size: 1.2em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tier-universities {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .university-chip {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 1px solid #fde68a;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 600;
            color: #854d0e;
            font-size: 0.95em;
            transition: all 0.3s;
            cursor: default;
        }

        .university-chip:hover {
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(202, 138, 4, 0.3);
        }

        /* 마인드맵 스타일 */
        .mindmap-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
        }

        .mindmap-year {
            position: relative;
            padding-left: 50px;
        }

        .mindmap-year::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 30px;
            bottom: 30px;
            width: 4px;
            background: linear-gradient(180deg, #ca8a04 0%, #854d0e 100%);
            border-radius: 2px;
        }

        .year-node {
            position: absolute;
            left: 8px;
            top: 20px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #ca8a04 0%, #854d0e 100%);
            border: 4px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.85em;
            box-shadow: 0 3px 10px rgba(202, 138, 4, 0.4);
            z-index: 1;
        }

        .year-header-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .semester-boxes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .semester-box {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 2px solid #fde68a;
            border-radius: 12px;
            padding: 20px;
        }

        .semester-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #854d0e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-box {
            background: white;
            border-left: 4px solid #ca8a04;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .activity-text {
            color: #333;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .activity-note {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
            font-size: 0.85em;
            color: #059669;
        }

        /* 전략 박스 */
        .strategy-box {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border: 2px solid #fed7aa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .strategy-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #ea580c;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .strategy-content {
            color: #333;
            line-height: 1.8;
        }

        .strategy-list {
            list-style: none;
            padding-left: 0;
        }

        .strategy-list li {
            padding: 10px 0 10px 30px;
            position: relative;
        }

        .strategy-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #ea580c;
            font-weight: 700;
            font-size: 1.2em;
        }

        .export-section {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            margin-top: 50px;
            border: 2px solid #fde68a;
        }

        .export-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.4em;
        }

        .export-section p {
            color: #666;
            margin-bottom: 25px;
        }

        .btn-export {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-export:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        @media print {
            body {
                background: white;
            }
            .card {
                box-shadow: none;
            }
            .export-section, .btn-group {
                display: none;
            }
            .document-container {
                box-shadow: none;
            }
        }

        @media (max-width: 768px) {
            .form-row, .info-cards, .semester-boxes {
                grid-template-columns: 1fr;
            }

            .document-header, .document-body {
                padding: 30px 25px;
            }

            .document-title {
                font-size: 1.6em;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        /* 학교 검색 결과 스타일 */
        #schoolSuggestions::-webkit-scrollbar {
            width: 8px;
        }

        #schoolSuggestions::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        #schoolSuggestions::-webkit-scrollbar-thumb {
            background: #ca8a04;
            border-radius: 4px;
        }

        #schoolSuggestions::-webkit-scrollbar-thumb:hover {
            background: #854d0e;
        }

        /* ============ 모달 스타일 ============ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .modal-content {
            background: white;
            border-radius: 0;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease-out;
            box-shadow: none;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 20px 20px 0 0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 40px;
        }

        /* 차트 컨테이너 스타일 */
        .chart-container {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            padding: 10px;
        }

        .chart-wrapper.full-width {
            grid-column: 1 / -1;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%);
            border: 2px solid #fde68a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(202, 138, 4, 0.2);
        }

        .stat-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 800;
            color: #854d0e;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        .pdf-button {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transition: all 0.3s;
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }

        .pdf-button.show {
            display: flex;
        }

        .pdf-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        /* 추가 정보 박스 */
        .insight-box {
            background: linear-gradient(135deg, #dcfce7 0%, #d9f99d 100%);
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .insight-title {
            font-weight: 700;
            color: #059669;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-content {
            color: #333;
            line-height: 1.8;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .stats-cards {
                grid-template-columns: 1fr 1fr;
            }

            .modal-body {
                padding: 20px;
            }
        }

        /* 프린트 스타일 */
        @media print {
            .modal-overlay {
                position: static;
                background: none;
            }

            .modal-content {
                max-height: none;
                box-shadow: none;
            }

            .modal-close, .pdf-button {
                display: none !important;
            }

            .modal-header {
                position: static;
            }
        }

        /* 단계별 카드 스타일 */
        .step-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
        }

        .step-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .step-card.completed {
            opacity: 0.7;
            pointer-events: none;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #fbbf24;
        }

        .step-number {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-right: 15px;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }

        .step-title {
            flex: 1;
        }

        .step-title h3 {
            margin: 0;
            font-size: 1.5em;
            color: #333;
        }

        .step-title p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 0.9em;
        }

        .next-step-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .next-step-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
        }

        .next-step-btn:active {
            transform: translateY(0);
        }
    </style>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- html2pdf.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 공통 헤더 -->
    <div id="common-header"></div>

    <div class="container">
        <!-- 전체 제목 -->
        <h2 style="margin-bottom: 40px; color: #333; font-size: 2em; text-align: center;">학생 맞춤형 로드맵 생성을 위한 정보 입력</h2>

        <!-- Step 1: 기본 정보 -->
        <div class="step-card visible" id="stepCard1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">
                    <h3>기본 정보 입력</h3>
                    <p>학생의 기본 정보와 희망 진로를 입력해주세요</p>
                </div>
            </div>

            <div class="card">
                <!-- 기본 정보 -->
                <div style="background: linear-gradient(135deg, #fef9c3 0%, #fef3c7 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #ca8a04;">
                    <h3 style="color: #854d0e; margin-bottom: 20px; font-size: 1.3em;">📋 기본 정보</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>학생 이름</label>
                            <input type="text" id="studentName" placeholder="예: 김민준" value="김민준">
                        </div>

                        <div class="form-group">
                            <label>현재 학년</label>
                            <select id="currentGrade">
                                <option value="1">고등학교 1학년</option>
                                <option value="2">고등학교 2학년</option>
                                <option value="3">고등학교 3학년</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>학교명</label>
                        <div style="position: relative;">
                            <input type="text" id="schoolName" placeholder="학교명을 입력하세요 (예: 서울고등학교)" oninput="searchSchool(this.value)">
                            <div id="schoolSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #ca8a04; border-top: none; border-radius: 0 0 10px 10px; max-height: 200px; overflow-y: auto; z-index: 1000;"></div>
                        </div>
                        <div id="schoolInfo" style="margin-top: 10px; font-size: 0.85em; color: #333;"></div>
                    </div>

                    <div class="form-group">
                        <label>희망 계열</label>
                        <select id="major">
                            <option value="자연계열">자연계열</option>
                            <option value="인문계열">인문계열</option>
                            <option value="예체능계열">예체능계열</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>희망 학과/전공</label>
                    <div style="position: relative;">
                        <input type="text" id="department" placeholder="학과/전공을 검색하거나 클릭하여 선택하세요" oninput="searchDepartment(this.value)" onfocus="showAllDepartments()" autocomplete="off">
                        <div id="departmentSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #ca8a04; border-top: none; border-radius: 0 0 10px 10px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>관심 분야 / 키워드 (선택)</label>
                    <textarea id="keywords" rows="3" placeholder="예: 인공지능, 데이터분석, 프로그래밍, 알고리즘">인공지능, 프로그래밍, 데이터분석</textarea>
                </div>

                <button type="button" class="next-step-btn" onclick="goToNextStep(2)">다음 단계: 성적 정보 입력 →</button>
            </div>
        </div>

        <!-- Step 2: 성적 정보 -->
        <div class="step-card" id="stepCard2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">
                    <h3>성적 정보 입력</h3>
                    <p>현재 또는 최근 학기 내신 등급을 입력해주세요 (국영수 필수)</p>
                </div>
            </div>

            <div class="card">
                <!-- 과목별 현재 등급 -->
                <div style="background: linear-gradient(135deg, #dcfce7 0%, #d9f99d 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #10b981;">
                    <h3 style="color: #059669; margin-bottom: 20px; font-size: 1.3em;">📊 과목별 현재 성적 (내신 등급)</h3>
                    <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">현재 또는 최근 학기 내신 등급을 입력해주세요 (국영수 필수)</p>

                    <!-- 필수 과목 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>국어 <span style="color: #ef4444;">*</span></label>
                            <select id="gradeKorean" required>
                                <option value="">선택</option>
                                <option value="1">1등급</option>
                                <option value="2" selected>2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>영어 <span style="color: #ef4444;">*</span></label>
                            <select id="gradeEnglish" required>
                                <option value="">선택</option>
                                <option value="1">1등급</option>
                                <option value="2">2등급</option>
                                <option value="3" selected>3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>수학 <span style="color: #ef4444;">*</span></label>
                            <select id="gradeMath" required>
                                <option value="">선택</option>
                                <option value="1" selected>1등급</option>
                                <option value="2">2등급</option>
                                <option value="3">3등급</option>
                                <option value="4">4등급</option>
                                <option value="5">5등급</option>
                                <option value="6">6등급</option>
                                <option value="7">7등급</option>
                                <option value="8">8등급</option>
                                <option value="9">9등급</option>
                            </select>
                        </div>
                    </div>

                    <!-- 추가 과목 컨테이너 -->
                    <div id="additionalSubjectsContainer" style="margin-top: 20px;"></div>

                    <!-- 과목 추가 버튼 -->
                    <button type="button" onclick="addSubject()" style="width: 100%; padding: 12px; margin-top: 15px; background: white; color: #059669; border: 2px dashed #10b981; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#dcfce7'; this.style.borderStyle='solid';" onmouseout="this.style.background='white'; this.style.borderStyle='dashed';">
                        + 추가 과목 입력하기
                    </button>
                </div>

                <button type="button" class="next-step-btn" onclick="goToNextStep(3)">다음 단계: 활동 및 목표 입력 →</button>
            </div>
        </div>

        <!-- Step 3: 활동 및 목표 -->
        <div class="step-card" id="stepCard3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">
                    <h3>활동 및 목표 입력</h3>
                    <p>활동 현황과 희망 대학을 입력해주세요</p>
                </div>
            </div>

            <div class="card">
                <!-- 활동 현황 -->
                <div style="background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #6366f1;">
                    <h3 style="color: #4f46e5; margin-bottom: 20px; font-size: 1.3em;">🎯 활동 현황</h3>
                    <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">현재까지 참여한 활동을 입력해주세요</p>

                    <div class="form-group">
                        <label>동아리 활동 (개수)</label>
                        <input type="number" id="activityClub" placeholder="예: 2" value="1" min="0" max="10">
                        <small style="color: #666; font-size: 0.85em;">참여한 동아리 개수</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>교내 대회/수상 (회)</label>
                            <input type="number" id="activityAward" placeholder="예: 3" value="2" min="0">
                            <small style="color: #666; font-size: 0.85em;">교내 대회 참가 및 수상 횟수</small>
                        </div>

                        <div class="form-group">
                            <label>프로젝트/탐구활동 (개)</label>
                            <input type="number" id="activityProject" placeholder="예: 2" value="1" min="0">
                            <small style="color: #666; font-size: 0.85em;">개인/팀 프로젝트 및 탐구활동 수</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>주요 활동 내용 (선택)</label>
                        <textarea id="activityDetails" rows="3" placeholder="예: 프로그래밍 동아리 부장, 교내 코딩대회 금상, AI 챗봇 제작 프로젝트">프로그래밍 동아리, 교내 수학경시대회 은상</textarea>
                    </div>
                </div>

                <!-- 목표 설정 -->
                <div style="background: linear-gradient(135deg, #fed7aa 0%, #fde68a 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 5px solid #f59e0b;">
                    <h3 style="color: #d97706; margin-bottom: 20px; font-size: 1.3em;">🎓 목표 대학</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label>1지망 대학</label>
                            <input type="text" id="targetUniv1" placeholder="예: 서울대학교" value="연세대학교">
                        </div>

                        <div class="form-group">
                            <label>2지망 대학</label>
                            <input type="text" id="targetUniv2" placeholder="예: 연세대학교" value="성균관대학교">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>3지망 대학</label>
                            <input type="text" id="targetUniv3" placeholder="예: 중앙대학교" value="">
                        </div>

                        <div class="form-group">
                            <label>4지망 대학</label>
                            <input type="text" id="targetUniv4" placeholder="예: 경희대학교" value="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>강점 및 특기사항 (선택)</label>
                        <textarea id="strengths" rows="3" placeholder="예: 수학·과학 우수, 프로그래밍 실력, 리더십, 창의적 문제해결 능력">수학 성적 우수, 프로그래밍 능력</textarea>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="goToStep2()">🔍 AI 맞춤형 로드맵 생성하기</button>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- 모달창 -->
    <div class="modal-overlay" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 style="margin: 0; font-size: 1.8em;">🎓 3개년 맞춤형 입시전략 로드맵</h2>
                    <p style="margin: 5px 0 0 0; opacity: 0.9;">AI 기반 학생부 종합관리 및 대학입시 전략 보고서</p>
                </div>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="reportContent">
                <div class="document-container">
                    <!-- 문서 헤더 제거 (모달 헤더와 중복) -->

                    <!-- 문서 본문 -->
                    <div class="document-body">

                        <!-- Section 1: 학생 기본 정보 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">👤</span>
                                학생 기본 정보
                            </h2>
                            <div class="info-cards">
                                <div class="info-card">
                                    <div class="info-card-label">학생명</div>
                                    <div class="info-card-value" id="doc-name">김민준</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-label">현재 학년</div>
                                    <div class="info-card-value" id="doc-grade">고등학교 1학년</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-label">학교</div>
                                    <div class="info-card-value" id="doc-school">서울고등학교</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-label">희망 계열</div>
                                    <div class="info-card-value" id="doc-major">자연계열</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-label">희망 학과</div>
                                    <div class="info-card-value" id="doc-dept">컴퓨터공학과</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-card-label">관심 분야</div>
                                    <div class="info-card-value">AI·프로그래밍</div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: 성적 분석 및 예측 차트 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">📈</span>
                                성적 분석 및 예측
                            </h2>

                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="stat-icon">📚</div>
                                    <div class="stat-value">2.1</div>
                                    <div class="stat-label">현재 내신등급</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">🎯</div>
                                    <div class="stat-value">1.8</div>
                                    <div class="stat-label">목표 내신등급</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">📊</div>
                                    <div class="stat-value">85%</div>
                                    <div class="stat-label">달성 가능성</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">🏆</div>
                                    <div class="stat-value">상위 12%</div>
                                    <div class="stat-label">전체 석차</div>
                                </div>
                            </div>

                            <div class="charts-grid">
                                <div class="chart-container">
                                    <h3 class="chart-title">과목별 성적 현황 및 예측</h3>
                                    <div class="chart-wrapper">
                                        <canvas id="gradeRadarChart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <h3 class="chart-title">대학별 합격 가능성 분석</h3>
                                    <div class="chart-wrapper">
                                        <canvas id="universityDoughnutChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="insight-box">
                                <div class="insight-title">💡 AI 분석 인사이트</div>
                                <div class="insight-content">
                                    수학과 과학 과목의 성적이 우수하며, 정보 과목에서 특히 뛰어난 성과를 보이고 있습니다.
                                    영어 과목의 보완이 필요하며, 1학년 2학기부터 집중 관리하면 목표 등급 달성이 충분히 가능합니다.
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: 학교 정보공시 데이터 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">🏫</span>
                                학교 교육과정 분석
                            </h2>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">항목</th>
                                        <th>내용</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>학교 유형</strong></td>
                                        <td>공립 일반고등학교</td>
                                    </tr>
                                    <tr>
                                        <td><strong>2024 대학진학률</strong></td>
                                        <td>92.3% (4년제 78.5%, 전문대 13.8%)</td>
                                    </tr>
                                    <tr>
                                        <td><strong>개설 선택과목</strong></td>
                                        <td>
                                            <span class="badge badge-primary">정보</span>
                                            <span class="badge badge-primary">인공지능기초</span>
                                            <span class="badge badge-primary">심화수학I</span>
                                            <span class="badge badge-primary">미적분</span>
                                            <span class="badge badge-primary">확률과통계</span>
                                            외 18과목
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>수행평가 비중</strong></td>
                                        <td>정보(40%), 수학(30%), 과학탐구(35%), 국어(25%)</td>
                                    </tr>
                                    <tr>
                                        <td><strong>학교 특색사업</strong></td>
                                        <td>SW·AI 인재양성 중점학교, 과학중점반 운영, 수학·과학 심화반</td>
                                    </tr>
                                    <tr>
                                        <td><strong>교내 경진대회</strong></td>
                                        <td>코딩경진대회(11월), 수학경시대회(6월), 과학탐구대회(9월)</td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="strategy-box">
                                <div class="strategy-title">💡 AI 교육과정 분석 결과</div>
                                <div class="strategy-content">
                                    서울고등학교는 <strong>SW·AI 중점학교</strong>로 지정되어 컴퓨터공학 희망자에게 최적화된 환경입니다.
                                    정보 과목 수행평가 비중이 <strong>40%</strong>로 매우 높아 세부능력특기사항(세특) 작성에 유리하며,
                                    인공지능기초 과목이 정규 교육과정에 편성되어 있습니다.
                                    교내 <strong>코딩경진대회</strong>(매년 11월 개최)는 필수 참가 권장 활동입니다.
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: 대학 추천 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">🎯</span>
                                컴퓨터공학과 맞춤 대학 추천
                            </h2>

                            <div class="university-tiers">
                                <div class="tier-box">
                                    <div class="tier-header">
                                        <div class="tier-title">
                                            <span class="badge badge-danger">🔥 도전 대학</span>
                                            <span style="font-size: 0.85em; color: #666;">내신 1.5등급 이내</span>
                                        </div>
                                    </div>
                                    <div class="tier-universities">
                                        <div class="university-chip">서울대 컴퓨터공학부</div>
                                        <div class="university-chip">카이스트 전산학부</div>
                                        <div class="university-chip">연세대 컴퓨터과학과</div>
                                        <div class="university-chip">고려대 컴퓨터학과</div>
                                        <div class="university-chip">포스텍 컴퓨터공학과</div>
                                    </div>
                                </div>

                                <div class="tier-box">
                                    <div class="tier-header">
                                        <div class="tier-title">
                                            <span class="badge badge-warning">🎯 적정 대학</span>
                                            <span style="font-size: 0.85em; color: #666;">내신 2.5등급 이내</span>
                                        </div>
                                    </div>
                                    <div class="tier-universities">
                                        <div class="university-chip">성균관대 소프트웨어학과</div>
                                        <div class="university-chip">한양대 컴퓨터소프트웨어학부</div>
                                        <div class="university-chip">중앙대 AI학과</div>
                                        <div class="university-chip">경희대 컴퓨터공학과</div>
                                        <div class="university-chip">서강대 컴퓨터공학과</div>
                                    </div>
                                </div>

                                <div class="tier-box">
                                    <div class="tier-header">
                                        <div class="tier-title">
                                            <span class="badge badge-success">✅ 안정 대학</span>
                                            <span style="font-size: 0.85em; color: #666;">내신 3.5등급 이내</span>
                                        </div>
                                    </div>
                                    <div class="tier-universities">
                                        <div class="university-chip">동국대 컴퓨터공학과</div>
                                        <div class="university-chip">숭실대 컴퓨터학부</div>
                                        <div class="university-chip">세종대 소프트웨어학과</div>
                                        <div class="university-chip">광운대 소프트웨어학부</div>
                                        <div class="university-chip">아주대 소프트웨어학과</div>
                                    </div>
                                </div>
                            </div>

                            <table class="data-table" style="margin-top: 30px;">
                                <thead>
                                    <tr>
                                        <th>전형 유형</th>
                                        <th>핵심 전략</th>
                                        <th>준비사항</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>학생부종합</strong></td>
                                        <td>정보·수학 세특 강화</td>
                                        <td>교내 코딩대회 수상, AI 프로젝트 동아리, 프로그래밍 소논문</td>
                                    </tr>
                                    <tr>
                                        <td><strong>학생부교과</strong></td>
                                        <td>내신 1-2등급 유지</td>
                                        <td>수학·과학 집중 관리, 정보 과목 만점 목표</td>
                                    </tr>
                                    <tr>
                                        <td><strong>논술</strong></td>
                                        <td>수리논술 대비</td>
                                        <td>미적분·확률통계 심화, 논술 학원 병행</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Section 5: 3개년 로드맵 및 활동 차트 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">📅</span>
                                3개년 활동 로드맵 및 분석
                            </h2>

                            <!-- 활동 타임라인 차트 -->
                            <div class="chart-container">
                                <h3 class="chart-title">3개년 활동 계획 타임라인</h3>
                                <div class="chart-wrapper full-width" style="height: 400px;">
                                    <canvas id="timelineChart"></canvas>
                                </div>
                            </div>

                            <!-- 학교 교육과정 분석 차트 -->
                            <div class="charts-grid">
                                <div class="chart-container">
                                    <h3 class="chart-title">학년별 활동 비중 분석</h3>
                                    <div class="chart-wrapper">
                                        <canvas id="activityBarChart"></canvas>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <h3 class="chart-title">교육과정 이수 계획</h3>
                                    <div class="chart-wrapper">
                                        <canvas id="curriculumChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="mindmap-container">
                                <!-- 1학년 -->
                                <div class="mindmap-year">
                                    <div class="year-node">1</div>
                                    <div class="year-header-title">고등학교 1학년 - 기초 탐색 단계</div>

                                    <div class="semester-boxes">
                                        <div class="semester-box">
                                            <div class="semester-title">📖 1학기</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-success">동아리</span>
                                                    </div>
                                                    <div class="activity-text">프로그래밍 동아리 가입 및 Python 기초 학습</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-warning">독서</span>
                                                    </div>
                                                    <div class="activity-text">"헬로 코딩", "컴퓨터 과학이 여는 세계" 독서록 작성</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-info">수행평가</span>
                                                        <span class="badge badge-success">학교 DB</span>
                                                    </div>
                                                    <div class="activity-text">[정보 40%] 계산기 프로그램 제작 프로젝트</div>
                                                    <div class="activity-note">→ 서울고 1학년 정보 수행평가 실제 주제</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="semester-box">
                                            <div class="semester-title">📖 2학기</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-success">동아리</span>
                                                    </div>
                                                    <div class="activity-text">알고리즘 스터디 그룹 운영 및 기초 문제 해결</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-danger">탐구</span>
                                                    </div>
                                                    <div class="activity-text">정렬 알고리즘 비교 분석 소논문 (버블정렬 vs 퀵정렬)</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-primary">대회</span>
                                                        <span class="badge badge-success">학교 DB</span>
                                                    </div>
                                                    <div class="activity-text">교내 코딩경진대회 참가 및 입상 목표</div>
                                                    <div class="activity-note">→ 매년 11월 개최 (학교알리미 확인)</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 2학년 -->
                                <div class="mindmap-year">
                                    <div class="year-node">2</div>
                                    <div class="year-header-title">고등학교 2학년 - 심화 탐구 단계</div>

                                    <div class="semester-boxes">
                                        <div class="semester-box">
                                            <div class="semester-title">📖 1학기</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-success">동아리</span>
                                                    </div>
                                                    <div class="activity-text">AI 프로젝트 동아리 부장, 머신러닝 기초 스터디 진행</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-info">수행평가</span>
                                                        <span class="badge badge-success">학교 DB</span>
                                                    </div>
                                                    <div class="activity-text">[인공지능기초] 선형회귀 알고리즘 구현 프로젝트</div>
                                                    <div class="activity-note">→ 서울고 2학년 선택과목 (개설 확인됨)</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-danger">탐구</span>
                                                    </div>
                                                    <div class="activity-text">학생 성적 예측 AI 모델 개발 및 정확도 개선 연구</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="semester-box">
                                            <div class="semester-title">📖 2학기</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-info">수행평가</span>
                                                        <span class="badge badge-success">학교 DB</span>
                                                    </div>
                                                    <div class="activity-text">[심화수학I] 경사하강법 원리 탐구 발표</div>
                                                    <div class="activity-note">→ 미적분과 AI 알고리즘 융합</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-danger">탐구</span>
                                                    </div>
                                                    <div class="activity-text">CNN 이미지 분류 모델 구현 (CIFAR-10)</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-warning">독서</span>
                                                    </div>
                                                    <div class="activity-text">"밑바닥부터 시작하는 딥러닝" 심화 독서</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 3학년 -->
                                <div class="mindmap-year">
                                    <div class="year-node">3</div>
                                    <div class="year-header-title">고등학교 3학년 - 통합 심화 단계</div>

                                    <div class="semester-boxes">
                                        <div class="semester-box">
                                            <div class="semester-title">📖 1학기</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-danger">종합탐구</span>
                                                    </div>
                                                    <div class="activity-text">NLP 기반 감정분석 챗봇 개발 프로젝트</div>
                                                    <div class="activity-note">→ 3년간 학습 집대성</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-success">멘토링</span>
                                                    </div>
                                                    <div class="activity-text">후배 대상 Python 기초반 강의 및 프로젝트 지도</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-primary">대회</span>
                                                        <span class="badge badge-success">학교 DB</span>
                                                    </div>
                                                    <div class="activity-text">교내 과학탐구대회 최우수상 목표 (AI 윤리)</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="semester-box">
                                            <div class="semester-title">📖 2학기 (수시 준비)</div>
                                            <div class="activity-items">
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-primary">봉사</span>
                                                    </div>
                                                    <div class="activity-text">지역아동센터 코딩교육 봉사 (초등 스크래치)</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-warning">독서</span>
                                                    </div>
                                                    <div class="activity-text">"클린코드", "소프트웨어 장인" 전공 심화</div>
                                                </div>
                                                <div class="activity-box">
                                                    <div class="activity-header">
                                                        <span class="badge badge-primary">진로</span>
                                                    </div>
                                                    <div class="activity-text">AI 윤리 세미나 참여 및 에세이 작성</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 6: 입시전략 요약 -->
                        <div class="section">
                            <h2 class="section-title">
                                <span class="section-icon">✅</span>
                                학교 맞춤 입시전략 체크리스트
                            </h2>

                            <div class="strategy-box">
                                <div class="strategy-title">🎯 반드시 챙겨야 할 활동 (학교 DB 기반)</div>
                                <ul class="strategy-list">
                                    <li><strong>1학년 11월:</strong> 교내 코딩경진대회 참가 필수 (학교 정기 행사)</li>
                                    <li><strong>2학년:</strong> 인공지능기초 선택과목 수강 권장 (학교 개설 확인)</li>
                                    <li><strong>정보 수행평가:</strong> 매 학기 40% 비중 → 세특 집중 관리</li>
                                    <li><strong>수학·과학 내신:</strong> 1-2등급 유지 목표 (서울고 진학률 고려)</li>
                                    <li><strong>동아리 활동:</strong> AI/프로그래밍 관련 동아리 3년 지속</li>
                                </ul>
                            </div>

                            <table class="data-table" style="margin-top: 25px;">
                                <thead>
                                    <tr>
                                        <th>내신 등급</th>
                                        <th>위 활동 이행 시</th>
                                        <th>예상 합격 대학</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>1.5등급 이내</strong></td>
                                        <td>모든 활동 완료</td>
                                        <td><span class="badge badge-danger">연세대·고려대 컴퓨터공학과 합격권</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>2.0등급 이내</strong></td>
                                        <td>모든 활동 완료</td>
                                        <td><span class="badge badge-warning">성균관대·한양대 소프트웨어 합격권</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>2.5등급 이내</strong></td>
                                        <td>주요 활동 완료</td>
                                        <td><span class="badge badge-success">중앙대·경희대 컴퓨터공학과 합격권</span></td>
                                    </tr>
                                </tbody>
                            </table>

                            <p style="margin-top: 15px; color: #666; font-size: 0.9em; font-style: italic;">
                                * 2024학년도 서울고등학교 컴퓨터공학과 합격자 평균 데이터 기반 분석
                            </p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF 다운로드 버튼 (모달 열렸을 때 표시) -->
    <button class="pdf-button" id="pdfButton" onclick="downloadPDF()">
        📥 PDF 다운로드
    </button>

    <script>
        // Chart.js 기본 설정
        Chart.defaults.font.family = "'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif";

        // 차트 인스턴스 저장
        let charts = {};

        // 전역 변수로 수집된 데이터 저장
        let studentData = {};
        let schoolDetailData = {};

        // 등급-점수 변환 함수
        function gradeToScore(grade) {
            const gradeMap = {
                '1': 95, '2': 90, '3': 85, '4': 80,
                '5': 75, '6': 70, '7': 65, '8': 60, '9': 55
            };
            return gradeMap[grade] || 0;
        }

        // 평균 등급 계산 함수
        function calculateAvgGrade(grades) {
            const validGrades = grades.filter(g => g > 0 && g <= 9);
            if (validGrades.length === 0) return 0;
            const sum = validGrades.reduce((a, b) => parseFloat(a) + parseFloat(b), 0);
            return (sum / validGrades.length).toFixed(1);
        }

        // 데이터 수집 함수
        function collectAllData() {
            const data = {
                // 기본 정보
                name: document.getElementById('studentName').value || '학생',
                grade: document.getElementById('currentGrade').value,
                schoolName: document.getElementById('schoolName').value || '학교',

                // 희망 진로
                major: document.getElementById('major').value,
                department: document.getElementById('department').value || '미정',
                keywords: document.getElementById('keywords').value,

                // 성적 정보
                grades: {
                    korean: document.getElementById('gradeKorean').value,
                    english: document.getElementById('gradeEnglish').value,
                    math: document.getElementById('gradeMath').value
                },

                // 추가 과목 정보
                additionalSubjects: [],

                // 활동 정보
                activities: {
                    club: parseInt(document.getElementById('activityClub').value) || 0,
                    award: parseInt(document.getElementById('activityAward').value) || 0,
                    project: parseInt(document.getElementById('activityProject').value) || 0,
                    details: document.getElementById('activityDetails').value
                },

                // 목표
                targets: {
                    univ1: document.getElementById('targetUniv1').value || '미정',
                    univ2: document.getElementById('targetUniv2').value || '미정',
                    univ3: document.getElementById('targetUniv3').value || '',
                    univ4: document.getElementById('targetUniv4').value || ''
                },

                // 강점
                strengths: document.getElementById('strengths').value
            };

            // 추가 과목 수집
            for (let i = 1; i <= additionalSubjectCount; i++) {
                const nameEl = document.getElementById(`subjectName${i}`);
                const gradeEl = document.getElementById(`subjectGrade${i}`);

                if (nameEl && gradeEl && nameEl.value && gradeEl.value) {
                    data.additionalSubjects.push({
                        name: nameEl.value,
                        grade: gradeEl.value
                    });
                }
            }

            // 평균 등급 계산 (필수 과목 + 추가 과목)
            const gradeValues = Object.values(data.grades).filter(g => g !== '').map(g => parseFloat(g));
            const additionalGradeValues = data.additionalSubjects.map(s => parseFloat(s.grade));
            const allGrades = [...gradeValues, ...additionalGradeValues];
            data.avgGrade = calculateAvgGrade(allGrades);

            studentData = data;
            return data;
        }

        // 데이터 검증 함수
        function validateData(data) {
            const errors = [];

            if (!data.name.trim()) errors.push('학생 이름을 입력해주세요');
            if (!data.schoolName.trim()) errors.push('학교명을 입력해주세요');

            // 국영수 필수 입력 확인
            if (!data.grades.korean) errors.push('국어 성적을 입력해주세요');
            if (!data.grades.english) errors.push('영어 성적을 입력해주세요');
            if (!data.grades.math) errors.push('수학 성적을 입력해주세요');

            return errors;
        }

        // localStorage 저장
        function saveToLocalStorage(data) {
            try {
                localStorage.setItem('studycareRoadmapData', JSON.stringify(data));
                localStorage.setItem('studycareRoadmapDate', new Date().toISOString());
            } catch (e) {
                console.error('데이터 저장 실패:', e);
            }
        }

        // localStorage 불러오기
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('studycareRoadmapData');
                const savedDate = localStorage.getItem('studycareRoadmapDate');

                if (savedData && savedDate) {
                    const data = JSON.parse(savedData);
                    const date = new Date(savedDate);
                    const daysDiff = (new Date() - date) / (1000 * 60 * 60 * 24);

                    // 7일 이내의 데이터만 불러오기
                    if (daysDiff < 7) {
                        const confirmLoad = confirm(`${date.toLocaleDateString('ko-KR')}에 저장된 데이터가 있습니다.\n불러오시겠습니까?`);
                        if (confirmLoad) {
                            try {
                                fillFormWithData(data);
                                return true;
                            } catch (fillError) {
                                console.error('데이터 채우기 실패:', fillError);
                                // 잘못된 데이터 삭제
                                localStorage.removeItem('studentRoadmapData');
                                alert('저장된 데이터 형식이 맞지 않아 삭제했습니다. 다시 입력해주세요.');
                            }
                        }
                    } else {
                        // 7일 이상 된 데이터 자동 삭제
                        localStorage.removeItem('studentRoadmapData');
                    }
                }
            } catch (e) {
                console.error('데이터 불러오기 실패:', e);
                // 오류 발생 시 localStorage 초기화
                localStorage.removeItem('studentRoadmapData');
            }
            return false;
        }

        // 폼에 데이터 채우기
        function fillFormWithData(data) {
            const nameEl = document.getElementById('studentName');
            const gradeEl = document.getElementById('currentGrade');
            const schoolEl = document.getElementById('schoolName');
            const majorEl = document.getElementById('major');
            const deptEl = document.getElementById('department');
            const keywordsEl = document.getElementById('keywords');

            if (nameEl) nameEl.value = data.name || '';
            if (gradeEl) gradeEl.value = data.grade || '1';
            if (schoolEl) schoolEl.value = data.schoolName || '';
            if (majorEl) majorEl.value = data.major || '자연계열';
            if (deptEl) deptEl.value = data.department || '';
            if (keywordsEl) keywordsEl.value = data.keywords || '';

            // 성적 정보
            if (data.grades) {
                const koreanEl = document.getElementById('gradeKorean');
                const englishEl = document.getElementById('gradeEnglish');
                const mathEl = document.getElementById('gradeMath');
                const scienceEl = document.getElementById('gradeScience');
                const socialEl = document.getElementById('gradeSocial');
                const infoEl = document.getElementById('gradeInfo');

                if (koreanEl) koreanEl.value = data.grades.korean || '';
                if (englishEl) englishEl.value = data.grades.english || '';
                if (mathEl) mathEl.value = data.grades.math || '';
                if (scienceEl) scienceEl.value = data.grades.science || '';
                if (socialEl) socialEl.value = data.grades.social || '';
                if (infoEl) infoEl.value = data.grades.info || '';
            }

            // 활동 정보
            if (data.activities) {
                const clubEl = document.getElementById('activityClub');
                const awardEl = document.getElementById('activityAward');
                const projectEl = document.getElementById('activityProject');
                const detailsEl = document.getElementById('activityDetails');

                if (clubEl) clubEl.value = data.activities.club || 0;
                if (awardEl) awardEl.value = data.activities.award || 0;
                if (projectEl) projectEl.value = data.activities.project || 0;
                if (detailsEl) detailsEl.value = data.activities.details || '';
            }

            // 목표
            if (data.targets) {
                const univ1El = document.getElementById('targetUniv1');
                const univ2El = document.getElementById('targetUniv2');
                const univ3El = document.getElementById('targetUniv3');
                const univ4El = document.getElementById('targetUniv4');

                if (univ1El) univ1El.value = data.targets.univ1 || '';
                if (univ2El) univ2El.value = data.targets.univ2 || '';
                if (univ3El) univ3El.value = data.targets.univ3 || '';
                if (univ4El) univ4El.value = data.targets.univ4 || '';
            }

            const strengthsEl = document.getElementById('strengths');
            if (strengthsEl) strengthsEl.value = data.strengths || '';
        }

        // 모달창 열기
        window.openModal = function() {
            document.getElementById('reportModal').classList.add('active');
            document.getElementById('pdfButton').classList.add('show');
            document.body.style.overflow = 'hidden';

            // 차트 생성 (처음 열 때만)
            if (!charts.gradeRadar) {
                setTimeout(() => {
                    createCharts();
                }, 100);
            }
        }

        // 모달창 닫기
        window.closeModal = function() {
            document.getElementById('reportModal').classList.remove('active');
            document.getElementById('pdfButton').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // 모달 외부 클릭 시 닫기
        document.getElementById('reportModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('reportModal')) {
                closeModal();
            }
        });

        // 페이지 로드 시 저장된 데이터 확인
        window.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
        });

        // 차트 생성 함수
        function createCharts() {
            // 데이터가 없으면 수집
            if (!studentData.grades) {
                collectAllData();
            }

            // 1. 과목별 성적 레이더 차트 - 실제 입력 데이터 사용
            const currentScores = [
                gradeToScore(studentData.grades.korean || '5'),
                gradeToScore(studentData.grades.english || '5'),
                gradeToScore(studentData.grades.math || '5'),
                gradeToScore(studentData.grades.science || '5'),
                gradeToScore(studentData.grades.info || '5'),
                gradeToScore(studentData.grades.social || '5')
            ];

            // 목표 성적 계산 (현재 성적보다 1~2등급 높게 설정)
            const targetScores = currentScores.map(score => Math.min(score + 10, 95));

            const gradeRadarCtx = document.getElementById('gradeRadarChart').getContext('2d');
            charts.gradeRadar = new Chart(gradeRadarCtx, {
                type: 'radar',
                data: {
                    labels: ['국어', '영어', '수학', '과학', '정보', '사회'],
                    datasets: [{
                        label: '현재 성적',
                        data: currentScores,
                        borderColor: '#ca8a04',
                        backgroundColor: 'rgba(202, 138, 4, 0.2)',
                        borderWidth: 2,
                        pointBackgroundColor: '#ca8a04',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#ca8a04'
                    }, {
                        label: '목표 성적',
                        data: targetScores,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderWidth: 2,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.r + '점';
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });

            // 2. 대학별 합격 가능성 도넛 차트 - 평균 등급 기반 계산
            const avgGrade = parseFloat(studentData.avgGrade) || 3.0;
            let possibilityData = [10, 30, 40, 20]; // 기본값

            // 등급에 따른 합격 가능성 계산
            if (avgGrade <= 1.5) {
                possibilityData = [35, 40, 20, 5]; // 최상위권
            } else if (avgGrade <= 2.0) {
                possibilityData = [25, 35, 35, 5]; // 상위권
            } else if (avgGrade <= 2.5) {
                possibilityData = [15, 35, 40, 10]; // 중상위권
            } else if (avgGrade <= 3.0) {
                possibilityData = [10, 30, 45, 15]; // 중위권
            } else {
                possibilityData = [5, 20, 50, 25]; // 중하위권
            }

            const universityDoughnutCtx = document.getElementById('universityDoughnutChart').getContext('2d');
            charts.universityDoughnut = new Chart(universityDoughnutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['도전대학', '적정대학', '안정대학', '최소안전대학'],
                    datasets: [{
                        label: '합격 가능성',
                        data: possibilityData,
                        backgroundColor: [
                            '#ef4444',
                            '#f59e0b',
                            '#10b981',
                            '#06b6d4'
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });

            // 3. 3개년 활동 타임라인 차트 - 입력 데이터 기반 생성
            const currentGrade = parseInt(studentData.grade) || 1;
            const activities = studentData.activities;

            // 현재 학년에 따라 데이터 생성
            let timelineData = {
                교내활동: [],
                독서활동: [],
                봉사활동: [],
                진로탐구: []
            };

            // 활동 데이터 분배 (학년별로 증가하는 패턴)
            for (let i = 0; i < 10; i++) {
                const semester = Math.floor(i / 4) + 1; // 1, 2, 3학년
                const isCurrentOrPast = semester <= currentGrade;

                if (isCurrentOrPast) {
                    // 실제 활동 데이터 반영
                    timelineData.교내활동.push(Math.max(1, Math.floor(activities.award / 3) + Math.floor(Math.random() * 2)));
                    timelineData.독서활동.push(Math.max(1, 2 + Math.floor(Math.random() * 2)));
                    timelineData.봉사활동.push(Math.max(1, Math.floor(activities.volunteer / 20) + 1));
                    timelineData.진로탐구.push(Math.max(1, Math.floor(activities.project / 2) + semester));
                } else {
                    // 미래 예상 데이터
                    timelineData.교내활동.push(3 + semester);
                    timelineData.독서활동.push(2 + Math.floor(semester / 2));
                    timelineData.봉사활동.push(2);
                    timelineData.진로탐구.push(2 + semester);
                }
            }

            const timelineCtx = document.getElementById('timelineChart').getContext('2d');
            charts.timeline = new Chart(timelineCtx, {
                type: 'bar',
                data: {
                    labels: [
                        '1-1학기', '1-2학기', '1-여름', '1-겨울',
                        '2-1학기', '2-2학기', '2-여름', '2-겨울',
                        '3-1학기', '3-2학기'
                    ],
                    datasets: [{
                        label: '교내활동',
                        data: timelineData.교내활동,
                        backgroundColor: '#ca8a04'
                    }, {
                        label: '독서활동',
                        data: timelineData.독서활동,
                        backgroundColor: '#854d0e'
                    }, {
                        label: '봉사활동',
                        data: timelineData.봉사활동,
                        backgroundColor: '#10b981'
                    }, {
                        label: '진로탐구',
                        data: timelineData.진로탐구,
                        backgroundColor: '#06b6d4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '활동 수'
                            }
                        }
                    }
                }
            });

            // 4. 학년별 활동 비중 분석 - 입력 데이터 기반
            const activityTotal = activities.club + activities.award + activities.project + (activities.volunteer / 10);

            // 활동 비중 계산 (학년별 추천 비중)
            let grade1Data, grade2Data, grade3Data;

            if (currentGrade === 1) {
                // 1학년: 현재 활동 비중 반영
                grade1Data = [
                    Math.round((activities.club / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.award / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.project / Math.max(activityTotal, 1)) * 100),
                    Math.round(((activities.volunteer / 10) / Math.max(activityTotal, 1)) * 100)
                ];
                // 2,3학년은 추천 비중
                grade2Data = [30, 25, 25, 20];
                grade3Data = [20, 30, 35, 15];
            } else if (currentGrade === 2) {
                grade1Data = [30, 20, 15, 35]; // 1학년 과거 예상
                // 2학년: 현재 활동 비중 반영
                grade2Data = [
                    Math.round((activities.club / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.award / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.project / Math.max(activityTotal, 1)) * 100),
                    Math.round(((activities.volunteer / 10) / Math.max(activityTotal, 1)) * 100)
                ];
                grade3Data = [20, 30, 40, 10]; // 3학년 추천
            } else {
                grade1Data = [35, 15, 10, 40]; // 1학년 과거
                grade2Data = [30, 25, 20, 25]; // 2학년 과거
                // 3학년: 현재 활동 비중 반영
                grade3Data = [
                    Math.round((activities.club / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.award / Math.max(activityTotal, 1)) * 100),
                    Math.round((activities.project / Math.max(activityTotal, 1)) * 100),
                    Math.round(((activities.volunteer / 10) / Math.max(activityTotal, 1)) * 100)
                ];
            }

            const activityBarCtx = document.getElementById('activityBarChart').getContext('2d');
            charts.activityBar = new Chart(activityBarCtx, {
                type: 'bar',
                data: {
                    labels: ['1학년', '2학년', '3학년'],
                    datasets: [{
                        label: '동아리',
                        data: [grade1Data[0], grade2Data[0], grade3Data[0]],
                        backgroundColor: '#ca8a04'
                    }, {
                        label: '대회참가',
                        data: [grade1Data[1], grade2Data[1], grade3Data[1]],
                        backgroundColor: '#854d0e'
                    }, {
                        label: '프로젝트',
                        data: [grade1Data[2], grade2Data[2], grade3Data[2]],
                        backgroundColor: '#10b981'
                    }, {
                        label: '봉사활동',
                        data: [grade1Data[3], grade2Data[3], grade3Data[3]],
                        backgroundColor: '#06b6d4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '비중 (%)'
                            }
                        }
                    }
                }
            });

            // 5. 교육과정 이수 계획
            const curriculumCtx = document.getElementById('curriculumChart').getContext('2d');
            charts.curriculum = new Chart(curriculumCtx, {
                type: 'polarArea',
                data: {
                    labels: ['수학', '과학', '정보', '인문', '예체능'],
                    datasets: [{
                        label: '이수 단위',
                        data: [30, 28, 24, 18, 10],
                        backgroundColor: [
                            'rgba(202, 138, 4, 0.8)',
                            'rgba(133, 77, 14, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(6, 182, 212, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // PDF 다운로드 함수
        window.downloadPDF = function() {
            const element = document.getElementById('reportContent');
            const studentName = document.getElementById('studentName').value || '학생';
            const today = new Date().toISOString().split('T')[0];

            // PDF 설정
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `스터디케어_입시전략로드맵_${studentName}_${today}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    letterRendering: true,
                    windowWidth: 1200
                },
                jsPDF: {
                    unit: 'mm',
                    format: 'a4',
                    orientation: 'portrait',
                    compress: true
                },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // 로딩 표시
            const pdfButton = document.getElementById('pdfButton');
            const originalText = pdfButton.innerHTML;
            pdfButton.innerHTML = '⏳ PDF 생성 중...';
            pdfButton.disabled = true;

            // PDF 생성
            html2pdf().set(opt).from(element).save().then(() => {
                // 완료 후 버튼 복원
                pdfButton.innerHTML = originalText;
                pdfButton.disabled = false;
            }).catch((error) => {
                console.error('PDF 생성 오류:', error);
                alert('PDF 생성 중 오류가 발생했습니다.');
                pdfButton.innerHTML = originalText;
                pdfButton.disabled = false;
            });
        }

        window.goToStep2 = async function() {
            // 1. 데이터 수집 및 검증
            const data = collectAllData();
            const errors = validateData(data);

            if (errors.length > 0) {
                alert(errors.join('\n'));
                return;
            }

            // 데이터 저장
            saveToLocalStorage(data);

            // 문서 헤더 정보 업데이트
            const docName = document.getElementById('doc-name');
            const docGrade = document.getElementById('doc-grade');
            const docSchool = document.getElementById('doc-school');
            const docMajor = document.getElementById('doc-major');
            const docDept = document.getElementById('doc-dept');

            if (docName) docName.textContent = data.name;
            if (docGrade) docGrade.textContent = `고등학교 ${data.grade}학년`;
            if (docSchool) docSchool.textContent = data.schoolName;
            if (docMajor) docMajor.textContent = data.major;
            if (docDept) docDept.textContent = data.department;

            // 날짜와 문서 번호 설정 (요소가 있는 경우만)
            const today = new Date();
            const docDate = document.getElementById('doc-date');
            const docNumber = document.getElementById('doc-number');

            if (docDate) docDate.textContent = today.toLocaleDateString('ko-KR');
            if (docNumber) docNumber.textContent = Math.floor(Math.random() * 10000).toString().padStart(4, '0');

            // 모달 열기
            const reportModal = document.getElementById('reportModal');
            if (!reportModal) {
                console.error('reportModal 요소를 찾을 수 없습니다.');
                return;
            }
            reportModal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // 로딩 오버레이를 모달 콘텐츠 위에 추가
            const modalContent = document.querySelector('.modal-content');
            if (!modalContent) {
                console.error('modal-content 요소를 찾을 수 없습니다.');
                return;
            }

            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="loading-spinner"></div>
                <div class="loading-message">AI가 분석 중입니다... ✨</div>
            `;
            modalContent.appendChild(loadingOverlay);

            // 선택한 학교가 있으면 추가 정보 수집
            if (selectedSchoolCode) {
                await loadAdditionalSchoolData();
            }

            // AI 분석 및 보고서 생성
            setTimeout(() => {
                // AI 인사이트 생성
                const insights = generateAIInsights(data);

                // 맞춤형 로드맵 생성
                const roadmap = generatePersonalizedRoadmap(data);

                // 보고서 내용 동적 업데이트
                updateReportContent(data, insights, roadmap);

                // 로딩 제거
                loadingOverlay.remove();
                const pdfButton = document.getElementById('pdfButton');
                if (pdfButton) pdfButton.classList.add('show');

                // 차트 생성
                if (!charts.gradeRadar) {
                    setTimeout(() => {
                        createCharts();
                    }, 100);
                }
            }, 2000);
        }

        // AI 인사이트 생성 함수 (룰 기반)
        function generateAIInsights(data) {
            const insights = {
                grades: {
                    strong: [],
                    weak: [],
                    improvement: []
                },
                activities: {
                    strong: [],
                    lacking: [],
                    recommendations: []
                },
                overall: {
                    possibility: 0,
                    strengths: [],
                    challenges: []
                }
            };

            // 성적 분석
            const gradeThreshold = 3; // 3등급 기준
            Object.entries(data.grades).forEach(([subject, grade]) => {
                if (grade && grade !== '') {
                    const gradeNum = parseFloat(grade);
                    const subjectNames = {
                        korean: '국어', english: '영어', math: '수학',
                        science: '과학', social: '사회', info: '정보'
                    };

                    if (gradeNum <= 2) {
                        insights.grades.strong.push(`${subjectNames[subject]} (${grade}등급)`);
                    } else if (gradeNum >= 4) {
                        insights.grades.weak.push(`${subjectNames[subject]} (${grade}등급)`);
                        insights.grades.improvement.push(`${subjectNames[subject]} 성적 향상 필요`);
                    }
                }
            });

            // 활동 분석
            const activities = data.activities;
            const totalActivities = activities.club + activities.award + activities.project;

            if (activities.club >= 2) {
                insights.activities.strong.push('동아리 활동 활발');
            } else {
                insights.activities.lacking.push('동아리 활동 부족');
            }

            if (activities.award >= 3) {
                insights.activities.strong.push('교내 대회 참가 우수');
            } else {
                insights.activities.lacking.push('교내 대회 참가 필요');
            }

            if (activities.volunteer >= 20) {
                insights.activities.strong.push('봉사활동 시간 충분');
            } else {
                insights.activities.lacking.push(`봉사활동 시간 보충 필요 (현재 ${activities.volunteer}시간)`);
            }

            // 희망 학과별 추천 활동
            if (data.department.includes('컴퓨터') || data.department.includes('소프트웨어')) {
                insights.activities.recommendations.push('프로그래밍 동아리 활동 권장');
                insights.activities.recommendations.push('코딩 대회 참가 추천');
                insights.activities.recommendations.push('앱/웹 개발 프로젝트 수행');
            } else if (data.department.includes('의') || data.department.includes('약')) {
                insights.activities.recommendations.push('생명과학 동아리 활동');
                insights.activities.recommendations.push('의료봉사 활동 참여');
                insights.activities.recommendations.push('과학 실험 프로젝트 수행');
            }

            // 전체 가능성 계산
            const avgGrade = parseFloat(data.avgGrade) || 3.0;
            if (avgGrade <= 1.5) {
                insights.overall.possibility = 90;
                insights.overall.strengths.push('최상위권 성적 유지');
            } else if (avgGrade <= 2.0) {
                insights.overall.possibility = 75;
                insights.overall.strengths.push('상위권 성적 유지');
            } else if (avgGrade <= 2.5) {
                insights.overall.possibility = 60;
                insights.overall.challenges.push('주요 과목 성적 향상 필요');
            } else if (avgGrade <= 3.0) {
                insights.overall.possibility = 45;
                insights.overall.challenges.push('전반적인 성적 향상 필요');
            } else {
                insights.overall.possibility = 30;
                insights.overall.challenges.push('집중적인 학습 전략 수립 필요');
            }

            return insights;
        }

        // 맞춤형 로드맵 자동 생성
        function generatePersonalizedRoadmap(data) {
            const currentGrade = parseInt(data.grade);
            const roadmap = {
                grade1: [],
                grade2: [],
                grade3: []
            };

            // 1학년 로드맵
            roadmap.grade1 = [
                '기초 학력 다지기: 국영수 중심 학습',
                '진로 탐색: 다양한 분야 체험 활동',
                `동아리 선택: ${data.department} 관련 동아리 가입`,
                '독서 활동: 월 2권 이상 전공 관련 도서',
                '봉사활동: 학기당 20시간 이상 수행'
            ];

            // 2학년 로드맵
            roadmap.grade2 = [
                '심화 학습: 선택과목 집중 관리',
                `전공 탐구: ${data.department} 관련 프로젝트 수행`,
                '교내 대회: 학기당 2개 이상 참가',
                '진로 활동: 대학 탐방 및 전공 체험',
                '리더십 활동: 학급/동아리 임원 활동'
            ];

            // 3학년 로드맵
            roadmap.grade3 = [
                '입시 준비: 수시/정시 전략 수립',
                '성적 관리: 내신 최종 마무리',
                '자소서 준비: 활동 정리 및 스토리 구성',
                '면접 준비: 전공 지식 및 시사 학습',
                '최종 점검: 생기부 확인 및 보완'
            ];

            // 현재 학년별 맞춤 조언
            if (currentGrade === 1) {
                roadmap.current = [
                    '탐색 단계: 다양한 활동을 통해 적성 파악',
                    '기초 학력 향상에 집중',
                    '생활기록부 기초 틀 마련'
                ];
            } else if (currentGrade === 2) {
                roadmap.current = [
                    '심화 단계: 전공 관련 활동 집중',
                    '리더십과 협업 능력 개발',
                    '목표 대학 입시 전형 분석'
                ];
            } else {
                roadmap.current = [
                    '완성 단계: 입시 전략 실행',
                    '부족한 부분 집중 보완',
                    '자기소개서 및 면접 준비'
                ];
            }

            return roadmap;
        }

        // 보고서 내용 동적 업데이트
        function updateReportContent(data, insights, roadmap) {
            // 통계 카드 업데이트
            const statsCards = document.querySelectorAll('.stat-card');
            if (statsCards.length >= 4) {
                statsCards[0].querySelector('.stat-value').textContent = data.avgGrade || '-';
                statsCards[1].querySelector('.stat-value').textContent = data.targets.grade || '-';
                statsCards[2].querySelector('.stat-value').textContent = `${insights.overall.possibility}%`;

                // 예상 석차 계산
                const avgGrade = parseFloat(data.avgGrade) || 3.0;
                const estimatedRank = Math.round(avgGrade * 10);
                statsCards[3].querySelector('.stat-value').textContent = `상위 ${estimatedRank}%`;
            }

            // AI 인사이트 업데이트
            updateAIInsightSections(data, insights);

            // 대학 추천 업데이트
            updateUniversityRecommendations(data, insights);

            // 로드맵 업데이트
            updateRoadmapSections(roadmap);

            // 학교 맞춤 전략 업데이트
            if (selectedSchoolCode) {
                updateSchoolStrategy(data);
            }
        }

        // AI 인사이트 섹션 업데이트
        function updateAIInsightSections(data, insights) {
            // 성적 분석 인사이트
            const gradeInsights = document.querySelectorAll('.insight-box')[0];
            if (gradeInsights) {
                let gradeText = `<strong>${data.name}</strong> 학생의 성적 분석 결과:<br><br>`;

                if (insights.grades.strong.length > 0) {
                    gradeText += `✅ <strong>강점 과목:</strong> ${insights.grades.strong.join(', ')}<br>`;
                }
                if (insights.grades.weak.length > 0) {
                    gradeText += `⚠️ <strong>보완 필요:</strong> ${insights.grades.weak.join(', ')}<br>`;
                }
                gradeText += `<br>📊 <strong>평균 등급:</strong> ${data.avgGrade}등급<br>`;
                gradeText += `🎯 <strong>목표 등급:</strong> ${data.targets.grade}등급`;

                gradeInsights.innerHTML = gradeText;
            }

            // 활동 분석 인사이트
            const activityInsights = document.querySelectorAll('.insight-box')[1];
            if (activityInsights) {
                let activityText = '<strong>활동 포트폴리오 분석:</strong><br><br>';

                if (insights.activities.strong.length > 0) {
                    activityText += `✅ <strong>우수 영역:</strong><br>`;
                    insights.activities.strong.forEach(item => {
                        activityText += `• ${item}<br>`;
                    });
                }
                if (insights.activities.lacking.length > 0) {
                    activityText += `<br>📌 <strong>보강 필요:</strong><br>`;
                    insights.activities.lacking.forEach(item => {
                        activityText += `• ${item}<br>`;
                    });
                }

                activityInsights.innerHTML = activityText;
            }

            // 종합 평가 인사이트
            const overallInsights = document.querySelectorAll('.insight-box')[2];
            if (overallInsights) {
                let overallText = `<strong>${data.targets.univ1}</strong> ${data.department} 합격 가능성 분석:<br><br>`;
                overallText += `🎯 <strong>합격 가능성:</strong> ${insights.overall.possibility}%<br><br>`;

                if (insights.activities.recommendations.length > 0) {
                    overallText += `💡 <strong>추천 활동:</strong><br>`;
                    insights.activities.recommendations.forEach(item => {
                        overallText += `• ${item}<br>`;
                    });
                }

                overallInsights.innerHTML = overallText;
            }
        }

        // 대학 추천 업데이트
        function updateUniversityRecommendations(data, insights) {
            const avgGrade = parseFloat(data.avgGrade) || 3.0;
            const tierBoxes = document.querySelectorAll('.tier-box');

            // 대학 목록 (실제 데이터베이스 대체 필요)
            const universities = {
                challenge: [],
                appropriate: [],
                safety: []
            };

            if (avgGrade <= 1.5) {
                universities.challenge = ['서울대', '연세대', '고려대'];
                universities.appropriate = ['성균관대', '한양대', '서강대'];
                universities.safety = ['중앙대', '경희대', '한국외대'];
            } else if (avgGrade <= 2.0) {
                universities.challenge = ['성균관대', '한양대', '서강대'];
                universities.appropriate = ['중앙대', '경희대', '한국외대'];
                universities.safety = ['건국대', '동국대', '홍익대'];
            } else if (avgGrade <= 2.5) {
                universities.challenge = ['중앙대', '경희대', '한국외대'];
                universities.appropriate = ['건국대', '동국대', '홍익대'];
                universities.safety = ['숭실대', '세종대', '광운대'];
            } else {
                universities.challenge = ['건국대', '동국대', '홍익대'];
                universities.appropriate = ['숭실대', '세종대', '광운대'];
                universities.safety = ['명지대', '상명대', '서울과기대'];
            }

            // 도전 대학
            if (tierBoxes[0]) {
                const univList = tierBoxes[0].querySelector('.tier-universities');
                if (data.targets.univ1 && !universities.challenge.includes(data.targets.univ1)) {
                    universities.challenge.unshift(data.targets.univ1);
                }
                univList.innerHTML = universities.challenge.map(univ =>
                    `<span class="university-chip">${univ} ${data.department}</span>`
                ).join('');
            }

            // 적정 대학
            if (tierBoxes[1]) {
                const univList = tierBoxes[1].querySelector('.tier-universities');
                if (data.targets.univ2 && !universities.appropriate.includes(data.targets.univ2)) {
                    universities.appropriate.unshift(data.targets.univ2);
                }
                univList.innerHTML = universities.appropriate.map(univ =>
                    `<span class="university-chip">${univ} ${data.department}</span>`
                ).join('');
            }

            // 안정 대학
            if (tierBoxes[2]) {
                const univList = tierBoxes[2].querySelector('.tier-universities');
                univList.innerHTML = universities.safety.map(univ =>
                    `<span class="university-chip">${univ} ${data.department}</span>`
                ).join('');
            }
        }

        // 로드맵 섹션 업데이트
        function updateRoadmapSections(roadmap) {
            // 1학년 로드맵
            const grade1Section = document.querySelectorAll('.timeline-grade')[0];
            if (grade1Section) {
                const itemsContainer = grade1Section.querySelector('.timeline-items');
                itemsContainer.innerHTML = roadmap.grade1.map(item =>
                    `<div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-title">${item}</div>
                        </div>
                    </div>`
                ).join('');
            }

            // 2학년 로드맵
            const grade2Section = document.querySelectorAll('.timeline-grade')[1];
            if (grade2Section) {
                const itemsContainer = grade2Section.querySelector('.timeline-items');
                itemsContainer.innerHTML = roadmap.grade2.map(item =>
                    `<div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-title">${item}</div>
                        </div>
                    </div>`
                ).join('');
            }

            // 3학년 로드맵
            const grade3Section = document.querySelectorAll('.timeline-grade')[2];
            if (grade3Section) {
                const itemsContainer = grade3Section.querySelector('.timeline-items');
                itemsContainer.innerHTML = roadmap.grade3.map(item =>
                    `<div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-title">${item}</div>
                        </div>
                    </div>`
                ).join('');
            }
        }

        // 학교 맞춤 전략 업데이트
        function updateSchoolStrategy(data) {
            const strategyList = document.querySelector('.strategy-list');
            if (strategyList && schoolDetailData) {
                let strategies = [];

                // 학교 데이터 기반 전략 생성
                strategies.push(`<strong>${data.grade}학년 ${data.semester}학기:</strong> 현재 시기 핵심 활동 집중`);
                strategies.push(`<strong>교내 활동:</strong> ${data.schoolName} 특색 프로그램 참여`);
                strategies.push(`<strong>${data.department}:</strong> 전공 관련 선택과목 수강 필수`);
                strategies.push(`<strong>성적 관리:</strong> 평균 ${data.targets.grade}등급 목표`);
                strategies.push(`<strong>생기부:</strong> 과목별 세특 내용 충실히 기록`);

                strategyList.innerHTML = strategies.map(strategy => `<li>${strategy}</li>`).join('');
            }
        }

        // 추가 학교 데이터 로드 (시간표, 교육과정, 학사일정 등)
        async function loadAdditionalSchoolData() {
            try {
                const year = new Date().getFullYear();
                const promises = [];

                // 1. 시간표 정보
                const timeTableUrl = `https://open.neis.go.kr/hub/hisTimetable?KEY=${NEIS_API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${selectedSchoolCode.ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${selectedSchoolCode.SD_SCHUL_CODE}&AY=${year}`;
                promises.push(fetch(timeTableUrl).then(res => res.json()));

                // 2. 학사일정
                const scheduleUrl = `https://open.neis.go.kr/hub/SchoolSchedule?KEY=${NEIS_API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${selectedSchoolCode.ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${selectedSchoolCode.SD_SCHUL_CODE}&AA_YMD=${year}01&AA_TO_YMD=${year}12`;
                promises.push(fetch(scheduleUrl).then(res => res.json()));

                // 3. 학과정보
                const majorUrl = `https://open.neis.go.kr/hub/schoolMajorinfo?KEY=${NEIS_API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${selectedSchoolCode.ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${selectedSchoolCode.SD_SCHUL_CODE}`;
                promises.push(fetch(majorUrl).then(res => res.json()));

                const results = await Promise.allSettled(promises);

                // 시간표 데이터
                if (results[0].status === 'fulfilled' && results[0].value.hisTimetable) {
                    schoolDetailData.timetable = results[0].value.hisTimetable[1]?.row || [];
                    console.log('시간표 데이터 로드 완료');
                }

                // 학사일정 데이터
                if (results[1].status === 'fulfilled' && results[1].value.SchoolSchedule) {
                    schoolDetailData.schedule = results[1].value.SchoolSchedule[1]?.row || [];
                    console.log('학사일정 데이터 로드 완료');

                    // 주요 행사 추출
                    const majorEvents = schoolDetailData.schedule.filter(event =>
                        event.EVENT_NM.includes('대회') ||
                        event.EVENT_NM.includes('경시') ||
                        event.EVENT_NM.includes('평가')
                    );
                    schoolDetailData.majorEvents = majorEvents;
                }

                // 학과정보 데이터
                if (results[2].status === 'fulfilled' && results[2].value.schoolMajorinfo) {
                    schoolDetailData.majors = results[2].value.schoolMajorinfo[1]?.row || [];
                    console.log('학과정보 데이터 로드 완료');
                }

            } catch (error) {
                console.error('추가 데이터 로드 오류:', error);
                schoolDetailData = {}; // 에러 시 빈 객체로 초기화
            }
        }


        // 교육과정 섹션 업데이트
        function updateCurriculumSection() {
            // 시간표 데이터에서 개설 과목 추출
            if (window.timeTableData && window.timeTableData.hisTimetable && window.timeTableData.hisTimetable[1]) {
                const subjects = window.timeTableData.hisTimetable[1].row;
                const uniqueSubjects = [...new Set(subjects.map(s => s.ITRT_CNTNT))];

                console.log('개설 과목:', uniqueSubjects);

                // 개설 과목 표시 업데이트
                const subjectsHtml = uniqueSubjects.slice(0, 10).map(subject =>
                    `<span class="badge badge-primary">${subject}</span>`
                ).join(' ');

                // 교육과정 테이블의 개설 과목 행 찾아서 업데이트
                const rows = document.querySelectorAll('.data-table tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells[0] && cells[0].textContent.includes('개설 선택과목')) {
                        cells[1].innerHTML = subjectsHtml + ` 외 ${uniqueSubjects.length - 10}과목`;
                    }
                });
            }

            // 분석 결과 업데이트
            const analysisBox = document.querySelector('.strategy-content');
            if (analysisBox && selectedSchoolCode) {
                const schoolName = document.getElementById('schoolName').value;
                analysisBox.innerHTML = `
                    <strong>${schoolName}</strong>의 실제 교육과정 데이터를 기반으로 분석한 결과입니다.
                    학교알리미 API를 통해 ${window.timeTableData ? '시간표 정보' : '교육과정 정보'}를 성공적으로 불러왔습니다.
                    해당 학교의 특색사업과 개설 과목을 고려한 맞춤형 활동 계획을 수립하시기 바랍니다.
                `;
            }
        }


        // API 인증키
        const NEIS_API_KEY = 'cdf2d5e7030b405fa10d0198207464e3';
        const SCHOOLINFO_API_KEY = 'b9a52111e6b64fc9ab50d52aa2619e0a';

        let selectedSchoolCode = null;
        let searchTimeout = null;
        let departmentSearchTimeout = null;
        let additionalSubjectCount = 0;
        let currentStep = 1;

        // 다음 단계로 이동하는 함수
        window.goToNextStep = function(stepNumber) {
            // 현재 단계 완료 표시
            const currentCard = document.getElementById(`stepCard${currentStep}`);
            if (currentCard) {
                currentCard.classList.add('completed');
            }

            // 다음 단계 보이기
            const nextCard = document.getElementById(`stepCard${stepNumber}`);
            if (nextCard) {
                nextCard.classList.add('visible');

                // 부드럽게 스크롤
                setTimeout(() => {
                    nextCard.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }

            currentStep = stepNumber;
        }

        // 추가 과목 입력 함수
        window.addSubject = function() {
            additionalSubjectCount++;
            const container = document.getElementById('additionalSubjectsContainer');

            const subjectDiv = document.createElement('div');
            subjectDiv.className = 'form-row';
            subjectDiv.id = `additionalSubject${additionalSubjectCount}`;
            subjectDiv.style.cssText = 'margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px; position: relative; animation: slideIn 0.3s ease-out;';

            subjectDiv.innerHTML = `
                <div class="form-group" style="margin-bottom: 0;">
                    <label>과목명</label>
                    <input type="text" id="subjectName${additionalSubjectCount}" placeholder="예: 물리학I, 화학I, 생명과학I" style="margin-bottom: 10px;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>등급</label>
                    <select id="subjectGrade${additionalSubjectCount}">
                        <option value="">선택</option>
                        <option value="1">1등급</option>
                        <option value="2">2등급</option>
                        <option value="3">3등급</option>
                        <option value="4">4등급</option>
                        <option value="5">5등급</option>
                        <option value="6">6등급</option>
                        <option value="7">7등급</option>
                        <option value="8">8등급</option>
                        <option value="9">9등급</option>
                    </select>
                </div>
                <button type="button" onclick="removeSubject(${additionalSubjectCount})" style="position: absolute; top: 10px; right: 10px; background: #fee2e2; color: #ef4444; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; transition: all 0.2s;" onmouseover="this.style.background='#ef4444'; this.style.color='white';" onmouseout="this.style.background='#fee2e2'; this.style.color='#ef4444';">×</button>
            `;

            container.appendChild(subjectDiv);

            // 애니메이션 스타일 추가
            if (!document.getElementById('slideInAnimation')) {
                const style = document.createElement('style');
                style.id = 'slideInAnimation';
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            opacity: 0;
                            transform: translateY(-10px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // 추가 과목 제거 함수
        window.removeSubject = function(id) {
            const subjectDiv = document.getElementById(`additionalSubject${id}`);
            if (subjectDiv) {
                subjectDiv.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    subjectDiv.remove();
                }, 300);
            }

            // 애니메이션 스타일 추가
            if (!document.getElementById('slideOutAnimation')) {
                const style = document.createElement('style');
                style.id = 'slideOutAnimation';
                style.textContent = `
                    @keyframes slideOut {
                        from {
                            opacity: 1;
                            transform: translateY(0);
                        }
                        to {
                            opacity: 0;
                            transform: translateY(-10px);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // 전국 주요 학과/전공 데이터베이스
        const allDepartments = [
            '없음',
            // 공학계열
            'AI학과', '가스안전공학과', '건설환경공학과', '건축공학과', '건축학과',
            '게임학과', '고분자공학과', '공간정보공학과', '광학공학과', '교통공학과',
            '국방디지털융합학과', '기계공학과', '기계설계공학과', '기계시스템공학과', '기계자동차공학과',
            '기계항공우주공학과', '나노공학과', '나노소재공학과', '냉동공조공학과', '녹색기술융합학과',
            '농공학과', '농업공학과', '데이터사이언스학과', '도시공학과', '반도체공학과',
            '방재안전공학과', '방송공학과', '멀티미디어공학과', '메카트로닉스공학과', '바이오메디컬공학과',
            '바이오시스템공학과', '바이오융합공학과', '바이오헬스융합학과', '반도체디스플레이공학과', '산업공학과',
            '산업경영공학과', '산업디자인공학과', '산업보안학과', '산업시스템공학과', '섬유공학과',
            '소방방재학과', '소방안전공학과', '소프트웨어학과', '소프트웨어융합학과', '수리학과',
            '스마트모빌리티학과', '스마트자동차학과', '신소재공학과', '신에너지공학과', '안경광학과',
            '안전공학과', '에너지공학과', '에너지자원공학과', '원자력공학과', '원예생명공학과',
            '융합공학과', '의공학과', '의료공학과', '의료IT학과', '인공지능학과',
            '인더스트리얼디자인학과', '자동차공학과', '재료공학과', '전기공학과', '전기전자공학과',
            '전자공학과', '전자디스플레이공학과', '전자전기공학부', '전자재료공학과', '정보보안학과',
            '정보통신공학과', '제어계측공학과', '조선해양공학과', '지구환경공학과', '지능기전공학과',
            '지능로봇공학과', '지능정보공학과', '지역건설공학과', '철도공학과', '컴퓨터공학과',
            '컴퓨터소프트웨어학부', '컴퓨터정보공학과', '토목공학과', '토목환경공학과', '통신공학과',
            '플랜트화학공학과', '항공우주공학과', '항공정비학과', '해양공학과', '화학공학과',
            '화학생명공학과', '환경공학과', '환경에너지공학과', '융합보안학과', '사이버보안학과',
            '블록체인학과', 'ICT융합학과', 'IoT학과',

            // 자연계열
            '간호학과', '대기과학과', '물리학과', '미생물학과', '바이오메디컬학과',
            '분자생명과학과', '생명과학과', '생명공학과', '생물학과', '생화학과',
            '수학과', '수학통계학부', '식품생명공학과', '식품영양학과', '약학과',
            '응용수학과', '응용생물학과', '응용통계학과', '의생명과학과', '임상병리학과',
            '자연과학부', '천문우주학과', '통계학과', '해양생명과학과', '해양학과',
            '화학과', '화장품학과', '환경생명과학과', '환경학과', '유전공학과',
            '분자생물학과', '뇌과학과', '인지과학과', '의예과', '치의예과', '한의예과', '수의예과',

            // 인문계열
            '국사학과', '국어국문학과', '노어노문학과', '동양사학과', '독어독문학과',
            '문헌정보학과', '문화인류학과', '미국학과', '불어불문학과', '사학과',
            '서양사학과', '스페인어과', '아랍어과', '아시아학과', '언어학과',
            '영미문화학과', '영어영문학과', '일본학과', '일어일문학과', '중국학과',
            '중어중문학과', '철학과', '포르투갈어과', '한국어학과', '한국학과',
            '한문학과', '러시아학과', '이탈리아어과', '폴란드어과', '터키어과',
            '베트남어과', '인도학과', '고고학과', '기록관리학과', '문화재학과',

            // 사회계열
            '경영학과', '경영정보학과', '경제학과', '관광경영학과', '관광학과',
            '교정보호학과', '국제관계학과', '국제물류학과', '국제통상학과', '글로벌경영학과',
            '글로벌비즈니스학과', '금융보험학과', '금융학과', '노동학과', '도시계획학과',
            '무역학과', '문화콘텐츠학과', '미디어커뮤니케이션학과', '벤처경영학과', '법학과',
            '부동산학과', '사회복지학과', '사회학과', '세무회계학과', '소비자학과',
            '언론정보학과', '외교학과', '유통학과', '인류학과', '재무금융학과',
            '정보사회학과', '정치외교학과', '조세학과', '지리학과', '창업학과',
            '행정학과', '호텔경영학과', '호텔관광학과', '회계학과', '광고홍보학과',
            '신문방송학과', '디지털미디어학과', '광고학과', '홍보학과', '마케팅학과',
            '경영컨설팅학과', 'e-비즈니스학과', '심리학과', '상담심리학과', '산업심리학과',

            // 교육계열
            '가정교육과', '건강교육과', '교육공학과', '교육학과', '국어교육과',
            '기술교육과', '도덕윤리교육과', '물리교육과', '미술교육과', '사회교육과',
            '생물교육과', '수학교육과', '역사교육과', '영어교육과', '유아교육과',
            '윤리교육과', '일반사회교육과', '일어교육과', '지구과학교육과', '지리교육과',
            '체육교육과', '초등교육과', '컴퓨터교육과', '통합교육과', '특수교육과',
            '화학교육과', '환경교육과', '음악교육과', '한문교육과', 'STEM교육과',

            // 예체능계열
            '게임디자인과', '공연예술학과', '공예학과', '관현악과', '국악과',
            '뮤지컬학과', '무용학과', '문예창작과', '방송연예과', '보컬과',
            '산업디자인과', '생활디자인과', '서양화과', '성악과', '스포츠과학과',
            '시각디자인과', '실내건축디자인과', '실내디자인과', '실용음악과', '연극영화과',
            '영상디자인과', '영화과', '운동생리학과', '운동재활학과', '의상디자인과',
            '작곡과', '제품디자인과', '조소과', '조형예술학과', '체육학과',
            '컴퓨터그래픽디자인과', '패션디자인과', '피아노과', '한국화과', '현대실용음악과',
            '회화과', 'e-스포츠학과', '게임그래픽디자인과', '애니메이션학과', '만화창작과',
            '웹툰학과', '캐릭터디자인과', '공간디자인과', '광고디자인과', '디지털아트과',
            '섬유디자인과', '주얼리디자인과', '도예과', '미디어아트과', '사진학과',
            '영상학과', '방송제작과', '광고제작과', '기타과', '타악기과',
            '바이올린과', '첼로과', '플루트과', '색소폰과', '트럼펫과',
            '재즈과', '교회음악과', '음향음악과', '음악치료학과', '무대디자인과',
            '연극학과', '영화제작과', '시나리오학과', '영화이론과',

            // 의약학계열
            '물리치료학과', '방사선학과', '보건관리학과', '보건행정학과', '수의학과',
            '안경광학과', '약학과', '언어치료학과', '의료경영학과', '의예과',
            '의학과', '작업치료학과', '재활학과', '응급구조학과', '치위생학과',
            '치의예과', '치의학과', '한약학과', '한의예과', '한의학과',
            '치기공학과', '의무기록학과', '보건의료정보학과', '보건환경학과', '임상병리학과',
            '방사선학과', '피부미용학과', '헤어디자인학과', '뷰티케어학과', '스포츠재활학과',

            // 농수산학계열
            '농업경제학과', '농업생명과학과', '농학과', '동물생명공학과', '동물자원학과',
            '산림과학과', '산림자원학과', '수산생명의학과', '수산양식학과', '식물생명과학과',
            '원예학과', '조경학과', '축산학과', '특용식물학과', '해양수산경영학과',
            '해양자원학과', '해양환경학과', '수의예과', '동물자원과학과', '바이오산업학과',

            // 생활과학계열
            '가족복지학과', '가정관리학과', '소비자아동학과', '아동가족학과', '아동복지학과',
            '아동학과', '의류학과', '의상학과', '식품영양학과', '주거환경학과',
            '소비자학과', '생활문화학과',

            // 학부/자율전공
            '자유전공학부', '자율전공학부', '융합전공학부', '미래융합학부', '창의융합학부',
            '글로벌학부', '국제학부', '자유전공', '학부대학', '융합인재학부'
        ].sort();

        // 전체 학과 목록 보여주기
        window.showAllDepartments = function() {
            const input = document.getElementById('department');
            const currentValue = input.value.trim();

            if (currentValue === '') {
                displayDepartmentSuggestions(allDepartments);
            } else {
                // 현재 입력된 값으로 검색 실행
                const filtered = allDepartments.filter(dept =>
                    dept.toLowerCase().includes(currentValue.toLowerCase())
                );
                displayDepartmentSuggestions(filtered);
            }
        }

        // 학과/전공 검색 함수
        window.searchDepartment = function(query) {
            clearTimeout(departmentSearchTimeout);

            if (query.length < 1) {
                // 검색어가 없으면 전체 목록 표시
                displayDepartmentSuggestions(allDepartments);
                return;
            }

            departmentSearchTimeout = setTimeout(() => {
                const filtered = allDepartments.filter(dept =>
                    dept.toLowerCase().includes(query.toLowerCase())
                );

                displayDepartmentSuggestions(filtered);
            }, 200);
        }

        // 학과 검색 결과 표시
        function displayDepartmentSuggestions(departments) {
            const suggestionsDiv = document.getElementById('departmentSuggestions');
            suggestionsDiv.innerHTML = '';

            if (departments.length === 0) {
                suggestionsDiv.innerHTML = '<div style="padding: 15px; color: #666; text-align: center;">검색 결과가 없습니다.</div>';
                suggestionsDiv.style.display = 'block';
                return;
            }

            // 검색 결과 개수 표시
            if (departments.length < allDepartments.length) {
                const countHeader = document.createElement('div');
                countHeader.style.cssText = 'padding: 10px 12px; background: #fef9c3; font-weight: 600; color: #92400e; border-bottom: 2px solid #ca8a04; position: sticky; top: 0; z-index: 10;';
                countHeader.textContent = `검색 결과 ${departments.length}개`;
                suggestionsDiv.appendChild(countHeader);
            } else {
                const countHeader = document.createElement('div');
                countHeader.style.cssText = 'padding: 10px 12px; background: #fef3c7; font-weight: 600; color: #92400e; border-bottom: 2px solid #ca8a04; position: sticky; top: 0; z-index: 10;';
                countHeader.textContent = `전체 학과 목록 (${departments.length}개) - 스크롤하여 찾거나 검색하세요`;
                suggestionsDiv.appendChild(countHeader);
            }

            departments.forEach(dept => {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: all 0.2s; font-size: 0.95em;';
                item.textContent = dept;

                item.addEventListener('mouseenter', () => {
                    item.style.background = '#fef9c3';
                    item.style.paddingLeft = '20px';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'white';
                    item.style.paddingLeft = '15px';
                });
                item.addEventListener('click', () => {
                    selectDepartment(dept);
                });

                suggestionsDiv.appendChild(item);
            });

            suggestionsDiv.style.display = 'block';
        }

        // 학과 선택
        function selectDepartment(dept) {
            document.getElementById('department').value = dept;
            document.getElementById('departmentSuggestions').style.display = 'none';
        }

        // 외부 클릭 시 학과 검색 결과 닫기
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#department') && !e.target.closest('#departmentSuggestions')) {
                document.getElementById('departmentSuggestions').style.display = 'none';
            }
        });

        // 학교 검색 함수 (글로벌 스코프에 명시적으로 할당)
        window.searchSchool = async function(query) {
            clearTimeout(searchTimeout);

            if (query.length < 2) {
                document.getElementById('schoolSuggestions').style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    // 학교알리미 API - 학교기본정보 조회
                    const url = `https://open.neis.go.kr/hub/schoolInfo?KEY=${NEIS_API_KEY}&Type=json&SCHUL_NM=${encodeURIComponent(query)}&SCHUL_KND_SC_NM=고등학교`;

                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.schoolInfo && data.schoolInfo[1] && data.schoolInfo[1].row) {
                        const schools = data.schoolInfo[1].row;
                        displaySchoolSuggestions(schools);
                    } else {
                        document.getElementById('schoolSuggestions').innerHTML = '<div style="padding: 10px; color: #666;">검색 결과가 없습니다.</div>';
                        document.getElementById('schoolSuggestions').style.display = 'block';
                    }
                } catch (error) {
                    console.error('학교 검색 오류:', error);
                    document.getElementById('schoolSuggestions').innerHTML = '<div style="padding: 10px; color: #ef4444;">검색 중 오류가 발생했습니다.</div>';
                    document.getElementById('schoolSuggestions').style.display = 'block';
                }
            }, 300);
        }

        // 학교 검색 결과 표시
        function displaySchoolSuggestions(schools) {
            const suggestionsDiv = document.getElementById('schoolSuggestions');
            suggestionsDiv.innerHTML = '';

            schools.forEach(school => {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 12px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: background 0.2s;';
                item.innerHTML = `
                    <div style="font-weight: 600; color: #333;">${school.SCHUL_NM}</div>
                    <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                        ${school.ORG_RDNMA} | ${school.SCHUL_KND_SC_NM} | ${school.FOND_SC_NM}
                    </div>
                `;

                item.addEventListener('mouseenter', () => {
                    item.style.background = '#fef9c3';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'white';
                });
                item.addEventListener('click', () => {
                    selectSchool(school);
                });

                suggestionsDiv.appendChild(item);
            });

            suggestionsDiv.style.display = 'block';
        }

        // 학교 선택
        async function selectSchool(school) {
            document.getElementById('schoolName').value = school.SCHUL_NM;
            document.getElementById('schoolSuggestions').style.display = 'none';
            selectedSchoolCode = {
                SD_SCHUL_CODE: school.SD_SCHUL_CODE,
                ATPT_OFCDC_SC_CODE: school.ATPT_OFCDC_SC_CODE
            };

            // 학교 정보 표시
            document.getElementById('schoolInfo').innerHTML = `
                <div style="padding: 10px; background: #fef9c3; border-left: 4px solid #ca8a04; border-radius: 5px;">
                    ✓ <strong>${school.SCHUL_NM}</strong> 선택됨<br>
                    📍 ${school.ORG_RDNMA}<br>
                    🏫 ${school.SCHUL_KND_SC_NM} | ${school.FOND_SC_NM}
                </div>
            `;

            // 교육과정 정보 로드
            await loadCurriculum(selectedSchoolCode);
        }

        // 교육과정 정보 로드
        async function loadCurriculum(schoolCode) {
            try {
                // 학교알리미 API - 학과정보 조회 (예시)
                const year = new Date().getFullYear();
                const url = `https://open.neis.go.kr/hub/schoolMajorinfo?KEY=${NEIS_API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${schoolCode.ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${schoolCode.SD_SCHUL_CODE}&AY=${year}`;

                const response = await fetch(url);
                const data = await response.json();

                console.log('교육과정 데이터:', data);

                // 교육과정 정보를 전역 변수에 저장하여 나중에 사용
                window.curriculumData = data;

            } catch (error) {
                console.error('교육과정 로드 오류:', error);
            }
        }

        // 외부 클릭 시 검색 결과 닫기
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#schoolName') && !e.target.closest('#schoolSuggestions')) {
                document.getElementById('schoolSuggestions').style.display = 'none';
            }
        });
    </script>
    <script src="js/header-common.js"></script>
</body>
</html>
